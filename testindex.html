<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>GET THE $BAG â€” Test Index</title>

<!-- SEO -->
<meta name="description" content="Utility on Chain. Culture on Brand. XRPLâ€™s heaviest meme. Official $BAG token.">
<meta name="keywords" content="BAG,$BAG,XRPL,XRP Ledger,crypto,meme coin,BAG token,getthebag.io">

<!-- Social -->
<meta property="og:title" content="GET THE $BAG â€” Test">
<meta property="og:description" content="Utility on Chain. Culture on Brand. XRPLâ€™s heaviest meme.">
<meta property="og:type" content="website">
<meta property="og:url" content="https://getthebag.io/testindex.html">
<meta property="og:site_name" content="$BAG">
<meta property="og:image" content="https://getthebag.io/assets/favicon-512x512.png">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="GET THE $BAG â€” Test">
<meta name="twitter:description" content="Utility on Chain. Culture on Brand.">
<meta name="twitter:image" content="https://getthebag.io/assets/favicon-512x512.png">

<!-- Icons (ABSOLUTE paths; no /assets/assets mistake) -->
<link rel="icon" href="/assets/favicon.ico" type="image/x-icon">
<link rel="icon" type="image/png" sizes="16x16"   href="/assets/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32"   href="/assets/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="48x48"   href="/assets/favicon-48x48.png">
<link rel="icon" type="image/png" sizes="64x64"   href="/assets/favicon-64x64.png">
<link rel="icon" type="image/png" sizes="128x128" href="/assets/favicon-128x128.png">
<link rel="icon" type="image/png" sizes="180x180" href="/assets/favicon-180x180.png">
<link rel="icon" type="image/png" sizes="192x192" href="/assets/favicon-192x192.png">
<link rel="icon" type="image/png" sizes="256x256" href="/assets/favicon-256x256.png">
<link rel="icon" type="image/png" sizes="512x512" href="/assets/favicon-512x512.png">
<link rel="apple-touch-icon" sizes="180x180" href="/assets/favicon-180x180.png">

<!-- Manifest (absolute path, cache-busted) -->
<link rel="manifest" href="/assets/site.webmanifest?v=test-2025-10-28-1">

<!-- Theme / Web App -->
<meta name="theme-color" content="#0c1a12">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="$BAG">

<!-- Perf -->
<link rel="preconnect" href="https://api.coingecko.com" crossorigin>
<link rel="preload" href="/assets/sounds/casinomusic.mp3?v=test-2025-10-28-1" as="audio" />

<style>
  *{box-sizing:border-box}
  :root{--gold:#ffd700;--bg:#020703;--panel:#0b1b13;--muted:#aeb7af;--fg:#f5f7f4;--content:1200px}
  html,body{margin:0;background:var(--bg);color:var(--fg);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;line-height:1.55}
  img{display:block;max-width:100%;height:auto}
  .hero,.verify,.utility,.casino-banner,.litepaper-wrap,.legal-disclaimer,footer{max-width:var(--content);margin:0 auto;padding:0 16px}
  .hero{padding:6vh 0 2vh;text-align:center}
  .hero-img{width:clamp(160px,22vw,280px);margin:0 auto 18px}
  h1{font-size:clamp(1.8rem,6vw,3rem);margin:0 0 10px}
  .tagline{font-size:clamp(1rem,4vw,1.2rem);color:var(--muted);margin:0 6px}
  .casino-banner{text-align:center;padding:10px 10px 40vh}
  .casino-banner img{margin:0 auto 20px;width:100%;max-width:960px;border-radius:12px;box-shadow:0 6px 24px rgba(0,0,0,.4)}
  @media (max-width:768px){.casino-banner img{border-radius:0;box-shadow:none}}
  .vault-break{text-align:center;color:var(--gold);font-weight:900;letter-spacing:.12em;margin:22px auto 28px;font-size:1rem;opacity:.85}
  footer{text-align:center;padding:20px 0 40px}
</style>

<!-- ZERO service worker on this test page -->
<script>
  // If a global SW still controls this scope, we warn only (we do NOT register anything here).
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.getRegistrations().then(regs => {
      if (navigator.serviceWorker.controller) {
        console.warn('[TEST] SW is controlling this page scope:', navigator.serviceWorker.controller.scriptURL);
      }
    });
  }
</script>

<!-- STRICT audio: only casinomusic.mp3; block any "here-come-the-money.mp3" -->
<script>
(() => {
  const GOOD = '/assets/sounds/casinomusic.mp3?v=test-2025-10-28-1';
  const BAD_HINT = 'here-come-the-money.mp3';
  const TARGET_ID = 'bag-casino-img';
  const THRESHOLD = 0.6;

  // Kill any attempt to play the old file from anywhere on the page
  document.addEventListener('play', (ev) => {
    const m = ev.target;
    if (!(m instanceof HTMLMediaElement)) return;
    const s = m.currentSrc || m.src || '';
    if (s.includes(BAD_HINT)) {
      try { m.pause(); m.currentTime = 0; } catch(_) {}
      console.warn('[TEST SFX] Blocked legacy audio:', s);
    }
  }, true);

  // Singleton audio element
  const sfx = new Audio(GOOD);
  sfx.preload = 'auto';
  sfx.playsInline = true;
  sfx.crossOrigin = 'anonymous';

  // Unlock on real user gesture
  let unlocked = false;
  const unlock = async () => {
    if (unlocked) return;
    try {
      sfx.muted = true;
      await sfx.play();
      sfx.pause(); sfx.currentTime = 0; sfx.muted = false;
      unlocked = true;
      window.removeEventListener('pointerdown', unlock, true);
      document.removeEventListener('keydown', unlock, true);
      console.info('[TEST SFX] Unlocked. Ready.');
    } catch (e) {
      console.warn('[TEST SFX] Unlock blocked:', e && e.name);
    }
  };
  window.addEventListener('pointerdown', unlock, true);
  document.addEventListener('keydown', unlock, true);

  // Play when the banner becomes visible
  const io = new IntersectionObserver((entries) => {
    for (const e of entries) {
      if (!unlocked) return;
      if (e.target.id !== TARGET_ID) return;
      if (e.isIntersecting && e.intersectionRatio >= THRESHOLD) {
        sfx.currentTime = 0;
        sfx.play()
          .then(() => console.info('[TEST SFX] Playing:', sfx.currentSrc))
          .catch(err => console.warn('[TEST SFX] Play blocked:', err && err.name));
      }
    }
  }, { threshold: THRESHOLD });

  document.addEventListener('DOMContentLoaded', () => {
    const img = document.getElementById(TARGET_ID);
    if (img) io.observe(img);

    // Sanity: ensure file reachable
    fetch(GOOD, { method:'HEAD', cache:'reload' })
      .then(r => console.info('[TEST SFX] HEAD', GOOD, r.status, r.ok ? 'OK' : 'NOT OK'))
      .catch(e => console.error('[TEST SFX] HEAD failed', e));
  });

  // Expose for manual test in console:
  window.TEST_SFX = {
    play: () => { unlocked = true; return sfx.play(); },
    pause: () => sfx.pause(),
    el: sfx
  };
})();
</script>
</head>
<body>

<header class="hero">
  <picture>
    <source type="image/webp" srcset="/assets/logo-256.webp 256w, /assets/logo-512.webp 512w"
            sizes="(min-width:1200px) 280px, (max-width:480px) 66vw, 22vw">
    <img src="/assets/logo-512.png"
         srcset="/assets/logo-256.png 256w, /assets/logo-512.png 512w"
         sizes="(min-width:1200px) 280px, (max-width:480px) 66vw, 22vw"
         alt="$BAG Logo" class="hero-img" width="512" height="512" fetchpriority="high" decoding="async">
  </picture>

  <h1>ðŸ’¼ GET THE $BAG â€” Test Index</h1>
  <p class="tagline">Tap once to unlock audio. Scroll banner fully into view to hear it. Legacy track is blocked.</p>
</header>

<!-- Casino banner â€” visibility trigger -->
<div class="casino-banner">
  <a href="/casino/" aria-label="Open $BAG Casino">
    <picture>
      <source type="image/webp"
              srcset="/assets/bag-casino-960.webp 960w, /assets/bag-casino-1024.webp 1024w"
              sizes="(max-width:480px) 92vw, (max-width:768px) 88vw, (max-width:1024px) 80vw, 960px">
      <img id="bag-casino-img"
           src="/assets/bag-casino-1024.png"
           srcset="/assets/bag-casino-960.png 960w, /assets/bag-casino-1024.png 1024w"
           sizes="(max-width:480px) 92vw, (max-width:768px) 88vw, (max-width:1024px) 80vw, 960px"
           alt="$BAG Casino"
           width="1024" height="683"
           loading="lazy" decoding="async">
    </picture>
  </a>

  <div class="vault-break">ENTER THE CASINO</div>
</div>

<footer>
  Â© 2025 $BAG Protocol | getthebag.io
</footer>

</body>
</html>
