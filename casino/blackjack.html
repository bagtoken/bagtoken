<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
<title>$BAG Blackjack â€” Clean Base</title>
<style>
  *{box-sizing:border-box} html,body{margin:0;background:#030905;color:#eef3ed;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
  :root{
    --gold:#ffe175;--panel:#0b1b13;--panel2:#0d2217;--line:#173524;--muted:#aeb7af;--lose:#e25b5b;--ok:#2fbf6b
    --cardW:clamp(64px,16vw,90px);--cardH:calc(var(--cardW)*1.42);
  }
  .wrap{max-width:980px;margin:0 auto;padding:16px}
  h1{margin:6px 0 12px;font-size:clamp(22px,5vw,28px);letter-spacing:.02em}
  .note{color:#cbd4cc;font-size:.9rem}

  .panel{background:linear-gradient(180deg,var(--panel),var(--panel2));border:1px solid var(--line);border-radius:14px;box-shadow:0 8px 24px rgba(0,0,0,.35)}
  .pad{padding:14px}

  .row{display:grid;gap:12px}
  @media(min-width:880px){ .row{grid-template-columns:1fr 1fr} }

  .stack{display:grid;gap:10px}
  .micro{font-size:.85rem;color:#bcd0c4}
  .mono{font-variant-numeric:tabular-nums}
  .chip{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:999px;border:1px solid #2b6a48;background:#0e2a1c;color:#e9efe9;font-weight:800}
  .chip input{accent-color:var(--ok)}
  input[type=number]{width:140px;background:#0b2217;border:1px solid #1b4a2f;border-radius:10px;color:#f3f5f0;padding:10px}
  .preset{display:flex;gap:8px;flex-wrap:wrap}
  .preset button{appearance:none;border:1px solid #2b6a48;background:#0e2a1c;color:#e9efe9;border-radius:999px;padding:6px 10px;font-weight:800;cursor:pointer}
  .marquee{text-align:center;font-weight:900;letter-spacing:.08em;color:#ffe9a6;background:linear-gradient(180deg,#17311f,#0e2419);border:1px solid #254a33;border-radius:12px;padding:8px;margin-bottom:10px}

  .felt{background:radial-gradient(1200px 600px at 50% -10%, #16432b 0%, #0f2c1e 55%, #0a2016 100%);border:1px solid #153b27;border-radius:14px;padding:12px}
  .table{background:#091a13;border:1px solid #24533a;border-radius:12px;padding:10px}

  .hand{position:relative;min-height:calc(var(--cardH) + 36px);padding-top:24px}
  .label{position:absolute;top:0;left:0;color:#bcd0c4;font-size:12px}
  .total{position:absolute;top:0;right:0;background:#0f2e20;border:1px solid #1a5136;color:#ffe175;padding:3px 10px;border-radius:999px;font-size:12px}
  .cards{display:flex;gap:10px;flex-wrap:nowrap}

  .card{width:var(--cardW);height:var(--cardH);border-radius:12px;border:2px solid #e6e6e6;background:linear-gradient(#fff,#f4f7f6);box-shadow:0 10px 22px rgba(0,0,0,.35);display:grid;place-items:center;position:relative;font-weight:800;transform:translateY(14px);opacity:0;animation:in .16s ease-out forwards}
  @keyframes in{to{transform:translateY(0);opacity:1}}
  .card.red{color:#c1121f}.card.black{color:#111}
  .corner{position:absolute;font-size:clamp(12px,2.4vw,14px);line-height:1.05}
  .tl{top:7px;left:8px}.br{bottom:7px;right:8px;transform:rotate(180deg)}
  .pip{font-size:clamp(22px,3.4vw,28px)}
  .back{background:repeating-linear-gradient(45deg,#0b1b13 0px,#0b1b13 6px,#0e2217 6px,#0e2217 12px);border-color:#193d2b}

  .btnbar{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin:10px 0 0}
  .btn{min-width:120px;padding:12px 14px;border:0;border-radius:12px;font-weight:900;cursor:pointer;color:#08130d;background:linear-gradient(180deg,#ffe175, #f5c94c);box-shadow:0 6px 0 #b08a19, 0 16px 32px rgba(255,225,117,.18)}
  .btn.alt{color:#e9efe9;background:#15261c;box-shadow:none;border:1px solid #2b6a48}
  .btn:disabled{opacity:.55;cursor:not-allowed}
  .hud{display:flex;gap:6px;flex-wrap:wrap;justify-content:center;margin-top:8px}
  .pill{background:#0a1e15;border:1px solid #244330;border-radius:999px;padding:6px 10px;font-size:12px;color:#cfe6d8}
  .result{margin-top:10px;padding:10px;border:1px solid #1b4a2f;border-radius:12px;background:#0b2217;color:#dfece7}
  .t.win{color:#2fbf6b}.t.push{color:#e8a85c}.t.lose{color:#e25b5b}
</style>
</head>
<body>
<div class="wrap">
  <h1>ðŸŽ´ $BAG Blackjack</h1>
  <p class="note">Practice mode is on by default. Payouts: <b>Blackjack 2.00Ã—</b> Â· <b>Win 1.25Ã—</b> Â· <b>Push</b> returns stake. Dealer hits soft 17.</p>

  <div class="row">
    <!-- Controls -->
    <div class="panel pad">
      <div class="stack">
        <div>
          <div class="micro">Amount (USD)</div>
          <input id="usd" type="number" class="mono" inputmode="decimal" step="0.01" min="0" placeholder="1.00" />
          <div class="preset" style="margin-top:6px">
            <button data-u="1">$1</button><button data-u="2">$2</button><button data-u="5">$5</button>
            <button data-u="10">$10</button><button data-u="20">$20</button><button data-u="50">$50</button>
          </div>
        </div>
        <div>
          <div class="micro">Bet currency</div>
          <label class="chip"><input type="radio" name="cur" value="XRP" checked> XRP</label>
          <label class="chip"><input type="radio" name="cur" value="BAG"> BAG</label>
        </div>
        <div>
          <div class="micro">Bet amount</div>
          <input id="qty" type="number" class="mono" inputmode="decimal" step="any" min="0" value="1" />
          <span id="unit" class="micro">XRP</span>
          <div class="micro" id="limits" style="margin-top:6px"></div>
        </div>

        <div class="micro">Live prices (optional; auto-fills when available)</div>
        <div class="mono micro">BAG $<span id="pBag">â€”</span> Â· XRP $<span id="pXrp">â€”</span> <span id="pSrc" class="micro"></span></div>

        <div class="micro" id="payouts" style="margin-top:6px">Blackjack: â€” BAG ($â€”) Â· Win: â€” BAG ($â€”) Â· Push: â€” BAG ($â€”)</div>
      </div>
    </div>

    <!-- Table -->
    <div class="panel pad">
      <div class="marquee">$BAG TABLE</div>
      <div class="felt">
        <div class="table">
          <div class="hand" id="dealer">
            <div class="label">Dealer</div><div class="total" id="dealerTotal">0</div>
            <div class="cards" id="dealerCards"></div>
          </div>
          <div class="hand" id="player">
            <div class="label">You</div><div class="total" id="playerTotal">0</div>
            <div class="cards" id="playerCards"></div>
          </div>

          <div class="btnbar">
            <button id="deal" class="btn">Deal</button>
            <button id="hit"  class="btn" disabled>Hit</button>
            <button id="stand"class="btn" disabled>Stand</button>
            <button id="double"class="btn alt" disabled>Double</button>
            <button id="split" class="btn alt" disabled>Split</button>
            <button id="again" class="btn" style="display:none">New Hand</button>
          </div>

          <div class="hud">
            <span class="pill">Mode: <b id="modeLbl">Demo</b></span>
            <span class="pill">Balance: <b id="balLbl">â€”</b> <span id="balUnit">BAG</span></span>
            <span class="pill">Bet: <b id="betLbl">1</b></span>
            <span class="pill">Last: <b id="lastLbl">â€”</b></span>
          </div>

          <div id="status" class="result">Place a stake, then Deal</div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
/* ===== Demo session (always on unless you wire live later) ===== */
(function seedDemo(){
  const KEY='__bag_demo_blackjack_clean_v1';
  if(localStorage.getItem(KEY)==null){ try{ localStorage.setItem(KEY,'1000'); }catch{} }
  const demo={
    active:()=>true,
    get:()=>({bag:Number(localStorage.getItem(KEY))||1000}),
    spend:(n)=>{const b=Number(localStorage.getItem(KEY))||1000; if(!(n>0))return true; if(b<n)return false; localStorage.setItem(KEY,String(b-n)); dispatchEvent(new CustomEvent('hud')); return true;},
    credit:(n)=>{const b=Number(localStorage.getItem(KEY))||1000; if(!(n>0))return true; localStorage.setItem(KEY,String(b+n)); dispatchEvent(new CustomEvent('hud')); return true;}
  };
  window.__BAG_FORCE_DEMO=true; window.__bagSession=demo;
})();

/* ===== Tiny price helper (optional, graceful if offline) ===== */
const PRICES = { bagUsd:0.0001, xrpUsd:0.5, source:'default' }; // sensible defaults
(async function fetchLive(){
  try{
    const r1 = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=ripple&vs_currencies=usd', {cache:'no-store'});
    const x = (await r1.json())?.ripple?.usd; if(Number(x)>0) PRICES.xrpUsd=Number(x);
  }catch{}
  // If you have a BAG price feed, set PRICES.bagUsd here. Otherwise keep default.
  PRICES.source = 'live*';
  renderPrices();
  dispatchEvent(new CustomEvent('prices'));
})();

function renderPrices(){
  const $ = (s)=>document.getElementById(s);
  $('pBag').textContent = fmt(PRICES.bagUsd, 6);
  $('pXrp').textContent = PRICES.xrpUsd ? PRICES.xrpUsd.toFixed(2) : 'â€”';
  $('pSrc').textContent = PRICES.source==='default' ? '(default)' : '(live)';
}

/* ===== Stake inputs (USD â†” units) ===== */
const elUSD = document.getElementById('usd');
const elQty = document.getElementById('qty');
const elUnit= document.getElementById('unit');
const elLimits=document.getElementById('limits');
const curRadios = document.querySelectorAll('input[name="cur"]');
document.querySelectorAll('.preset button').forEach(b=>b.addEventListener('click',()=>{
  const v=Number(b.dataset.u)||0; elUSD.value=v.toFixed(2); syncFromUSD();
}));

curRadios.forEach(r=>r.addEventListener('change',()=>{
  elUnit.textContent = currentCur();
  if(elUSD.dataset.user==='1'){ syncFromUSD(); } else { syncFromUnits(); }
  dispatchEvent(new CustomEvent('hud'));
}));
elUSD.addEventListener('input', ()=>{ elUSD.dataset.user = elUSD.value ? '1':'0'; syncFromUSD(); });
elQty.addEventListener('input', ()=>{ elUSD.dataset.user = '0'; syncFromUnits(); });

function currentCur(){ return (document.querySelector('input[name="cur"]:checked')?.value || 'XRP').toUpperCase(); }
function priceForCur(){ return currentCur()==='BAG' ? PRICES.bagUsd : PRICES.xrpUsd; }
function stakeUSD(){ const v=parseFloat(elUSD.value||''); if(Number.isFinite(v)&&v>0) return v; const q=parseFloat(elQty.value||'')||0; const px=priceForCur(); return px>0?q*px:0; }
function stakeBAG(){
  const q=parseFloat(elQty.value||'')||0;
  if(currentCur()==='BAG') return q;
  const {bagUsd,xrpUsd}=PRICES; return (bagUsd>0 && xrpUsd>0) ? q*(xrpUsd/bagUsd) : 0;
}
function syncFromUSD(){
  const u = Math.max(0, Number(elUSD.value)||0);
  const px = priceForCur();
  elQty.value = (px>0 && u>0) ? (Math.floor((u/px)*1e6)/1e6) : '';
  renderLimits(); renderPayouts(); dispatchEvent(new CustomEvent('hud'));
}
function syncFromUnits(){
  if(elUSD.dataset.user==='1') return;
  const px=priceForCur(), q=parseFloat(elQty.value||'')||0;
  elUSD.value = (px>0 && q>0) ? (Math.round(q*px*100)/100).toFixed(2) : '';
  renderLimits(); renderPayouts(); dispatchEvent(new CustomEvent('hud'));
}
function renderLimits(){
  const u = stakeUSD()||0;
  const warn = (u>0 && u<1) ? ' Â· Min $1' : (u>2000 ? ' Â· Max $2000' : '');
  elLimits.innerHTML = `Limits: $1â€“$2000 Â· Your stake â‰ˆ $${u.toFixed(2)}${warn}`;
}
function renderPayouts(){
  const bag = stakeBAG(); const usd = stakeUSD();
  setText('payouts', `Blackjack: ${fmt(bag*2)} BAG ($${(usd*2).toFixed(2)}) Â· Win: ${fmt(bag*1.25)} BAG ($${(usd*1.25).toFixed(2)}) Â· Push: ${fmt(bag)} BAG ($${usd.toFixed(2)})`);
}
function fmt(n,max=6){ return Number(n||0).toLocaleString(undefined,{maximumFractionDigits:max}); }
function setText(id,txt){ document.getElementById(id).textContent = txt; }

/* ===== Cards & rules ===== */
const CONFIG = { decks:1, hitSoft17:true, allowDouble:true, allowSplit:true, mBJ:2.00, mWIN:1.25, mPUSH:1.00 };
let shoe=[];
function buildShoe(){ const R=['A','2','3','4','5','6','7','8','9','10','J','Q','K'], S=['â™ ','â™¥','â™¦','â™£']; const t=[]; for(let d=0;d<CONFIG.decks;d++) for(const r of R) for(const s of S) t.push({r,s}); for(let i=t.length-1;i>0;i--){ const j=(Math.random()*(i+1))|0; [t[i],t[j]]=[t[j],t[i]]; } shoe=t; }
function draw(){ if(!shoe.length) buildShoe(); return shoe.pop(); }
function val(hand){ let t=0,a=0; for(const c of hand){ if(c.r==='A'){t+=11;a++;} else if(['K','Q','J','10'].includes(c.r)) t+=10; else t+=parseInt(c.r,10); } while(t>21 && a>0){ t-=10; a--; } return {total:t, soft:(a>0 && t<=21)}; }
function isBJ(h){ if(h.length!==2) return false; const v=h.map(c=>c.r); return v.includes('A') && ['10','J','Q','K'].some(x=>v.includes(x)); }
function canSplit(h){ if(!CONFIG.allowSplit || STATE.split) return false; if(h.length!==2) return false; const fv=(x)=>x.r==='A'?11:(['K','Q','J','10'].includes(x.r)?10:parseInt(x.r,10)); return fv(h[0])===fv(h[1]); }

/* ===== Rendering (no stale refs) ===== */
const D = (id)=>document.getElementById(id);
function makeCardEl(c,back=false){
  const el=document.createElement('div'); el.className= back? 'card back':'card '+(['â™¥','â™¦'].includes(c.s)?'red':'black');
  if(!back) el.innerHTML = `<div class="corner tl">${c.r}<br>${c.s}</div><div class="pip">${c.s}</div><div class="corner br">${c.r}<br>${c.s}</div>`;
  return el;
}
function clearCards(){
  D('dealerCards').innerHTML=''; D('playerCards').innerHTML='';
  D('dealerTotal').textContent='0'; D('playerTotal').textContent='0';
  // remove split rows if any
  const extra=document.querySelectorAll('.splitRow'); extra.forEach(n=>n.remove());
}
function addSplitRow(i){
  const row=document.createElement('div'); row.className='hand splitRow';
  row.innerHTML = `<div class="label">You (Hand ${i+1})</div><div class="total" id="pT_${i}">0</div><div class="cards" id="pC_${i}"></div>`;
  D('player').after(row);
}
function updateTotals(){
  D('dealerTotal').textContent = val(STATE.dealer).total;
  if(STATE.hands.length===1){
    D('playerTotal').textContent = val(STATE.hands[0]).total;
  }else{
    STATE.hands.forEach((h,i)=>{
      const t = val(h).total;
      (i===0?D('playerTotal'):D('pT_'+i)).textContent = t;
    });
  }
}

/* ===== Audio (tiny) ===== */
function blip(){ try{ const a=new (window.AudioContext||window.webkitAudioContext)(); const o=a.createOscillator(); const g=a.createGain(); o.type='triangle'; o.frequency.value=520; o.connect(g).connect(a.destination); g.gain.value=.12; const t=a.currentTime; o.start(t); o.stop(t+.18);}catch{} }

/* ===== Session helpers ===== */
function spendBAG(n){ if(!(n>0)) return true; if(window.__BAG_FORCE_DEMO){ return __bagSession.spend(n); } try{ return !!(__bagSession && __bagSession.spend && __bagSession.spend(n)); }catch{ return false; } }
function creditBAG(n){ if(!(n>0)) return; try{ __bagSession && __bagSession.credit && __bagSession.credit(n);}catch{} }

/* ===== State & controls ===== */
const STATE = { dealer:[], hands:[], active:0, split:false, locked:0, live:false };
const btnDeal=D('deal'), btnHit=D('hit'), btnStand=D('stand'), btnDouble=D('double'), btnSplit=D('split'), btnAgain=D('again');
function setStatus(txt,cls){ const el=D('status'); el.className='result'+(cls?(' t '+cls):''); el.textContent=txt; }
function last(s){ D('lastLbl').textContent=s; }

function lockStake(){
  const bag=stakeBAG(), usd=stakeUSD();
  if(!window.__BAG_FORCE_DEMO){
    if(!(usd>=1) || usd>2000) return [false,'Stake must be $1â€“$2000'];
  }
  if(!(bag>0)) return [false,'Enter a stake first'];
  if(!spendBAG(bag)) return [false,'Insufficient balance'];
  STATE.locked=bag; return [true,''];
}

function startRound(){
  const [ok,err]=lockStake(); if(!ok) return alert(err);
  clearCards(); STATE.dealer=[]; STATE.hands=[[]]; STATE.active=0; STATE.split=false; STATE.live=true;

  // deal P, D, P, D(hole)
  const pc=D('playerCards'), dc=D('dealerCards');
  const c1=draw(), c2=draw(), c3=draw(), c4=draw();
  STATE.hands[0].push(c1); pc.appendChild(makeCardEl(c1)); blip();
  STATE.dealer.push(c2); dc.appendChild(makeCardEl(c2)); blip();
  STATE.hands[0].push(c3); pc.appendChild(makeCardEl(c3)); blip();
  STATE.dealer.push(c4); dc.appendChild(makeCardEl(c4,true)); blip();

  updateTotals();
  btnDeal.disabled=true; btnHit.disabled=false; btnStand.disabled=false; btnDouble.disabled=false; btnSplit.disabled=!canSplit(STATE.hands[0]); btnAgain.style.display='none';
  setStatus('Play your hand');
  last('Dealt');

  if(isBJ(STATE.hands[0])){
    revealHole();
    const dBJ=isBJ(STATE.dealer);
    settleAll(dBJ?'push-bj':'blackjack');
  }
}

function revealHole(){
  const dc=D('dealerCards'); const backs=[...dc.children].filter(n=>n.classList.contains('back'));
  if(backs[0]) backs[0].replaceWith(makeCardEl(STATE.dealer[1],false));
  updateTotals();
}

function hitHand(i){
  const node = (STATE.hands.length===1) ? D('playerCards') : (i===0?D('playerCards'):D('pC_'+i));
  const c=draw(); STATE.hands[i].push(c); node.appendChild(makeCardEl(c)); blip(); updateTotals();
}
function nextHandOrDealer(){
  if(STATE.hands.length>1){
    STATE.active++;
    if(STATE.active<STATE.hands.length){
      btnDouble.disabled = !(STATE.hands[STATE.active].length===2);
      btnHit.disabled=false; btnStand.disabled=false;
      setStatus(`Hand ${STATE.active+1}: your move`);
      return;
    }
  }
  dealerPhase();
}
function dealerPhase(){
  revealHole();
  let dv=val(STATE.dealer);
  while(dv.total<17 || (dv.total===17 && dv.soft && CONFIG.hitSoft17)){ const c=draw(); STATE.dealer.push(c); D('dealerCards').appendChild(makeCardEl(c)); blip(); dv=val(STATE.dealer); }
  updateTotals();
  settleAll();
}

function settleAll(override){
  let credit=0, usd=stakeUSD(); const base=STATE.locked;

  function doHand(h,idx){
    const pv=val(h).total, dv=val(STATE.dealer).total;
    const doubled = h._dbl===true; const stake = base*(doubled?2:1);

    if(override==='blackjack'){
      credit += stake*CONFIG.mBJ; setStatus('Blackjack â€” paid 2.00Ã—','win'); last('Blackjack 2Ã—'); return;
    }
    if(override==='push-bj'){ credit += stake*CONFIG.mPUSH; setStatus('Push (both Blackjack) â€” stake returned','push'); last('Push'); return; }

    if(pv>21){ setStatus('Busted â€” dealer wins','lose'); last('Scratch'); return; }
    if(dv>21 || pv>dv){
      const mult = (isBJ(h)&&!doubled&&!STATE.split) ? CONFIG.mBJ : CONFIG.mWIN;
      credit += stake*mult;
      setStatus(mult===CONFIG.mBJ?'Blackjack â€” 2.00Ã—':`You win ${CONFIG.mWIN.toFixed(2)}Ã—`,'win'); last(mult===CONFIG.mBJ?'Blackjack 2Ã—':'Win 1.25Ã—');
    } else if(pv<dv){
      setStatus('Dealer wins','lose'); last('Scratch');
    } else {
      credit += stake*CONFIG.mPUSH; setStatus('Push â€” stake returned','push'); last('Push');
    }
  }

  if(STATE.hands.length===1) doHand(STATE.hands[0],0); else STATE.hands.forEach(doHand);
  if(credit>0) creditBAG(credit);

  btnHit.disabled=true; btnStand.disabled=true; btnDouble.disabled=true; btnSplit.disabled=true; btnDeal.disabled=true; btnAgain.style.display='inline-block';
  STATE.live=false;
}

btnDeal.addEventListener('click', startRound);
btnHit.addEventListener('click', ()=>{
  btnDouble.disabled=true;
  hitHand(STATE.active);
  if(val(STATE.hands[STATE.active]).total>21){ setStatus(`Hand ${STATE.hands.length>1?STATE.active+1:''} busts`,'lose'); nextHandOrDealer(); }
});
btnStand.addEventListener('click', ()=>{ setStatus(`Hand ${STATE.hands.length>1?STATE.active+1:''} stands`); nextHandOrDealer(); });
btnDouble.addEventListener('click', ()=>{
  const h=STATE.hands[STATE.active]; if(h.length!==2) return alert('Double only on first turn');
  if(!spendBAG(STATE.locked)) return alert('Insufficient balance');
  h._dbl=true; hitHand(STATE.active); nextHandOrDealer();
});
btnSplit.addEventListener('click', ()=>{
  const h=STATE.hands[0]; if(!canSplit(h)) return;
  if(!spendBAG(STATE.locked)) return alert('Insufficient balance');
  STATE.split=true;
  const a=h[0], b=h[1];
  STATE.hands=[ [a], [b] ];
  // rebuild rows
  D('playerCards').innerHTML=''; D('playerTotal').textContent='0';
  addSplitRow(1);
  D('playerCards').appendChild(makeCardEl(a));
  D('pC_1').appendChild(makeCardEl(b));
  // deal one to each
  hitHand(0); hitHand(1);
  updateTotals();
  STATE.active=0; btnSplit.disabled=true; btnDouble.disabled=false;
});
btnAgain.addEventListener('click', ()=>{ clearCards(); btnDeal.disabled=false; btnHit.disabled=true; btnStand.disabled=true; btnDouble.disabled=true; btnSplit.disabled=true; btnAgain.style.display='none'; setStatus('Place a stake, then Deal'); last('â€”'); });

/* ===== HUD ===== */
function HUD(){
  const mode = window.__BAG_FORCE_DEMO ? 'Demo' : 'Live';
  const bag  = Number(__bagSession?.get?.().bag)||0;
  D('modeLbl').textContent = mode;
  D('balLbl').textContent  = fmt(bag, 6);
  D('balUnit').textContent = 'BAG';
  D('betLbl').textContent  = String(parseFloat(elQty.value||0)||0);
}
addEventListener('hud', HUD); addEventListener('prices', ()=>{ syncFromUnits(); HUD(); });
['input','change'].forEach(ev=>{ elQty.addEventListener(ev, ()=>dispatchEvent(new CustomEvent('hud'))); curRadios.forEach(r=>r.addEventListener(ev, ()=>dispatchEvent(new CustomEvent('hud')))); });

/* ===== Boot ===== */
function boot(){
  buildShoe();
  // Default $1 stake
  if(!elUSD.value){ elUSD.value='1.00'; elUSD.dataset.user='1'; }
  syncFromUSD(); HUD(); setStatus('Place a stake, then Deal');
}
boot();
// Auto-reshuffle
setInterval(()=>{ if(shoe.length<15) buildShoe(); }, 2000);
</script>
</body>
</html>
