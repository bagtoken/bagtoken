<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>$BAG Casino</title>

<!-- Preload audio to reduce first-tap latency -->
<link rel="preload" href="/assets/sounds/casino-ambiance.mp3" as="audio" />

<style>
  *{box-sizing:border-box}
  :root{
    --gold:#ffd700;--bg:#020703;--panel:#0b1b13;--panel2:#0d2217;
    --muted:#aeb7af;--fg:#f5f7f4;--green:#2fbf6b;
    --line:#173524;--shadow:rgba(0,0,0,.35);
    --content:1200px;       /* desktop line-length */
    --backbar-h:56px;       /* sticky header height for offsets */
  }
  html,body{margin:0;background:var(--bg);color:var(--fg);
    font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
  img{display:block;max-width:100%;height:auto}

  /* Back */
  .backbar{position:sticky;top:0;z-index:1000;background:linear-gradient(180deg,#0f1f17,#0e271c);
    border-bottom:1px solid #1b4a2f;box-shadow:0 4px 18px rgba(0,0,0,.35)}
  .backlink{display:inline-block;margin:10px 12px;padding:10px 14px;border-radius:12px;
    color:#08130d;text-decoration:none;font-weight:900;letter-spacing:.2px;
    background:linear-gradient(180deg,#ffe175 0%, #f5c94c 100%);
    box-shadow:0 3px 0 #b08a19;transition:transform .06s ease,box-shadow .2s ease,filter .2s ease}
  .backlink:hover{filter:brightness(1.05)}
  .backlink:active{transform:translateY(1px);box-shadow:0 2px 0 #9a7315}

  /* Center the whole page on wide screens */
  .wrap{max-width:var(--content);margin:0 auto;padding:18px 16px 32px}
  @media (min-width:1024px){
    .wrap{padding:24px 24px 40px}
  }

  .top{text-align:center;padding:18px 0 6px}
  .tag{color:var(--muted);font-weight:600;letter-spacing:.04em}
  .tag.gold{color:var(--gold);}
  .tag.gold strong{color:inherit;}

  /* Hero */
  .casino-hero{padding:10px 0 0}
  .casino-hero .poster{margin:0 auto 18px;border-radius:14px;box-shadow:0 8px 28px var(--shadow)}
  @media (min-width:900px){.casino-hero .poster{max-width:1000px}}
  @media (max-width:899px){.casino-hero .poster{width:100%;max-width:none;border-radius:0;box-shadow:none}}

  /* Under Construction (centered) */
  .under-construction{
    max-width:900px;margin:0 auto 16px;text-align:center;color:#e9efe9;
    padding:12px 14px;border:1px dashed #2b6a48;border-radius:12px;
    background:linear-gradient(180deg,var(--panel) 0%, var(--panel2) 100%);
    box-shadow:0 6px 20px var(--shadow);
  }
  .under-construction p{margin:6px 0}

  /* Divider */
  .vault-break{text-align:center;color:var(--gold);font-weight:900;letter-spacing:.12em;
    margin:48px auto 32px;font-size:1rem;opacity:.85;position:relative}
  .vault-break::before,.vault-break::after{
    content:"";display:inline-block;vertical-align:middle;width:60px;height:2px;
    background:linear-gradient(90deg,transparent,var(--gold),transparent);
    margin:0 12px;opacity:.7
  }

  /* Grid */
  .grid{display:grid;gap:18px;margin-top:16px}
  @media (min-width:720px){.grid{grid-template-columns:repeat(3,1fr)}}
  @media (max-width:719px){.grid{grid-template-columns:1fr}}

  .card{position:relative;background:linear-gradient(180deg,var(--panel) 0%, var(--panel2) 100%);
    border:1px solid var(--line);border-radius:16px;box-shadow:0 8px 24px var(--shadow);overflow:hidden}
  .card-img{aspect-ratio:16/9;width:100%;object-fit:cover;background:#0b0b0c}
  .card-body{padding:14px 14px 16px}
  .card h3{margin:0 0 6px;font-size:clamp(1.05rem,1.2vw,1.2rem)}
  .meta{color:#cfd6cf;font-size:clamp(.92rem,1vw,1rem);margin:0 0 12px}
  .btn{display:inline-block;padding:10px 16px;font-weight:800;text-decoration:none;border-radius:12px;
    color:#08130d;background:linear-gradient(180deg,#ffe175 0%, #f5c94c 100%);
    box-shadow:0 4px 0 #b08a19;transition:transform .06s ease, filter .2s ease, box-shadow .2s ease}
  .btn:hover{filter:brightness(1.05);box-shadow:0 4px 0 #b08a19,0 14px 28px rgba(255,225,117,.22)}
  .btn:active{transform:translateY(1px);box-shadow:0 3px 0 #9a7315}

  /* COMING SOON placeholders */
  .soon-box{display:flex;flex-direction:column;justify-content:center;align-items:center;
    height:100%;aspect-ratio:16/9;background:radial-gradient(circle at center,#0e2419 0%,#08130d 100%);
    border:1px dashed #2b6a48;text-align:center;border-radius:16px;
    box-shadow:inset 0 0 40px rgba(255,215,0,.05)}
  .soon-title{font-size:1.1rem;font-weight:800;color:#f5f7f4;margin-bottom:6px;letter-spacing:.03em}
  .soon-sub{font-family:"Cinzel",serif;font-weight:700;font-size:1.25rem;letter-spacing:.08em;color:#ffd700;text-shadow:0 0 8px rgba(255,215,0,.3)}

  /* Floating sound toggle (upper-right) */
  #soundToggle{
    position:fixed;top:10px;right:12px;z-index:2147483647;
    background:rgba(0,0,0,.35);backdrop-filter:saturate(120%) blur(4px);
    border:1px solid #2b6a48;border-radius:12px;padding:8px 10px;
    color:var(--gold);font-size:1.2rem;cursor:pointer;opacity:.9;
    transition:opacity .2s ease, transform .12s ease;
  }
  #soundToggle:hover{opacity:1;transform:scale(1.06)}
  #soundToggle:active{transform:scale(.98)}

  .foot{color:#aab3ab;text-align:center;margin:26px 0 8px;font-size:.9rem}
  .foot a{color:#e0c66f;text-decoration:none;font-weight:700}

  /* THE CAGE (cashier) */
  .cage{margin:0 0 24px}
  .cage-panel{
    display:flex;gap:16px;align-items:center;justify-content:space-between;
    padding:14px 16px;border-radius:16px;
    background:linear-gradient(180deg,var(--panel) 0%, var(--panel2) 100%);
    border:1px solid var(--line);box-shadow:0 8px 24px var(--shadow)
  }
  .cage-title{font-weight:900;letter-spacing:.06em;color:var(--gold)}
  .cage-meta{margin:4px 0 0;color:#cfd6cf;font-size:.95rem;max-width:60ch}
  .cage-actions{display:flex;gap:10px;flex-wrap:wrap}
  @media (max-width:720px){
    .cage-panel{flex-direction:column;align-items:flex-start}
  }
  @media (min-width:1024px){
    .cage-actions{justify-content:flex-end}
  }

  /* ===== Compliance (shared styles) ===== */
  .comp-wrap{margin-top:24px;border-top:1px solid var(--line);padding:16px 0;color:var(--muted);font-size:14px;line-height:1.5}
  .comp-grid{display:grid;gap:12px}
  .comp-row{display:flex;flex-wrap:wrap;gap:12px;align-items:center}
  .comp-pill{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:999px;background:var(--panel2);color:var(--fg);font-size:13px}
  .comp-pill small{opacity:.8}
  .comp-links a{color:var(--gold);text-decoration:none}
  .comp-links a:hover{text-decoration:underline}
  .comp-note{font-size:12px;color:var(--muted)}
  .comp-rtp{padding:12px;border-radius:12px;background:var(--panel)}
  .badge-18{background:#e25b5b;color:#111;padding:2px 8px;border-radius:999px;font-weight:700}
  .comp-disclaimer{margin-top:8px;font-size:12px;color:var(--muted)}
  .modal-mask{position:fixed;inset:0;background:rgba(0,0,0,.65);backdrop-filter:saturate(120%) blur(2px);display:none;z-index:2147483645}
  .modal{position:fixed;inset:0;display:grid;place-items:center;z-index:2147483646}
  .card{width:min(560px,92vw);background:linear-gradient(180deg,var(--panel2),#0a1912);color:var(--fg);border:1px solid #173524;border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.5);padding:20px}
  .card h3{margin:0 0 6px 0}
  .card p{margin:0 0 12px 0;color:var(--muted)}
  .row{display:flex;gap:10px;flex-wrap:wrap}
  .btn.comp{cursor:pointer;border:0;border-radius:10px;padding:12px 14px;background:var(--gold);color:#111;font-weight:700}
  .btn.comp.secondary{background:#173524;color:var(--fg);border:1px solid #245a3b}
  .agree{display:flex;gap:8px;align-items:flex-start;margin:10px 0}
  .agree input{margin-top:3px}
  .hide{display:none !important}
  .warn{color:#e25b5b;font-size:12px;margin-top:8px}

  /* Center compliance block + top links */
  .comp-wrap{max-width:900px;margin:32px auto 0;text-align:center}
  .comp-grid{justify-items:center}
  .comp-row{justify-content:center}
  .comp-links{display:flex;gap:14px;justify-content:center}

  /* Make the sticky Responsible bar sit below the sticky backbar on desktop */
  #respBar{justify-content:center}
  @media (min-width:768px){
    #respBar{top:var(--backbar-h)}
  }

  /* ===== Age / Warning modal sizing and theme overrides ===== */
  .age-card{width:min(680px,94vw);padding:26px 22px;}
  .age-card h3{font-size:1.25rem}
  .age-card p{font-size:1rem}
  .age-card .row{justify-content:flex-end}
  .age-card .btn.comp,.age-card .btn.comp.secondary{padding:14px 18px;font-size:16px;border-radius:12px}

  .age-warn-card{width:min(720px,96vw);padding:28px 24px;}
  .age-warn-card h3{font-size:1.3rem}
  .age-warn-card p{font-size:1rem}
  .age-warn-card .row{justify-content:flex-end}
  .age-warn-card .btn.comp,.age-warn-card .btn.comp.secondary{padding:14px 18px;font-size:16px;border-radius:12px}
</style>

<!-- ===== Desktop layout cap so tiles never run off-screen ===== -->
<style id="casino-pc-fixes">
  @media (min-width: 1024px){
    .grid{
      grid-template-columns: repeat(3, minmax(0, 1fr));
      max-width: 1040px;
      margin-left: auto;
      margin-right: auto;
    }
    .card{
      max-width: 340px;
      margin: 0 auto;
    }
  }
</style>

<!-- ===== Mobile override: full-width cards, single column, no shrink ===== -->
<style id="casino-mobile-fixes">
  @media (max-width: 719px){
    .wrap{ padding-left:12px; padding-right:12px; }
    .grid{ grid-template-columns: 1fr !important; gap:14px; max-width:none; margin-left:0; margin-right:0; }
    .card{ max-width:none !important; width:100%; margin:0; }
    .card-img{ width:100%; aspect-ratio:16/9; }
    .casino-hero .poster{ width:100%; max-width:100%; border-radius:0; box-shadow:none; }
    html, body { overflow-x: hidden; }
  }
</style>

<script src="/js/bag-session.js" defer></script>
 
</head>
<body>

<nav class="backbar" role="navigation" aria-label="Back">
  <a class="backlink" href="/" aria-label="Back to $BAG">⬅ Back to $BAG</a>
</nav>

<!-- 🔊 Floating speaker -->
<button id="soundToggle" title="Toggle casino ambiance" aria-pressed="false">🔇</button>
<audio id="casinoAmbience" src="/assets/sounds/casino-ambiance.mp3" loop preload="auto" playsinline></audio>

<div class="wrap">
  <div class="top">
    <div style="font-size:1.6rem;font-weight:900;letter-spacing:.03em">💼 $BAG CASINO</div>
    <div class="tag">Utility on Chain. Culture on Brand.</div>
    <div class="tag gold" style="margin-top:6px">
      Bet in $XRP or <strong>$BAG</strong> on all games. $XRP bets auto-convert at the live rate; payouts are in <strong>$BAG</strong>.
    </div>
  </div>

  <!-- HERO: swapped to casino-entrance.png -->
  <section class="casino-hero" aria-label="$BAG Casino">
    <img src="/assets/casino-floor.PNG" alt="$BAG Casino Entrance" class="poster" decoding="async">
  </section>

  <!-- 🚧 Under Construction -->
  <div class="under-construction" role="status" aria-live="polite">
    <p>🚧 <strong>Pardon the Dust — We’re Building the BAG</strong></p>
    <p>The tables are being polished. The dice are loading.</p>
    <p>The vault’s wiring in progress — you’re early to the floor.</p>
    <p>🎰 <strong>$BAG Casino coming online piece by piece.</strong></p>
  </div>

  <!-- THE CAGE (cashier) -->
  <section class="cage" aria-label="The Cage (Cashier)">
    <div class="cage-panel">
      <div>
        <div class="cage-title">🏦 THE CAGE</div>
        <p class="cage-meta">
          Connect, deposit, and play across all games with one balance. Bet in <strong>$XRP</strong> or <strong>$BAG</strong>
          (XRP auto-converts; payouts in <strong>$BAG</strong>).
        </p>
      </div>
      <div class="cage-actions">
        <button class="btn" id="btnConnect">Connect Wallet</button>
        <button class="btn" id="btnStart">Start Session</button>
        <button class="btn" id="btnTopup">Top Up</button>
        <button class="btn" id="btnEnd" style="background:#15261c;color:#dfe9e2;border:1px solid #2b6a48;">End</button>
      </div>
    </div>
  </section>

  <script>
    const $ = s => document.querySelector(s);
    $('#btnConnect').onclick = async ()=>{ try{ await __bagSession.connect(); alert('Wallet connected'); }catch(e){ alert(e.message||'Connect failed'); } };
    $('#btnStart').onclick   = async ()=>{ try{ await __bagSession.start({ usdDeposit: 10 }); alert('Session started'); }catch(e){ alert(e.message||'Start failed'); } };
    $('#btnTopup').onclick   = async ()=>{ try{ await __bagSession.topUp({ usdDeposit: 10 }); alert('Topped up'); }catch(e){ alert(e.message||'Top-up failed'); } };
    $('#btnEnd').onclick     = ()=>{ __bagSession.end(); alert('Session ended'); };
    window.addEventListener('bag:sessionSynced', ()=>{/* optionally refresh UI */});
  </script>

  <!-- Divider moved BELOW The Cage -->
  <div class="vault-break">ENTER THE FLOOR</div>

  <!-- Games -->
  <section aria-label="Games" class="grid">
    <!-- 🎲 DICE -->
    <article class="card">
      <img class="card-img" src="/assets/bag-dice.jpeg" alt="$BAG Dice" loading="lazy" decoding="async">
      <div class="card-body">
        <h3>🎲 $BAG Dice</h3>
        <p class="meta">Pass Line. Instant on-ledger payouts in $BAG.</p>
        <a class="btn" href="/casino/dice.html">Play Dice (🚧DEMO AVAILABLE🚧)</a>
      </div>
    </article>

    <!-- 🎰 SLOTS -->
    <article class="card">
      <img class="card-img" src="/assets/bag-slots.jpeg" alt="$BAG Slots" loading="lazy" decoding="async">
      <div class="card-body">
        <h3>🎰 $BAG Slots</h3>
        <p class="meta">3×3 classic. Manual spin. Multipliers & payouts.</p>
        <a class="btn" href="/casino/slots.html">Play Slots (🚧DEMO AVAILABLE🚧)</a>
      </div>
    </article>

    <!-- 💥 PLINKO -->
    <article class="card">
      <img class="card-img" src="/assets/bag-plinko.jpg" alt="$BAG Plinko" loading="lazy" decoding="async">
      <div class="card-body">
        <h3>💥 $BAG Plinko</h3>
        <p class="meta">Risk ladder. Choose your rows & odds.</p>
        <a class="btn" href="/casino/plinko.html" aria-disabled="true">Play Plinko (🚧DEMO AVAILABLE🚧)</a>
      </div>
    </article>

    <!-- 🎯 ROULETTE -->
    <article class="card">
      <img class="card-img" src="/assets/bag-roulette.png" alt="$BAG Roulette" loading="lazy" decoding="async">
      <div class="card-body">
        <h3>🎯 $BAG Roulette</h3>
        <p class="meta">American wheel. Bet red, black, or green — house edge never sleeps.</p>
        <a class="btn" href="/casino/">Play Roulette (🚧COMING SOON🚧)</a>
      </div>
    </article>

    <!-- ♠️ POKER -->
    <article class="card">
      <img class="card-img" src="/assets/bag-poker.jpeg" alt="$BAG Poker" loading="lazy" decoding="async">
      <div class="card-body">
        <h3>♠️ $BAG Poker</h3>
        <p class="meta">5-Card Draw. Read the table — and the chain.</p>
        <a class="btn" href="/casino/">Play Poker (🚧COMING SOON🚧)</a>
      </div>
    </article>

    <!-- 🃏 BLACKJACK -->
    <article class="card">
      <img class="card-img" src="/assets/bag-blackjack.png" alt="$BAG Blackjack" loading="lazy" decoding="async">
      <div class="card-body">
        <h3>🃏 $BAG Blackjack</h3>
        <p class="meta">21 protocol. Double down or burn your hand.</p>
        <a class="btn" href="/casino/">Play Blackjack (🚧COMING SOON🚧)</a>
      </div>
    </article>
  </section>

<footer class="footer" style="text-align:center; padding:12px 0; line-height:1.6;">
  © 2025 $BAG Protocol | getthebag.io | Powered by $XRP
  <br>
  <a href="https://x.com/getthebag_io" target="_blank" rel="noopener" style="color:#e0c66f;text-decoration:none;font-weight:700;"> 𝕏 @getthebag_io</a> |
  <a href="https://t.me/getthebag_io" target="_blank" rel="noopener" style="color:#e0c66f;text-decoration:none;font-weight:700;">Telegram @getthebag_io</a>
</footer>
</div>

<!-- 🔊 Sound toggle -->
<script>
(function(){
  const btn   = document.getElementById('soundToggle');
  const audio = document.getElementById('casinoAmbience');
  const KEY   = 'bag_sound_pref';
  let playing = false, armed = false;

  audio.setAttribute('playsinline','');
  audio.preload = 'auto';
  audio.loop = true;

  function setIcon(){ btn.textContent = playing ? '🔊' : '🔇'; btn.setAttribute('aria-pressed', String(playing)); }

  async function playAudio(){
    try{
      audio.volume = 0.35;
      await audio.play();
      playing = true; setIcon();
      localStorage.setItem(KEY,'on');
      removeUnlock();
    }catch(e){
      // ignore, browser needs a stronger gesture — keep listeners armed
    }
  }
  function pauseAudio(){ try{ audio.pause(); }catch(_){} playing = false; setIcon(); localStorage.setItem(KEY,'off'); addUnlock(); }

  // Button toggle
  btn.addEventListener('pointerdown', ev => { ev.preventDefault(); playing ? pauseAudio() : playAudio(); }, {passive:false});

  // Unlock on first user interaction of many kinds, including scroll
  const UNLOCK_EVENTS = [
    'scroll','wheel','touchstart','touchmove','mousemove','pointerdown','mousedown','keydown'
  ];
  function unlockHandler(){
    if (localStorage.getItem(KEY) !== 'off' && !playing) playAudio();
  }
  function addUnlock(){
    if (armed) return; armed = true;
    UNLOCK_EVENTS.forEach(t => {
      // use capture to guarantee early fire, once to auto-remove after success
      window.addEventListener(t, unlockHandler, {capture:true, passive:true});
      document.addEventListener(t, unlockHandler, {capture:true, passive:true});
    });
  }
  function removeUnlock(){
    armed = false;
    UNLOCK_EVENTS.forEach(t => {
      window.removeEventListener(t, unlockHandler, {capture:true});
      document.removeEventListener(t, unlockHandler, {capture:true});
    });
  }

  // Soft resume when tab regains focus or becomes visible
  function softResume(){ if (localStorage.getItem(KEY) !== 'off' && !playing) playAudio(); }
  window.addEventListener('focus', softResume);
  document.addEventListener('visibilitychange', () => { if (!document.hidden) softResume(); });

  // Init
  if (localStorage.getItem(KEY) === 'off'){ playing = false; setIcon(); addUnlock(); }
  else { setIcon(); addUnlock(); }
})();
</script>


<!-- ===== COMPLIANCE BLOCK :: $BAG Casino (Hub & Games) ===== -->
<link rel="preconnect" href="https://api.coingecko.com" crossorigin>
<style></style>

<!-- Sticky Responsible Play bar (centered) -->
<div id="respBar" class="comp-row" style="position:sticky;top:0;z-index:999;background:rgba(2,7,3,.85);backdrop-filter:blur(6px);border-bottom:1px solid var(--line);padding:8px 12px;justify-content:center;">
  <span class="comp-pill"><span class="badge-18">21+</span> <small>Play responsibly</small></span>
  <span class="comp-pill"><small>Crypto-only play. No fiat deposits</small></span>
  <div class="comp-links" style="display:flex;gap:14px;justify-content:center;">
    <a href="/support/" rel="noopener">Support</a>
    <a href="/terms/" rel="noopener">Terms</a>
    <a href="/privacy/" rel="noopener">Privacy</a>
  </div>
</div>

<!-- RTP / Odds disclosure -->
<div class="comp-wrap" role="complementary" aria-label="Compliance">
  <div class="comp-grid">
    <div class="comp-rtp">
      <strong>Game disclosure</strong>
      <div id="rtpBlock" class="comp-note"></div>
      <div class="comp-disclaimer">
        $BAG Casino runs on XRPL. All transfers are on-ledger. Crypto carries risk. Never play with funds you cannot lose.
      </div>
    </div>

    <div class="comp-row comp-links">
      <span>Need help</span>
      <a href="https://www.ncpgambling.org/help-treatment/" target="_blank" rel="noopener">NCPG</a>
      <a href="https://gamblersanonymous.org/" target="_blank" rel="noopener">GamCare</a>
      <a href="https://www.gamcare.org.uk/get-support/" target="_blank" rel="noopener">GamCare</a>
      <a href="https://www.begambleaware.org" target="_blank" rel="noopener">BeGambleAware</a>
    </div>

    <div class="comp-note">
      By playing you confirm you are at least 21 years old in the U.S. or the legal minimum age in your region. Availability may be restricted by jurisdiction.
    </div>
  </div>
</div>

<!-- Age Notices -->
<div id="ageMask" class="modal-mask"></div>
<div id="ageModal" class="modal hide" role="dialog" aria-modal="true" aria-labelledby="ageTitle">
  <div class="card age-card" role="document" style="position:relative">
    <h3 id="ageTitle">21+ Notice</h3>
    <p>Are you 21 or older in the U.S. (or of legal age in your region)</p>
    <div class="row">
      <button class="btn comp" id="ageYes">Yes</button>
      <button class="btn comp secondary" id="ageNotNow">Not now</button>
    </div>
  </div>
</div>

<div id="ageWarnMask" class="modal-mask"></div>
<div id="ageWarnModal" class="modal hide" role="dialog" aria-modal="true" aria-labelledby="ageWarnTitle">
  <div class="card age-warn-card" role="document" style="position:relative">
    <h3 id="ageWarnTitle">Heads up</h3>
    <p>
      Online gaming may be restricted where you live. You’re responsible for complying with your local laws.
      If you need help or resources:
      <a href="https://www.ncpgambling.org/help-treatment/" target="_blank" rel="noopener" style="color:var(--gold);font-weight:700;">NCPG</a> ·
      <a href="https://www.begambleaware.org" target="_blank" rel="noopener" style="color:var(--gold);font-weight:700;">BeGambleAware</a>
    </p>
    <div class="row">
      <button class="btn comp" id="ageWarnOk">OK</button>
    </div>
  </div>
</div>

<script>
(function(){
  const KEY_OK = 'bag_age_ack_v1';
  const mask  = document.getElementById('ageMask');
  const modal = document.getElementById('ageModal');
  const yes   = document.getElementById('ageYes');
  const no    = document.getElementById('ageNotNow');
  const wmask  = document.getElementById('ageWarnMask');
  const wmodal = document.getElementById('ageWarnModal');
  const wok    = document.getElementById('ageWarnOk');

  function show(m, mk){ mk.style.display='block'; m.classList.remove('hide'); }
  function hide(m, mk){ mk.style.display='none';  m.classList.add('hide');  }

  if (localStorage.getItem(KEY_OK) !== '1'){ requestAnimationFrame(()=> show(modal, mask)); }
  yes.addEventListener('click', ()=>{ localStorage.setItem(KEY_OK,'1'); hide(modal, mask); });
  no.addEventListener('click', ()=>{ hide(modal, mask); show(wmodal, wmask); });
  wok.addEventListener('click', ()=> hide(wmodal, wmask));

  [mask, wmask].forEach(mk => mk.addEventListener('click', e => e.stopPropagation()));
  document.addEventListener('keydown', function(e){
    if (e.key === 'Escape'){
      if (!modal.classList.contains('hide') || !wmodal.classList.contains('hide')) e.preventDefault();
    }
    const activeModal = !modal.classList.contains('hide') ? modal : (!wmodal.classList.contains('hide') ? wmodal : null);
    if (!activeModal) return;
    if (e.key === 'Tab'){
      const focusables = activeModal.querySelectorAll('button,[href],input,select,textarea,[tabindex]:not([tabindex="-1"])');
      if (!focusables.length) return;
      const first = focusables[0], last = focusables[focusables.length-1];
      if (e.shiftKey && document.activeElement === first){ last.focus(); e.preventDefault(); }
      else if (!e.shiftKey && document.activeElement === last){ first.focus(); e.preventDefault(); }
    }
  });
})();
</script>

</body>
</html>
