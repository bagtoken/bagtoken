<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Showcase Big Wheel â€” Swipe</title>
<style>
  :root{ --bg:#06120d; --felt:#0b1f16; --line:#244b35; }
  html,body{margin:0;background:var(--bg);color:#eaf3ee;font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif}
  .wrap{max-width:980px;margin:0 auto;padding:18px}
  .board{background:linear-gradient(180deg,#0c2218,#091a13);border:1px solid var(--line);
         border-radius:14px;box-shadow:0 10px 30px rgba(0,0,0,.35);padding:14px}
  .marquee{ text-align:center;font-weight:900;letter-spacing:.08em;color:#ffe9a6;
            background:linear-gradient(180deg,#17311f,#0e2419);border:1px solid #254a33;
            border-radius:10px;padding:8px;margin-bottom:8px }
  .stage{position:relative;border-radius:12px;overflow:hidden;background:#0b1f16;border:1px solid #244b35}
  .stage::before{content:"";display:block;padding-top:62%} /* aspect for phones */
  .layer{position:absolute;inset:0}
  #wheel{display:block;width:100%;height:100%}
  #seven{position:absolute;right:10px;top:10px;width:min(40vw,180px);height:min(24vw,110px);z-index:3}
  .row{display:flex;gap:10px;justify-content:center;flex-wrap:wrap;margin-top:10px}
  .btn{padding:14px 18px;border:0;border-radius:12px;font-weight:900;cursor:pointer}
  .spin{background:linear-gradient(180deg,#ffe175,#f5c94c);color:#0b120d;box-shadow:0 5px 0 #b08a19}
  .hold{background:linear-gradient(180deg,#d6f0e2,#cde7d9);color:#0b120d;box-shadow:0 5px 0 #7ba38d}
  .reset{background:linear-gradient(180deg,#c3c7cc,#aeb3b9);color:#0b1016;box-shadow:0 5px 0 #7b8086}
  .t{ text-align:center;margin:10px 0 0 } .t.win{color:#37cf82} .t.lose{color:#e65b5b}
</style>
</head>
<body>
<div class="wrap">
  <h2 style="margin:0 0 10px">ðŸŽ¡ Showcase Big Wheel â€” Swipe</h2>
  <div class="board">
    <div class="marquee">SWIPE DOWN TO SPIN</div>
    <div class="stage">
      <div class="layer"><canvas id="wheel"></canvas></div>
      <canvas id="seven" width="220" height="130"></canvas>
    </div>
    <div class="row">
      <button id="spinBtn" class="btn spin">SPIN</button>
      <button id="holdBtn" class="btn hold">HOLD</button>
      <button id="resetBtn" class="btn reset">RESET</button>
    </div>
    <div id="msg" class="t">Spin up to two times to reach 1.00 without going over.</div>
  </div>
</div>

<script>
(() => {
  // --- canonical order & colors
  const seq=[0.05,0.80,0.35,0.60,0.20,0.45,0.70,0.25,0.90,0.55,0.10,0.95,0.30,0.75,0.50,1.00,0.15,0.40,0.65,0.85];
  const labels=seq.map(v=>v.toFixed(2)); const N=labels.length, TAU=Math.PI*2, STEP=TAU/N;

  // --- elements
  const stage=document.querySelector('.stage');
  const cvs=document.getElementById('wheel'); const ctx=cvs.getContext('2d');
  const seg=document.getElementById('seven'); const msg=document.getElementById('msg');
  const spinBtn=document.getElementById('spinBtn'), holdBtn=document.getElementById('holdBtn'), resetBtn=document.getElementById('resetBtn');
  holdBtn.disabled=true;

  // --- size
  function size(){ const r=stage.getBoundingClientRect(), dpr=Math.min(devicePixelRatio||1,2);
    cvs.width=r.width*dpr; cvs.height=r.height*dpr; cvs.style.width=r.width+'px'; cvs.style.height=r.height+'px';
    ctx.setTransform(dpr,0,0,dpr,0,0); draw(); }
  addEventListener('resize', size);

  // --- draw helpers
  let ang=-Math.PI/2; // top-center slice
  function draw(){
    const w=cvs.width/(devicePixelRatio||1), h=cvs.height/(devicePixelRatio||1);
    ctx.clearRect(0,0,w,h);
    const cx=w/2, cy=h*0.55, R=Math.min(w,h)*0.38;

    // base face
    ctx.save(); ctx.translate(cx,cy);
    ctx.beginPath(); ctx.arc(0,0,R,0,TAU); ctx.fillStyle='#0e1e18'; ctx.fill();

    // grooves
    ctx.strokeStyle='#214d39'; ctx.lineWidth=2;
    for(let i=0;i<N;i++){ ctx.save(); ctx.rotate(i*STEP+STEP/2);
      ctx.beginPath(); ctx.arc(0,0,R-2,-STEP/2+0.01,STEP/2-0.01); ctx.stroke(); ctx.restore(); }

    // pegs
    for(let i=0;i<N;i++){ const a=i*STEP+ang; const x=Math.cos(a)*(R-6), y=Math.sin(a)*(R-6);
      ctx.fillStyle='#d5b55c'; ctx.beginPath(); ctx.arc(x,y,4,0,TAU); ctx.fill(); }

    // number plates
    for(let i=0;i<N;i++){
      const v=labels[i], is100=v==='1.00', isG=(v==='0.05'||v==='0.15'), dark=!is100&&!isG&&(i%2===0);
      const bg=is100?'#b90b0b':isG?'#1b7f3a':(dark?'#121212':'#f1f1f1'); const fg=(is100||isG||dark)?'#f7f7f7':'#151515';
      const a=i*STEP+STEP/2+ang, rx=Math.cos(a)*(R*0.74), ry=Math.sin(a)*(R*0.74), W=R*0.78, H=R*0.38;
      ctx.save(); ctx.translate(rx,ry); ctx.rotate(a+Math.PI/2);
      rr(ctx,-W/2+2,-H/2+2,W-4,H-4,10,bg); // plate
      ctx.lineWidth=8; ctx.strokeStyle='#d5b55c'; rrS(ctx,-W/2+10,-H/2+10,W-20,H-20,10);
      ctx.fillStyle=fg; ctx.textAlign='center'; ctx.textBaseline='middle';
      ctx.font=`900 ${Math.round(H*0.6)}px Inter,Arial,Helvetica,sans-serif`;
      ctx.fillText(is100?'100':String(Math.round(parseFloat(v)*100)),0,4);
      ctx.restore();
    }

    // hub + logo
    ctx.beginPath(); ctx.arc(0,0,R*0.34,0,TAU); ctx.fillStyle='#0b0f10'; ctx.fill();
    ctx.fillStyle='#ffd34d'; ctx.font=`800 ${Math.round(R*0.28)}px Inter,Arial`; ctx.textAlign='center';
    ctx.fillText('$BAG',0,R*0.02);

    // right red flapper
    ctx.restore();
    const flapX=cx+R+16, flapY=cy;
    ctx.fillStyle='#e23a21';
    rr(ctx,flapX-8,flapY-26,16,52,4,'#e23a21');
    ctx.beginPath(); ctx.moveTo(flapX,flapY); ctx.lineTo(flapX+26,flapY+12); ctx.lineTo(flapX+26,flapY-12); ctx.closePath(); ctx.fill();

    drawSeg(currentVal());
  }
  function rr(ctx,x,y,w,h,r,fill){ctx.beginPath();const a=Math.min(r,w/2,h/2);
    ctx.moveTo(x+a,y);ctx.arcTo(x+w,y,x+w,y+h,a);ctx.arcTo(x+w,y+h,x,y+h,a);
    ctx.arcTo(x,y+h,x,y,a);ctx.arcTo(x,y,x+w,y,a);ctx.closePath();ctx.fillStyle=fill;ctx.fill();}
  function rrS(ctx,x,y,w,h,r){ctx.beginPath();const a=Math.min(r,w/2,h/2);
    ctx.moveTo(x+a,y);ctx.arcTo(x+w,y,x+w,y+h,a);ctx.arcTo(x+w,y+h,x,y+h,a);
    ctx.arcTo(x,y+h,x,y,a);ctx.arcTo(x,y,x+w,y,a);ctx.closePath();ctx.stroke();}

  // 7-segment
  function drawSeg(v){ const g=seg.getContext('2d'), w=seg.width, h=seg.height;
    g.clearRect(0,0,w,h); g.fillStyle='#07090b'; g.fillRect(0,0,w,h); g.strokeStyle='#222'; g.lineWidth=6; g.strokeRect(4,4,w-8,h-8);
    const fs=Math.min(88,Math.max(44,Math.floor(h*0.7))); g.fillStyle='#ffe26a'; g.font=`700 ${fs}px "DM Mono",ui-monospace,monospace`;
    g.textAlign='center'; g.textBaseline='middle'; g.fillText(v.toFixed(2),w/2,h/2+2); }

  // physics + interaction
  let vel=0, spinning=false, spin1=null, total=0, done=false;
  const FRICTION=0.992, VMIN=0.003, PIX2RAD=0.012;
  const tick=()=>{ /* simple click; add <audio> if you want sound */ };

  function idxFrom(a){ let t=a%TAU; if(t<0) t+=TAU; const i=Math.floor((t+STEP/2)/STEP)%N; return (N-i)%N; }
  function currentVal(){ return parseFloat(labels[idxFrom(ang)]); }
  function snapTarget(){ const i=idxFrom(ang); const top=(N-i)%N; return top*STEP-STEP/2; }
  function setAngle(a){ const prev=idxFrom(ang); ang=a; const now=idxFrom(ang); if(now!==prev) tick(); draw(); }

  // swipe
  const getY=e=>(e.touches?e.touches[0].clientY:e.clientY);
  let dragging=false,lastY=0,lastT=0,samples=[];
  function down(e){ if(spinning||done) return; dragging=true;samples.length=0;lastY=getY(e);lastT=performance.now(); e.preventDefault();}
  function move(e){ if(!dragging) return; const y=getY(e),t=performance.now(),dy=y-lastY; setAngle(ang+dy*PIX2RAD);
    const dt=t-lastT; if(dt>0){ samples.push(((dy*PIX2RAD)/(dt/1000))); if(samples.length>6)samples.shift(); } lastY=y; lastT=t; e.preventDefault();}
  function up(){ if(!dragging) return; dragging=false; const v=samples.length?samples.reduce((a,b)=>a+b,0)/samples.length:0;
    vel=Math.max(1.2,Math.min(8,Math.abs(v*1.2)))*Math.sign(v||1); startSpin(); }
  cvs.addEventListener('mousedown',down); addEventListener('mousemove',move); addEventListener('mouseup',up);
  cvs.addEventListener('touchstart',down,{passive:false}); addEventListener('touchmove',move,{passive:false}); addEventListener('touchend',up);

  // buttons
  spinBtn.onclick=()=>{ if(spinning||done) return; vel=6; startSpin(); };
  holdBtn.onclick=()=>{ if(spinning||done||spin1==null) return; settleHold(); };
  resetBtn.onclick=reset;

  function startSpin(){ spinning=true; spinBtn.disabled=true; holdBtn.disabled=true; resetBtn.disabled=true;
    msg.className='t'; msg.textContent=(spin1==null)?'Spinning 1â€¦':'Spinning 2â€¦'; loop(); }
  function loop(){ if(!spinning) return; setAngle(ang+vel*(1/60)); vel*=FRICTION;
    if(Math.abs(vel)<VMIN){ const target=snapTarget(); const d=((target-ang+Math.PI*3)%TAU)-Math.PI;
      if(Math.abs(d)>0.0008){ setAngle(ang+d*0.25); requestAnimationFrame(loop); }
      else{ setAngle(target); spinning=false; onSettle(); } }
    else requestAnimationFrame(loop); }

  function onSettle(){
    const landed=currentVal();
    if(spin1==null){ spin1=landed; total=landed; msg.textContent=`Spin 1: ${landed.toFixed(2)} â€” total ${total.toFixed(2)}. Spin again or HOLD.`; holdBtn.disabled=false; resetBtn.disabled=false; spinBtn.disabled=false; return; }
    total+=landed;
    if(total>1.00){ done=true; msg.className='t lose'; msg.textContent=`BUST â€” ${total.toFixed(2)} is over 1.00`; end(0,'Bust'); return; }
    if(total===1.00){ msg.className='t win'; msg.textContent='Exact 1.00 â€” 5Ã—. Bonus spinâ€¦'; bonus(); return; }
    if(total>=0.95) end(1,'Near 1.00'); else end(0,'Under 1.00');
  }
  function settleHold(){ if(total===1.00){ msg.className='t win'; msg.textContent='Exact 1.00 â€” 5Ã—. Bonus spinâ€¦'; bonus(); return; }
    if(total>=0.95) end(1,'Held near 1.00'); else end(0,'Held under 1.00'); }

  function bonus(){ vel=5.3; spinning=true; const loopB=()=>{ setAngle(ang+vel*(1/60)); vel*=FRICTION;
      if(Math.abs(vel)<VMIN){ const v=currentVal(); const extra=(v===0.05)?5:(v===0.15)?15:(v===1.00)?25:0;
        msg.className=extra?'t win':'t'; msg.textContent= extra?`Bonus hit ${v.toFixed(2)} â€” +${extra}Ã—`:`Bonus missed â€” kept base 5Ã—`;
        done=true; resetBtn.disabled=false; spinning=false; } else requestAnimationFrame(loopB); };
    requestAnimationFrame(loopB); }

  function end(mult,label){ done=true; spinBtn.disabled=true; holdBtn.disabled=true; resetBtn.disabled=false;
    msg.className=mult?'t win':'t lose'; msg.textContent = mult?`${label} â€” ${mult.toFixed(2)}Ã—`:`${label} â€” 0Ã—`; }

  function reset(){ spinning=false; spin1=null; total=0; done=false; holdBtn.disabled=true; spinBtn.disabled=false; resetBtn.disabled=false;
    ang=-Math.PI/2; draw(); msg.className='t'; msg.textContent='Spin up to two times to reach 1.00 without going over.'; }

  // init
  size(); ang=-Math.PI/2; draw();
})();
</script>
</body>
</html>
