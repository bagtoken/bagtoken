<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<meta name="format-detection" content="telephone=no" />
<title>BAG Roulette</title>

<style>
  *{box-sizing:border-box}
  :root{
    --gold:#ffe175;--bg:#020703;--panel:#0b1b13;--panel2:#0d2217;--muted:#aeb7af;--fg:#f5f7f4;
    --green:#2fbf6b;--green-600:#249a55;--line:#173524;--shadow:rgba(0,0,0,.35);
    --lose:#e25b5b; --warn:#e8a85c;
  }
  html,body{margin:0;background:var(--bg);color:var(--fg);
    font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;line-height:1.55}
  img{display:block;max-width:100%;height:auto}
  button,input{font-size:16px}
  .back-casino{
    position:fixed;top:18px;left:18px;z-index:1000;
    background:linear-gradient(180deg,#ffe175 0%,#f5c94c 100%);color:#08130d;text-decoration:none;
    font-weight:800;padding:8px 14px;border-radius:10px;box-shadow:0 4px 0 #b08a19}
  .game-header{text-align:center;padding:36px 10px 14px}
  .game-header h2{font-size:clamp(1.6rem,5vw,2.2rem);margin:6px 0 0}
  .game-teaser{padding:10px 16px 60px;background:
    radial-gradient(1200px 600px at 10% -10%, #0e2c1d 0%, transparent 60%),
    radial-gradient(900px 500px at 110% 20%, #0b2318 0%, transparent 55%),#060806;
    border-top:1px solid #131313;border-bottom:1px solid #131313}
  .game-wrap{max-width:1080px;margin:0 auto;display:grid;grid-template-columns:1.12fr .88fr;gap:22px}
  @media (max-width:900px){.game-wrap{grid-template-columns:1fr}}

  .panel{background:linear-gradient(180deg,var(--panel) 0%,var(--panel2) 100%);
    border:1px solid var(--line);border-radius:16px;box-shadow:0 8px 24px var(--shadow)}
  .mock{padding:16px}
  .section-title{font-weight:800;font-size:1.2rem;margin:0 0 12px}
  .stake-box{padding:14px}
  .stack{display:grid;gap:10px}
  .choice{display:flex;gap:10px;flex-wrap:wrap}
  .chip{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:999px;border:1px solid #2b6a48;background:#0e2a1c;color:#e9efe9;font-weight:800}
  .chip input{accent-color:#2fbf6b}
  .mono{font-variant-numeric:tabular-nums}
  .micro{font-size:.85rem;color:#aeb7af}
  .muted{color:#cfd6cf}
  .divider{height:1px;background:#123221;margin:10px 0}

  /* HUD & pills */
  .hudbar{ display:flex; gap:6px; flex-wrap:wrap; align-items:center; margin:6px 2px 0; }
  .pill{ background:#0a1e15; border:1px solid #244330; border-radius:999px; padding:6px 10px; font-size:12px; color:#cfe6d8 }
  #liveDot{margin-right:6px}.ok{color:#2fbf6b}.warn{color:#e8a85c}.err{color:#e25b5b}

  /* Quick Amounts */
  .preset-chips{ display:flex; gap:8px; flex-wrap:wrap; margin-top:8px; }
  .preset-chip{ appearance:none; border:1px solid var(--green-600); background:var(--green); color:#fff;
    border-radius:999px; padding:8px 12px; font-weight:900; letter-spacing:.2px; cursor:pointer; }

  /* Cabinet */
  .cabinet{background:#07140e;border:1px solid #1b4a2f;border-radius:14px;padding:14px}
  .felt{display:grid;grid-template-columns:1fr;gap:12px;background:#091a13;border:1px solid #24533a;border-radius:12px;padding:12px;overflow:hidden}
  .marquee{text-align:center;font-weight:900;letter-spacing:.08em;color:#ffe9a6;background:linear-gradient(180deg,#17311f,#0e2419);
    border:1px solid #254a33;border-radius:12px;padding:8px}

  /* Wheel visuals */
  .wheel-wrap{display:grid;place-items:center;gap:10px;margin-top:4px}
  .wheel-box{width:min(420px,86vw);aspect-ratio:1;position:relative}
  .wheel{width:100%;height:100%}
  .marker{position:absolute;top:-6px;left:50%;transform:translateX(-50%);width:0;height:0;
    border-left:10px solid transparent;border-right:10px solid transparent;border-bottom:14px solid #ffe175;filter:drop-shadow(0 4px 8px rgba(0,0,0,.35))}
  .spin-row{display:flex;justify-content:center}
  .btn-spin{
    width:min(360px,90%);padding:16px 22px;margin-top:2px;font-size:1.15rem;font-weight:900;text-transform:uppercase;letter-spacing:.5px;border:0;border-radius:14px;
    color:#08130d;background:linear-gradient(180deg,#ffe175 0%, #f5c94c 100%);
    box-shadow:0 6px 0 #b08a19, 0 16px 32px rgba(255,225,117,.18), inset 0 1px 0 rgba(255,255,255,.35);
    cursor:pointer;
  }
  .result{margin-top:10px;padding:12px;border:1px solid #1b4a2f;border-radius:12px;background:#0b2217;display:flex;align-items:center;gap:10px}
  .t.win{color:#2fbf6b}.t.lose{color:var(--lose)}

  /* WIN readout (BJ-style box) */
  #roulette-readout{background:var(--panel2);border:1px solid var(--line);border-radius:14px;padding:16px;box-shadow:0 10px 24px var(--shadow);color:var(--fg)}
  #roulette-readout .row{display:flex;justify-content:space-between;gap:12px;margin:8px 0}
  #roulette-readout .note{color:var(--muted);font-size:.92rem;margin-top:10px;line-height:1.45}

  /* Rules FAB */
  .rules-fab{position:fixed;right:16px;bottom:16px;z-index:1000;padding:10px 14px;border-radius:999px;font-weight:800;border:1px solid #2b6a48;background:#0e2a1c;color:#e9efe9}
  .rules-overlay{position:fixed;inset:0;display:none;place-items:center;z-index:3000;backdrop-filter:blur(6px);background:rgba(0,0,0,.45);padding:18px}
  .rules-modal{width:min(680px,92vw);max-height:min(78vh,840px);overflow:auto;background:linear-gradient(180deg,var(--panel) 0%, var(--panel2) 100%);border:1px solid var(--line);border-radius:16px;box-shadow:0 24px 60px var(--shadow);color:var(--fg);padding:18px;position:relative}
  .rules-close{position:absolute;top:8px;right:12px;border:0;background:transparent;color:#e9efe9;font-size:24px;line-height:1;cursor:pointer}
</style>
</head>
<body>

<a href="/casino/" class="back-casino">‚¨ÖÔ∏è Back to Casino</a>

<section class="game-header">
  <h2>üé° $BAG ROULETTE ‚Äî Even Money (RED)</h2>
  <p class="micro" style="margin-top:4px;opacity:.9;">üí∞ <strong>Payouts settle in $BAG.</strong> $XRP bets auto-convert at the live rate.</p>
</section>

<section class="game-teaser">
  <div class="game-wrap">

    <!-- LEFT: identical control stack -->
    <div class="panel mock">
      <!-- CONNECT (visual only in demo) -->
      <div style="display:flex;justify-content:space-between;align-items:center;margin:-2px 0 10px;">
        <div class="micro" id="connectStatus">Wallet: <span style="color:#e8a85c">not connected</span></div>
        <button id="connectBtn" style="padding:10px 14px;font-weight:800;border:0;border-radius:12px;color:#08130d;background:linear-gradient(180deg,#ffe175 0%, #f5c94c 100%);box-shadow:0 4px 0 #b08a19;cursor:pointer;">Connect Xaman</button>
      </div>

      <!-- SESSION -->
      <div style="display:flex;justify-content:space-between;align-items:center;margin:6px 0 10px;">
        <div id="sessionStatus" class="micro" style="opacity:.9">Session: <span style="color:#2fbf6b">Practice:</span></div>
        <div style="display:flex;gap:8px;align-items:center">
          <button id="startSessionBtn" style="padding:8px 12px;font-weight:800;border:0;border-radius:10px;color:#08130d;background:linear-gradient(180deg,#ffe175 0%, #f5c94c 100%);box-shadow:0 3px 0 #b08a19;cursor:pointer;">Start Session</button>
          <button id="topUpBtn" style="padding:8px 12px;font-weight:800;border:0;border-radius:10px;color:#08130d;background:linear-gradient(180deg,#ffe175 0%, #f5c94c 100%);box-shadow:0 3px 0 #b08a19;cursor:pointer;display:none;">Top Up</button>
          <button id="endSessionBtn" style="padding:8px 12px;font-weight:800;border:0;border-radius:10px;background:#15261c;color:#dfe9e2;border:1px solid #2b6a48;cursor:pointer;display:none;">End</button>
        </div>
      </div>

      <div class="section-title">Stake & Prices</div>
      <div class="stake-box">
        <div class="stack">
          <div>
            <div class="micro">Amount</div>
            <div style="display:flex;gap:10px;flex-wrap:wrap;align-items:center">
              <div style="display:flex;align-items:center;gap:6px">
                <input id="usdBet" class="mono" type="number" inputmode="decimal" enterkeyhint="done" min="0" max="2000" step="0.01" placeholder="0.00" style="width:140px;background:#0b2217;border:1px solid #1b4a2f;border-radius:10px;color:#f3f5f0;padding:10px">
                <span class="micro" aria-hidden="true">USD</span>
              </div>
            </div>
            <div class="preset-chips" id="usdPresets">
              <button type="button" class="preset-chip" data-usd="1">$1</button>
              <button type="button" class="preset-chip" data-usd="2">$2</button>
              <button type="button" class="preset-chip" data-usd="5">$5</button>
              <button type="button" class="preset-chip" data-usd="10">$10</button>
              <button type="button" class="preset-chip" data-usd="20">$20</button>
              <button type="button" class="preset-chip" data-usd="50">$50</button>
              <button type="button" class="preset-chip" data-usd="100">$100</button>
              <button type="button" class="preset-chip" data-usd="max">Max</button>
            </div>
          </div>

          <div>
            <div class="micro">Bet currency</div>
            <div class="choice" id="curToggle">
              <label class="chip"><input type="radio" name="betCur" value="XRP" checked> XRP</label>
              <label class="chip"><input type="radio" name="betCur" value="BAG"> BAG</label>
            </div>
          </div>

          <div>
            <div class="micro">Bet amount</div>
            <div style="display:flex;gap:10px;flex-wrap:wrap;align-items:center">
              <div>
                <input id="betQty" class="mono" type="number" inputmode="decimal" enterkeyhint="done" min="0" step="any" value="1" style="width:140px;background:#0b2217;border:1px solid #1b4a2f;border-radius:10px;color:#f3f5f0;padding:10px">
                <span class="unit">XRP</span>
              </div>
            </div>
            <div class="micro" id="betLimits" style="margin-top:6px"></div>
          </div>

          <div class="divider"></div>

          <div class="micro">Live prices</div>
          <div class="muted mono">
            <span id="liveDot" class="warn">‚óè</span>
            <span> BAG $<span id="liveBAG">0.0200</span> ¬∑ XRP $<span id="liveXRP">1.00</span> <span id="liveNote"> (demo cache)</span></span>
            <div class="micro" id="liveConv" style="margin-top:4px;opacity:.9;">1 BAG ‚âà 0.0200 XRP ¬∑ 1 XRP ‚âà 50.0000 BAG</div>
          </div>
        </div>
      </div>

      <div class="divider"></div>

      <div id="roulette-readout" class="mono" aria-live="polite"></div>
    </div>

    <!-- RIGHT: cabinet with real wheel -->
    <div class="panel" style="padding:16px">
      <div class="marquee">$BAG ROULETTE</div>
      <div class="cabinet">
        <div class="felt">
          <div class="wheel-wrap">
            <div class="wheel-box">
              <div class="marker" aria-hidden="true"></div>
              <svg class="wheel" viewBox="-1 -1 2 2">
                <g id="wheelG" transform="rotate(0)">
                  <!-- wedges injected by JS -->
                  <circle cx="0" cy="0" r="1" fill="none" stroke="#222" stroke-width="0.02"/>
                  <circle cx="0" cy="0" r="0.85" fill="#0c1711" stroke="#2b6a48" stroke-width="0.015"/>
                </g>
                <circle cx="0" cy="0" r="0.06" fill="#111" stroke="#555" stroke-width="0.01"/>
              </svg>
            </div>
            <div class="wheel-readout mono" style="display:flex;gap:10px;align-items:center;justify-content:center">
              <span id="badge" style="font-weight:900;padding:6px 10px;border-radius:999px;border:1px solid #2b6a48;background:#0e2a1c;color:#e9efe9">‚Äî</span>
              <span id="wheelNumber">Waiting‚Ä¶</span>
            </div>
          </div>

          <div class="spin-row"><button id="spinBtn" class="btn-spin">SPIN</button></div>

          <div class="hudbar" id="rouletteHud">
            <span class="pill">Mode: <b id="modeLbl">Demo</b></span>
            <span class="pill">Balance: <b id="balLbl">‚Äî</b> <span id="ccyLbl">BAG</span></span>
            <span class="pill">Bet: <b id="betLbl">1</b></span>
            <span class="pill">Last: <b id="lastLbl">‚Äî</b></span>
          </div>

          <p class="micro" style="text-align:center;margin-top:8px;opacity:.75;">
            üîä If you don't hear sound: tap SPIN once, turn off Silent mode, and raise volume.
          </p>

          <div class="result"><div class="t" id="spinText" role="status" aria-live="polite">Bet: RED (1:1) ‚Äî tap SPIN</div></div>
        </div>
      </div>
    </div>

  </div>
</section>

<!-- Rules -->
<button class="rules-fab" id="rulesFab">‚ÑπÔ∏è Rules</button>
<div class="rules-overlay" id="rulesOverlay" role="dialog" aria-modal="true">
  <div class="rules-modal">
    <button class="rules-close" id="rulesClose" aria-label="Close">√ó</button>
    <h3>üé° Roulette ‚Äî Quick Rules</h3>
    <ul>
      <li><b>Wheel:</b> American (0 and 00, 38 pockets).</li>
      <li><b>Default bet:</b> <b>RED</b> even-money. Win on red numbers. Lose on black or green (0/00).</li>
      <li><b>Payout:</b> 2.00√ó when RED hits (stake returned + profit).</li>
      <li><b>Settle:</b> payouts are in <b>$BAG</b>. $XRP stakes auto-convert at the live rate.</li>
    </ul>
    <div class="micro" style="color:#aeb7af">Practice is slightly friendlier than live. No pushes on color.</div>
  </div>
</div>

<script>
/* ----------------------------- PRICES (demo) ----------------------------- */
const PRICES = { bagUsd: 0.02, xrpUsd: 1.00, source:'demo' };
function fmt(n, max=6){ const x=Number(n); if(!Number.isFinite(x)) return '‚Äî'; return x.toLocaleString(undefined,{maximumFractionDigits:max}); }
(function updateLive(){
  const liveDot=document.getElementById('liveDot');
  const liveBAG=document.getElementById('liveBAG');
  const liveXRP=document.getElementById('liveXRP');
  const liveConv=document.getElementById('liveConv');
  const liveNote=document.getElementById('liveNote');
  liveBAG.textContent = PRICES.bagUsd.toFixed(4);
  liveXRP.textContent = PRICES.xrpUsd.toFixed(2);
  liveNote.textContent = ' (demo cache)';
  liveDot.className='warn';
  liveConv.textContent = `1 BAG ‚âà ${(PRICES.bagUsd/PRICES.xrpUsd).toFixed(4)} XRP ¬∑ 1 XRP ‚âà ${(PRICES.xrpUsd/PRICES.bagUsd).toFixed(4)} BAG`;
  window.dispatchEvent(new CustomEvent('bag:pricesUpdated'));
})();

/* ----------------------- QUICK AMOUNTS + STAKE WIRE ---------------------- */
(function(){
  const usdEl   = document.getElementById('usdBet');
  const qtyEl   = document.getElementById('betQty');
  const curRoot = document.getElementById('curToggle');
  const unitEls = document.querySelectorAll('.unit');
  const limits  = document.getElementById('betLimits');

  function getCur(){ const el=curRoot.querySelector('input[name="betCur"]:checked'); return el?el.value.toUpperCase():'XRP'; }
  function priceFor(cur){ return cur==='BAG' ? PRICES.bagUsd : PRICES.xrpUsd; }
  function writeUsd(u){ usdEl.value = u ? (Math.round(u*100)/100).toFixed(2) : ''; }
  function writeQty(q){ qtyEl.value = q ? Number(q).toFixed(6).replace(/\.?0+$/,'') : ''; }
  function readUsd(){ const v=parseFloat(usdEl.value||''); return Number.isFinite(v)&&v>0?v:0; }
  function readQty(){ const v=parseFloat(qtyEl.value||''); return Number.isFinite(v)&&v>0?v:0; }
  function paintUnits(){ unitEls.forEach(s=> s.textContent=getCur()); }
  function renderLimits(){
    const min=1, max=2000;
    const px = priceFor(getCur());
    const u = readUsd() || (readQty()*px) || 0;
    const warn = (u>0 && u<min) ? ` ¬∑ <span style="color:#e8a85c">Min $${min.toFixed(2)}</span>` :
                (u>max) ? ` ¬∑ <span style="color:#e8a85c">Max $${max.toFixed(2)}</span>` : '';
    limits.innerHTML = `Limits: $${min.toFixed(2)}‚Äì$${max.toFixed(2)} ¬∑ Your stake ‚âà $${u.toFixed(2)}${warn}`;
  }
  function syncFromUSD(){
    const px=priceFor(getCur()); const usd=readUsd();
    if(usd && px>0) writeQty(usd/px); else if(!usd) writeQty('');
    renderLimits(); window.dispatchEvent(new CustomEvent('bag:hudRefresh'));
  }
  function syncFromQty(){
    const px=priceFor(getCur()); const qty=readQty();
    if(qty && px>0) writeUsd(qty*px); else if(!qty) writeUsd('');
    renderLimits(); window.dispatchEvent(new CustomEvent('bag:hudRefresh'));
  }
  usdEl.addEventListener('input', syncFromUSD);
  qtyEl.addEventListener('input', syncFromQty);
  curRoot.addEventListener('change', ()=>{ paintUnits(); syncFromQty(); });

  document.querySelectorAll('#usdPresets .preset-chip').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      const v = btn.getAttribute('data-usd');
      let usd = 0;
      if(v==='max'){ usd = 2000; } else { usd = parseFloat(v)||0; }
      writeUsd(usd); syncFromUSD();
    });
  });

  paintUnits(); syncFromQty();
})();

/* ----------------------------- DEMO SESSION ------------------------------ */
(function(){
  const statusEl  = document.getElementById('sessionStatus');
  const startBtn  = document.getElementById('startSessionBtn');
  const topUpBtn  = document.getElementById('topUpBtn');
  const endBtn    = document.getElementById('endSessionBtn');
  const DEMO_BAL_KEY='__bag_demo_bag_v2'; const DEMO_INIT_KEY='__bag_demo_init_v2'; const START_USD=2000;

  function fmtUsd(n){ return '$'+(Number(n)||0).toLocaleString(undefined,{minimumFractionDigits:2,maximumFractionDigits:2}); }
  function fmt(n){ const x=Number(n)||0; return x.toLocaleString(undefined,{maximumFractionDigits:6}); }
  function getBag(){ try{ const n=Number(localStorage.getItem(DEMO_BAL_KEY)); return Number.isFinite(n)&&n>0?n:0; }catch{ return 0; } }
  function setBag(v){ try{ localStorage.setItem(DEMO_BAL_KEY, String(Math.max(0,Number(v)||0))); }catch{} }

  function ensureSeed(){
    if(localStorage.getItem(DEMO_INIT_KEY)) return true;
    const startBag = START_USD / PRICES.bagUsd; // 2000 / 0.02 = 100,000 BAG
    setBag(startBag); localStorage.setItem(DEMO_INIT_KEY,'1'); return true;
  }

  function render(){
    const bag=getBag();
    const usd=bag*PRICES.bagUsd;
    statusEl.innerHTML = `Session: <span style="color:#2fbf6b">Practice</span> ‚Äî BAG: <b style="color:#2fbf6b">${fmt(bag)}</b> ¬∑ USD: <b>${fmtUsd(usd)}</b>`;
    window.dispatchEvent(new CustomEvent('bag:hudRefresh'));
  }

  window.__bagSession = {
    active:()=>true,
    get:()=>({addr:'demo', bag:getBag(), ts:Date.now()}),
    spend(b){ const cur=getBag(); if(!(b>0)||cur<b) return false; setBag(cur-b); render(); return true; },
    credit(b){ if(!(b>0)) return false; setBag(getBag()+b); render(); return true; }
  };
  ensureSeed(); render();

  startBtn.addEventListener('click', ()=>{ ensureSeed(); render(); });
  topUpBtn.addEventListener('click', ()=>{ localStorage.removeItem(DEMO_INIT_KEY); ensureSeed(); render(); });
  endBtn.addEventListener('click', ()=>{ /* keep demo alive */ render(); });
})();

/* --------------------------------- HUD ---------------------------------- */
(function(){
  const curToggle = document.getElementById('curToggle');
  function selectedMode(){ return 'Demo'; }
  function getCur(){ const el=curToggle.querySelector('input[name="betCur"]:checked'); return el?el.value.toUpperCase():'XRP'; }
  function getBalances(){
    const sess=(window.__bagSession && window.__bagSession.get && window.__bagSession.get())||{};
    const bag=Number(sess.bag)||0;
    const xrp = bag*(PRICES.bagUsd/PRICES.xrpUsd);
    return {bag,xrp};
  }
  function currentBet(){
    const v=parseFloat(document.getElementById('betQty').value||'0');
    return Number.isFinite(v)&&v>0?v:0;
  }
  function render(){
    const modeLbl=document.getElementById('modeLbl');
    const balLbl=document.getElementById('balLbl');
    const ccyLbl=document.getElementById('ccyLbl');
    const betLbl=document.getElementById('betLbl');
    const lastLbl=document.getElementById('lastLbl');
    const {bag,xrp}=getBalances(); const cur=getCur();
    if(modeLbl) modeLbl.textContent=selectedMode();
    if(betLbl)  betLbl.textContent=fmt(currentBet(),6);
    if(lastLbl) lastLbl.textContent=String(window.__ROUL_LAST__||'‚Äî');
    if(cur==='XRP'){ balLbl.textContent=fmt(xrp,6); ccyLbl.textContent='XRP'; }
    else { balLbl.textContent=fmt(bag,6); ccyLbl.textContent='BAG'; }
  }
  ['bag:hudRefresh','bag:pricesUpdated','storage'].forEach(ev=>addEventListener(ev,render));
  document.getElementById('betQty').addEventListener('input',render);
  curToggle.addEventListener('change',render);
  function fmt(n,max=6){ const x=Number(n); if(!Number.isFinite(x)) return '‚Äî'; return x.toLocaleString(undefined,{maximumFractionDigits:max}); }
  render();
})();

/* ------------------------------ WHEEL BUILD ------------------------------ */
(function(){
  // American sequence + color map you locked
  const SEQ=["00",27,10,25,29,12,8,19,31,18,6,21,33,16,4,23,35,14,2,0,28,9,26,30,11,7,20,32,17,5,22,34,15,3,24,36,13,1];
  const RED=new Set([1,3,5,7,9,12,14,16,18,19,21,23,25,27,30,32,34,36]);
  const BLACK=new Set([2,4,6,8,10,11,13,15,17,20,22,24,26,28,29,31,33,35]);

  const g=document.getElementById('wheelG');
  const wedgeCount = SEQ.length; // 38
  const step = 360/wedgeCount;

  // draw wedges
  for(let i=0;i<wedgeCount;i++){
    const slot=SEQ[i];
    const col = (slot===0||slot==="00") ? '#0f5132' : (RED.has(slot)?'#7c1217':'#0f1013');
    const a0 = (i*step-90) * Math.PI/180; // start angle
    const a1 = ((i+1)*step-90) * Math.PI/180;
    const rOuter=0.99, rInner=0.87;
    const x0=Math.cos(a0)*rOuter, y0=Math.sin(a0)*rOuter;
    const x1=Math.cos(a1)*rOuter, y1=Math.sin(a1)*rOuter;
    const x2=Math.cos(a1)*rInner, y2=Math.sin(a1)*rInner;
    const x3=Math.cos(a0)*rInner, y3=Math.sin(a0)*rInner;
    const path=`M ${x0} ${y0} A ${rOuter} ${rOuter} 0 0 1 ${x1} ${y1} L ${x2} ${y2} A ${rInner} ${rInner} 0 0 0 ${x3} ${y3} Z`;
    const p=document.createElementNS('http://www.w3.org/2000/svg','path');
    p.setAttribute('d',path); p.setAttribute('fill',col); p.setAttribute('stroke','#111'); p.setAttribute('stroke-width','0.004');
    g.appendChild(p);

    // labels
    const aMid=( (i+0.5)*step-90 )*Math.PI/180;
    const rx=Math.cos(aMid)*0.93, ry=Math.sin(aMid)*0.93;
    const t=document.createElementNS('http://www.w3.org/2000/svg','text');
    t.setAttribute('x',rx); t.setAttribute('y',ry+0.02);
    t.setAttribute('text-anchor','middle'); t.setAttribute('font-size','0.07');
    t.setAttribute('fill','#ffe175'); t.setAttribute('font-weight','700');
    t.textContent=String(slot);
    g.appendChild(t);
  }

  // Spin logic (even-money RED bet)
  const spinBtn=document.getElementById('spinBtn');
  const spinText=document.getElementById('spinText');
  const badge=document.getElementById('badge');
  const nEl=document.getElementById('wheelNumber');

  // Demo tilt slightly > live odds for feel
  const DEMO_HIT=20/38; const LIVE_HIT=18/38;
  const useDemo = true;

  function pickSlot(){
    const want = useDemo ? DEMO_HIT : LIVE_HIT;
    const roll = Math.random();
    let color;
    if (roll < want) color = 'red';
    else color = (Math.random() < (2/38)) ? 'green' : 'black';
    let pool;
    if(color==='red') pool = SEQ.filter(x=>RED.has(x));
    else if(color==='black') pool = SEQ.filter(x=>BLACK.has(x));
    else pool = [0,"00"];
    return pool[(Math.random()*pool.length)|0];
  }
  function colorOf(slot){ if(slot===0||slot==="00") return 'GREEN'; if(RED.has(slot)) return 'RED'; return 'BLACK'; }

  // session helpers
  function spend(b){ try{ return window.__bagSession.spend(b); }catch{ return false; } }
  function credit(b){ try{ return window.__bagSession.credit(b); }catch{ return false; } }

  function currentStakeBag(){
    const q=parseFloat(document.getElementById('betQty').value||0)||0;
    const cur=document.querySelector('#curToggle input[name="betCur"]:checked').value.toUpperCase();
    if(cur==='BAG') return q; // direct BAG
    // XRP ‚Üí BAG using demo prices
    return q*(PRICES.xrpUsd/PRICES.bagUsd);
  }
  function currentStakeUsd(){
    const usd=parseFloat(document.getElementById('usdBet').value||'');
    if(Number.isFinite(usd)&&usd>0) return usd;
    const q=parseFloat(document.getElementById('betQty').value||0)||0;
    const cur=document.querySelector('#curToggle input[name="betCur"]:checked').value.toUpperCase();
    return (cur==='BAG') ? q*PRICES.bagUsd : q*PRICES.xrpUsd;
  }

  function setBadge(col, num){
    badge.textContent = col;
    badge.style.background = col==='RED' ? '#2a0f13' : col==='BLACK' ? '#0f1013' : '#0f2a17';
    badge.style.borderColor = col==='RED' ? '#6b1e28' : col==='BLACK' ? '#2b2c31' : '#2b6a48';
    nEl.textContent = String(num);
  }

  function rotateToSlot(slot){
    const idx = SEQ.indexOf(slot);
    const step = 360 / SEQ.length;
    // Bring chosen slot to the 12 o‚Äôclock marker (triangle)
    const targetDeg = -(idx*step);
    const extraSpins = 6 + Math.floor(Math.random()*3); // 6‚Äì8 spins
    const final = targetDeg - 360*extraSpins;
    g.style.transition = 'transform 2.6s cubic-bezier(.15,.9,.1,1)';
    g.style.transform = `rotate(${final}deg)`;
  }

  function sWin(){ try{ /* quick beep via WebAudio optional */ }catch{} }
  function sLose(){ try{}catch{} }

  window.__ROUL_LAST__ = '‚Äî';

  spinBtn.addEventListener('click', async ()=>{
    const sBag = currentStakeBag();
    const sUsd = currentStakeUsd();
    if (sUsd < 1){ alert('Minimum $1 stake'); return; }
    if (!(sBag>0)){ alert('Enter a stake first'); return; }
    if (!spend(sBag)){ alert('Insufficient balance'); return; }

    spinBtn.disabled = true;
    spinText.className='t';
    spinText.textContent='Spinning‚Ä¶';

    // reset transition to allow multiple spins
    g.style.transition='none';
    // tiny reflow
    g.getBoundingClientRect();

    const slot = pickSlot();
    rotateToSlot(slot);

    await new Promise(r=>setTimeout(r, 2700));

    const col = colorOf(slot);
    setBadge(col, slot);

    if (col==='RED'){
      sWin();
      credit(sBag * 2.00);
      spinText.className='t win';
      spinText.textContent='WIN ‚Äî RED hits (2.00√ó)';
      window.__ROUL_LAST__ = `RED ${slot}`;
    } else {
      sLose();
      spinText.className='t lose';
      spinText.textContent = `Lose ‚Äî ${col} ${slot}`;
      window.__ROUL_LAST__ = `${col} ${slot}`;
    }
    window.dispatchEvent(new CustomEvent('bag:hudRefresh'));
    spinBtn.disabled = false;
  });
})();

/* ------------------------------ Rules modal ------------------------------ */
(function(){
  const fab=document.getElementById('rulesFab');
  const ov=document.getElementById('rulesOverlay');
  const x=document.getElementById('rulesClose');
  function open(){ ov.style.display='grid'; }
  function close(){ ov.style.display='none'; }
  fab.addEventListener('click',open); x.addEventListener('click',close);
  ov.addEventListener('click',(e)=>{ if(e.target===ov) close(); });
  addEventListener('keydown',(e)=>{ if(e.key==='Escape') close(); });
})();
</script>

<footer class="footer" style="text-align:center; padding:12px 0; line-height:1.6;">
  ¬© 2025 $BAG Protocol | getthebag.io | Powered by $XRP
  <br>
  <a href="https://x.com/getthebag_io" target="_blank" rel="noopener" style="color:#e0c66f;text-decoration:none;font-weight:700;">ùïè @getthebag_io</a>
  &nbsp;|&nbsp;
  <a href="https://t.me/getthebag_io" target="_blank" rel="noopener" style="color:#e0c66f;text-decoration:none;font-weight:700;">Telegram @getthebag_io</a>
</footer>
</body>
</html>
