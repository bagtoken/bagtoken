<script>
(function(){
  function PR(){ return window.__PRICES__ || { bagUsd:0, xrpUsd:0 }; }
  function fmt(n, max=6){ const x=Number(n); if(!Number.isFinite(x)) return '—'; return x.toLocaleString(undefined,{maximumFractionDigits:max}); }
  function cur(){ const el=document.querySelector('#curToggle input[name="betCur"]:checked'); return el?String(el.value).toUpperCase():'XRP'; }
  function balances(){
    const sess = (window.__bagSession && window.__bagSession.get && window.__bagSession.get()) || {};
    const bag = Number(sess.bag)||0;
    let xrp = Number(sess.xrp);
    if (!(xrp > 0)) {
      const { bagUsd, xrpUsd } = PR();
      xrp = (bagUsd>0 && xrpUsd>0) ? bag * (bagUsd/xrpUsd) : 0;
    }
    return {bag,xrp};
  }
  function render(){
    const balLbl=document.getElementById('balLbl'), ccyLbl=document.getElementById('ccyLbl'), betLbl=document.getElementById('betLbl'), modeLbl=document.getElementById('modeLbl');
    const {bag,xrp} = balances(); const c=cur();
    if (modeLbl) modeLbl.textContent = (window.__BAG_FORCE_DEMO ? 'DEMO' : 'LIVE');
    if (ccyLbl) ccyLbl.textContent = c;
    if (balLbl) balLbl.textContent = fmt(c==='XRP'?xrp:bag);
    if (betLbl){ const v=parseFloat(document.getElementById('betQty')?.value||'0'); betLbl.textContent = (c==='BAG'?Math.floor(v):Math.floor(v*1e6)/1e6); }
  }
  ['input','change'].forEach(ev=>{
    document.getElementById('betQty')?.addEventListener(ev, render);
    document.getElementById('curToggle')?.addEventListener(ev, render);
  });
  addEventListener('bag:pricesUpdated', render);
  addEventListener('bag:sessionToppedUp', render);
  addEventListener('bag:sessionSpent', render);
  render();
})();
</script>

<script>
(function(){
  const pill = document.getElementById('rulesPill');
  const modal = document.getElementById('rulesModal');
  const close = document.getElementById('rulesClose');
  function open(){ modal.style.display='block'; pill.setAttribute('aria-expanded','true'); }
  function hide(){ modal.style.display='none'; pill.setAttribute('aria-expanded','false'); }
  pill?.addEventListener('click', open);
  close?.addEventListener('click', hide);
  modal?.addEventListener('click', (e)=>{ if (e.target===modal) hide(); });
  addEventListener('keydown', (e)=>{ if (e.key==='Escape') hide(); });
})();
</script>

<script>
(function(){function setVW(){var vw=Math.min(window.innerWidth||0,document.documentElement.clientWidth||0);document.documentElement.style.setProperty('--vwpx',vw+'px');}setVW();addEventListener('resize',setVW);addEventListener('orientationchange',setVW);}());
</script>

<footer class="footer" style="text-align:center; padding:12px 0; line-height:1.6; width:100%; margin:0 auto;">
  © 2025 $BAG Protocol | getthebag.io | Powered by $XRP
  <br>
  <a href="https://x.com/getthebag_io" target="_blank" rel="noopener" style="color:#e0c66f;text-decoration:none;font-weight:700;">𝕏 @getthebag_io</a> |
  <a href="https://t.me/getthebag_io" target="_blank" rel="noopener" style="color:#e0c66f;text-decoration:none;font-weight:700;">Telegram @getthebag_io</a>
</footer>

</body>
</html>
