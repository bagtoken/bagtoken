<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<meta name="format-detection" content="telephone=no" />
<title>BAG Dice ‚Äî Pass Line</title>

<link rel="preconnect" href="https://api.coingecko.com" crossorigin>
<script src="https://xaman.app/assets/cdn/xumm.min.js"></script>
<script>window.__BAG_FORCE_DEMO = false;</script>

<script>
(function(){
  const qs=new URLSearchParams(location.search);
  if(qs.get('three')!=='1') return;
  function load(src, ok, fail){
    var s=document.createElement('script');
    s.src=src; s.async=true; s.onload=ok; s.onerror=fail; document.head.appendChild(s);
  }
  load('https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.min.js',
    ()=>window.__THREE_READY__=true,
    ()=>{
      console.warn('[bag-dice] jsDelivr failed, trying unpkg');
      load('https://unpkg.com/three@0.158.0/build/three.min.js',
        ()=>window.__THREE_READY__=true,
        ()=>{console.error('[bag-dice] three.js failed');window.__THREE_FAILED__=true;}
      );
    });
})();
</script>

<style>
*{box-sizing:border-box}
:root{
  --gold:#ffe175;--bg:#020703;--panel:#0b1b13;--panel2:#0d2217;
  --muted:#aeb7af;--fg:#f5f7f4;--green:#2fbf6b;--green-600:#249a55;
  --line:#173524;--shadow:rgba(0,0,0,.35);--lose:#e25b5b;--warn:#e8a85c;
}
html,body{margin:0;background:var(--bg);color:var(--fg);
  font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;line-height:1.55}
img{display:block;max-width:100%;height:auto}
button,input{font-size:16px}
a[x-apple-data-detectors]{color:inherit!important;text-decoration:none!important;pointer-events:none!important;cursor:default!important}

.back-casino{
  position:fixed;top:18px;left:18px;z-index:1000;
  background:linear-gradient(180deg,#ffe175 0%,#f5c94c 100%);
  color:#08130d;text-decoration:none;font-weight:800;padding:8px 14px;border-radius:10px;
  box-shadow:0 4px 0 #b08a19;transition:all .15s ease;
}
.back-casino:hover{filter:brightness(1.05)}
.back-casino:active{transform:translateY(1px)}

.game-header{text-align:center;padding:36px 10px 14px}
.game-header img.hero-img{margin:0 auto 10px;filter:drop-shadow(0 10px 24px rgba(46,191,107,.18))}
.game-header h2{font-size:clamp(1.6rem,5vw,2.2rem);margin:6px 0 0}
@media (min-width:900px){.game-header img.hero-img{width:34vw;max-width:420px;margin:auto}}

.game-teaser{padding:10px 16px 60px;
  background:radial-gradient(1200px 600px at 10% -10%,#0e2c1d 0%,transparent 60%),
             radial-gradient(900px 500px at 110% 20%,#0b2318 0%,transparent 55%),#060806;
  border-top:1px solid #131313;border-bottom:1px solid #131313}
.game-wrap{max-width:1080px;margin:auto;display:grid;gap:22px}
.panel{background:linear-gradient(180deg,var(--panel) 0%,var(--panel2) 100%);
  border:1px solid var(--line);border-radius:16px;box-shadow:0 8px 24px var(--shadow)}
.pad{padding:16px}
.table{background:#07140e;border:1px solid #1b4a2f;border-radius:14px;padding:14px}
.felt{display:grid;gap:12px;background:#091a13;border:1px solid #24533a;
  border-radius:12px;padding:12px;overflow:hidden}

/* === 3D FELT BACKGROUND === */
.stage3d{height:260px;position:relative;border-radius:10px;overflow:hidden}
.stage3d .table-bg{position:absolute;inset:0;width:100%;height:100%;
  object-fit:cover;z-index:0;filter:brightness(1.05)}
.cssstage{position:relative;z-index:1}

.roll-row{text-align:center;margin-top:10px}
.btn-roll{background:var(--green);border:none;border-radius:10px;
  padding:12px 24px;font-weight:700;color:#fff;
  box-shadow:0 4px 0 #1a6a3f;transition:all .15s ease;cursor:pointer}
.btn-roll:hover{filter:brightness(1.1)}
.btn-roll:active{transform:translateY(1px)}
.result{margin-top:10px;padding:12px;border:1px solid #1b4a2f;border-radius:12px;
  background:#0b2217;display:flex;align-items:center;gap:10px}
.t.win{color:#2fbf6b}.t.scratch{color:#e8a85c}.t.lose{color:var(--lose)}
</style>

  </head>
<body>
<a href="/casino/" class="back-casino">‚¨ÖÔ∏è Back to Casino</a>

<!-- üèÅ Game Header -->
<section class="game-header">
  <picture>
    <source type="image/webp"
      srcset="/assets/bag-dice-960.webp 960w, /assets/bag-dice-1024.webp 1024w"
      sizes="(min-width:900px) 420px, 70vw">
    <img class="hero-img"
      src="/assets/bag-dice-1024.png"
      srcset="/assets/bag-dice-960.png 960w, /assets/bag-dice-1024.png 1024w"
      sizes="(min-width:900px) 420px, 70vw"
      alt="$BAG Dice" loading="lazy" decoding="async">
  </picture>
  <h2>üé≤ $BAG DICE ‚Äî Pass Line</h2>
  <p style="opacity:.9;">üí∞ All payouts are in $BAG. $XRP bets convert automatically at live rate.</p>
</section>

<!-- üéØ Game Body -->
<section class="game-teaser">
  <div class="game-wrap">
    <div class="panel pad">

      <div class="table">
        <div class="felt">

          <!-- ‚úÖ 3D Green Felt Table Integrated -->
          <div id="dice3d" class="stage3d" aria-label="3D dice area">
            <picture>
              <source type="image/webp"
                srcset="/casino/assets/img/green-felt-3d-960.webp 960w, /casino/assets/img/green-felt-3d-1024.webp 1024w"
                sizes="100vw">
              <img class="table-bg"
                src="/casino/assets/img/green-felt-3d-1024.png"
                srcset="/casino/assets/img/green-felt-3d-960.png 960w, /casino/assets/img/green-felt-3d-1024.png 1024w"
                sizes="100vw"
                alt="Dice table surface"
                width="1024" height="1024"
                loading="lazy" decoding="async">
            </picture>

            <div class="cssstage">
              <div class="dice-row">
                <div class="die dieA" id="dieA"></div>
                <div class="die dieB" id="dieB"></div>
              </div>
            </div>
          </div>

          <div class="roll-row">
            <button id="rollBtn" class="btn-roll">ROLL</button>
          </div>

          <div class="result">
            <div class="t" id="rollText">
              Come-out roll ‚Äî Need 7 or 11 to WIN ¬∑ 2/3/12 is CRAPS ¬∑ otherwise sets the Point
            </div>
          </div>

        </div><!-- felt -->
      </div><!-- table -->

      <!-- HUD -->
      <div class="hud" id="hud">
        <div>Practice: <strong>Demo BAG</strong> <span id="bagBal">0</span></div>
        <div>Demo XRP (est.): <strong id="xrpBal">0</strong></div>
      </div>

    </div><!-- panel -->
  </div><!-- game-wrap -->
</section>

  <!-- üéÆ Gameplay + BAG Session Logic -->
<script src="/js/bag-demo-session.js"></script>
<script src="/js/bag-events.js"></script>
<script src="/js/bag-game-config.js"></script>
<script src="/js/bag-hud.js"></script>
<script src="/js/bag-overlay.js"></script>
<script src="/js/bag-payout-wire.js"></script>
<script src="/js/bag-prices.js"></script>
<script src="/js/bag-rules.js"></script>
<script src="/js/bag-stake-wire.js"></script>
<script src="/js/bag-winreadout.js"></script>

<script>
/* === Core Dice Mechanics === */
const rollBtn = document.getElementById('rollBtn');
const dieA = document.getElementById('dieA');
const dieB = document.getElementById('dieB');
const rollText = document.getElementById('rollText');
const bagBal = document.getElementById('bagBal');
const xrpBal = document.getElementById('xrpBal');

let point = null;
let demoBAG = 1000;

function rollDie(die){
  const val = Math.floor(Math.random()*6)+1;
  die.textContent = val;
  die.style.transform = `rotate(${Math.random()*360}deg)`;
  return val;
}

function updateHUD(){
  bagBal.textContent = demoBAG.toFixed(0);
  xrpBal.textContent = (demoBAG * 0.00002).toFixed(4);
}

function playSound(src){
  const a = new Audio(src);
  a.volume = 0.7;
  a.play().catch(()=>{});
}

function handleWin(){
  playSound('/assets/sounds/win.mp3');
  demoBAG += 50;
  rollText.textContent = `üéâ WIN! You hit ${point || 'natural'}. +50 $BAG`;
  rollText.className = 't win';
  point = null;
  updateHUD();
}

function handleLoss(msg){
  playSound('/assets/sounds/lose.mp3');
  demoBAG -= 25;
  rollText.textContent = `üíÄ ${msg} You lose 25 $BAG.`;
  rollText.className = 't lose';
  point = null;
  updateHUD();
}

function handleRoll(a,b){
  const total = a+b;
  if(point === null){
    // come-out roll
    if(total === 7 || total === 11){
      handleWin();
    } else if([2,3,12].includes(total)){
      handleLoss('Craps.');
    } else {
      point = total;
      rollText.textContent = `Point is set to ${point}. Roll again!`;
      rollText.className = 't scratch';
      playSound('/assets/sounds/roll.mp3');
    }
  } else {
    // point phase
    if(total === point){
      handleWin();
    } else if(total === 7){
      handleLoss('Seven out.');
    } else {
      rollText.textContent = `Rolled ${total}. Still shooting for ${point}.`;
      rollText.className = 't scratch';
      playSound('/assets/sounds/roll.mp3');
    }
  }
}

rollBtn.addEventListener('click',()=>{
  rollBtn.disabled = true;
  const a = rollDie(dieA);
  const b = rollDie(dieB);
  setTimeout(()=>handleRoll(a,b),400);
  setTimeout(()=>rollBtn.disabled=false,1200);
});

updateHUD();

/* === BAG Overlay + Prices === */
document.addEventListener('BAG:pricesReady',()=>{
  const p = window.BAGPrices;
  console.log('[BAG Prices Ready]', p);
});
</script>

  <!-- ‚öôÔ∏è FOOTER -->
<footer style="text-align:center;padding:16px 0;color:#aeb7af;font-size:.9rem;">
  ¬© 2025 <strong>$BAG Protocol</strong> | Utility on Chain. Culture on Brand.<br>
  <a href="https://getthebag.io" style="color:#ffe175;text-decoration:none;font-weight:700;">getthebag.io</a> |
  <a href="https://x.com/getthebag_io" target="_blank" style="color:#ffe175;text-decoration:none;font-weight:700;">ùïè @getthebag_io</a>
</footer>

<!-- üß± Service Worker -->
<script>
if('serviceWorker' in navigator){
  navigator.serviceWorker.register('/service-worker.js').catch(()=>{});
}
</script>

<!-- üõ°Ô∏è Prevent zoom + accidental gesture scaling -->
<script>
document.addEventListener('gesturestart', e => e.preventDefault(), {passive:false});
document.addEventListener('dblclick', e => e.preventDefault(), {capture:true});
window.addEventListener('wheel', e => {
  if(e.ctrlKey){ e.preventDefault(); }
}, {passive:false});
</script>

</body>
</html>
