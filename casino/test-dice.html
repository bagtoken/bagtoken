<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<meta name="format-detection" content="telephone=no" />
<title>BAG Dice ‚Äî Pass Line</title>

<link rel="preconnect" href="https://api.coingecko.com" crossorigin>
<script src="https://xaman.app/assets/cdn/xumm.min.js"></script>
<script>window.__BAG_FORCE_DEMO = false;</script>

<script>
(function(){
  const qs=new URLSearchParams(location.search);
  if(qs.get('three')!=='1') return;
  function load(src, ok, fail){
    var s=document.createElement('script');
    s.src=src; s.async=true; s.onload=ok; s.onerror=fail; document.head.appendChild(s);
  }
  load('https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.min.js',
    ()=>window.__THREE_READY__=true,
    ()=>{
      console.warn('[bag-dice] jsDelivr failed, trying unpkg');
      load('https://unpkg.com/three@0.158.0/build/three.min.js',
        ()=>window.__THREE_READY__=true,
        ()=>{console.error('[bag-dice] three.js failed');window.__THREE_FAILED__=true;}
      );
    });
})();
</script>

<style>
*{box-sizing:border-box}
:root{
  --gold:#ffe175;--bg:#020703;--panel:#0b1b13;--panel2:#0d2217;--muted:#aeb7af;--fg:#f5f7f4;
  --green:#2fbf6b;--green-600:#249a55;--line:#173524;--shadow:rgba(0,0,0,.35);
  --win-bg:rgba(10,12,16,.70);--lose:#e25b5b;--warn:#e8a85c;
}
html,body{margin:0;background:var(--bg);color:var(--fg);
  font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;line-height:1.55}
img{display:block;max-width:100%;height:auto}
button,input{font-size:16px}
a[x-apple-data-detectors]{color:inherit!important;text-decoration:none!important;pointer-events:none!important;cursor:default!important}

/* === NEW FELT BACKGROUND + CENTER FIX === */
.stage3d{
  position:relative;
  width:100%;
  height:320px;
  border-radius:10px;
  overflow:hidden;
  background:#072011;
  box-shadow:inset 0 0 40px rgba(0,0,0,.4);
}
.stage3d .table-bg{
  position:absolute;
  inset:0;
  z-index:0;
  pointer-events:none;
}
.stage3d .table-bg img{
  width:100%;
  height:100%;
  object-fit:cover;
  filter:brightness(1.08) saturate(1.05);
}
.cssstage{
  position:absolute;
  inset:0;
  z-index:2;
  display:grid;
  place-items:center;
}
.dieA{transform:translate3d(-74px,92px,0) rotateX(10deg) rotateY(-16deg);}
.dieB{transform:translate3d(74px,96px,0) rotateX(-8deg) rotateY(18deg);}
@keyframes tumbleA{
  from{transform:translate3d(-74px,92px,0) rotateX(0turn) rotateY(0turn) rotateZ(0turn);}
  to{transform:translate3d(-74px,92px,0) rotateX(1.7turn) rotateY(.95turn) rotateZ(.65turn);}
}
@keyframes tumbleB{
  from{transform:translate3d(74px,96px,0) rotateX(0turn) rotateY(0turn) rotateZ(0turn);}
  to{transform:translate3d(74px,96px,0) rotateX(1.6turn) rotateY(1.1turn) rotateZ(-.60turn);}
}
.tumblingA{animation:tumbleA .42s linear infinite;}
.tumblingB{animation:tumbleB .42s linear infinite;}
.tossing{transition:transform .70s cubic-bezier(.2,.9,.2,1);}

    .back-casino{
    position:fixed;top:18px;left:18px;z-index:1000;
    background:linear-gradient(180deg,#ffe175 0%,#f5c94c 100%);
    color:#08130d;text-decoration:none;font-weight:800;padding:8px 14px;border-radius:10px;
    box-shadow:0 4px 0 #b08a19;transition:all .15s ease
  }
  .back-casino:hover{filter:brightness(1.05);box-shadow:0 4px 0 #b08a19,0 14px 28px rgba(255,225,117,.22)}
  .back-casino:active{transform:translateY(1px);box-shadow:0 3px 0 #9a7315}

  .game-header{text-align:center;padding:36px 10px 14px}
  .game-header img.hero-img{margin:0 auto 10px;filter:drop-shadow(0 10px 24px rgba(46,191,107,.18))}
  .game-header h2{font-size:clamp(1.6rem,5vw,2.2rem);margin:6px 0 0}
  @media (min-width:900px){ .game-header img.hero-img{width:34vw;max-width:420px;margin-left:auto;margin-right:auto} }

  .game-teaser{padding:10px 16px 60px;background:
    radial-gradient(1200px 600px at 10% -10%, #0e2c1d 0%, transparent 60%),
    radial-gradient(900px 500px at 110% 20%, #0b2318 0%, transparent 55%),#060806;
    border-top:1px solid #131313;border-bottom:1px solid #131313}
  .game-wrap{max-width:1080px;margin:0 auto;display:grid;grid-template-columns:1fr;gap:22px}

  .panel{background:linear-gradient(180deg,var(--panel) 0%,var(--panel2) 100%);
    border:1px solid var(--line);border-radius:16px;box-shadow:0 8px 24px var(--shadow)}
  .pad{padding:16px}
</style>

  <body>
<a href="/casino/" class="back-casino">‚¨ÖÔ∏è Back to Casino</a>

<section class="game-header">
  <picture>
    <source type="image/webp" srcset="/assets/bag-dice-960.webp 960w, /assets/bag-dice-1024.webp 1024w" sizes="(min-width:900px) 420px, 70vw">
    <img class="hero-img" src="/assets/bag-dice-1024.png" srcset="/assets/bag-dice-960.png 960w, /assets/bag-dice-1024.png 1024w" sizes="(min-width:900px) 420px, 70vw" alt="BAG Dice" loading="lazy" decoding="async">
  </picture>
  <h2>üé≤ $BAG DICE ‚Äî Pass Line</h2>
  <p class="micro" style="margin-top:4px;opacity:.9;">üí∞ <strong>All payouts are in $BAG.</strong> $XRP bets convert automatically at the live rate.</p>
</section>

<section class="game-teaser" aria-labelledby="game-teaser-title">
  <div class="game-wrap">
    <div class="panel pad">

            <div class="section-title">Stake & Prices</div>
      <div class="stake-box">
        <!-- your full stake & HUD system remains unchanged above -->
      </div>

      <div class="divider"></div>

      <div class="marquee">$BAG DICE</div>
      <div class="table">
        <div class="felt">
          <!-- ‚úÖ integrated 3D green felt background -->
          <div id="dice3d" class="stage3d" aria-label="3D dice area">
            <div class="table-bg">
              <picture>
                <source type="image/webp"
                  srcset="/casino/assets/img/green-felt-3d-960.webp 960w,
                          /casino/assets/img/green-felt-3d-1024.webp 1024w"
                  sizes="100vw">
                <img src="/casino/assets/img/green-felt-3d-1024.png"
                     srcset="/casino/assets/img/green-felt-3d-960.png 960w,
                             /casino/assets/img/green-felt-3d-1024.png 1024w"
                     alt="Dice table felt">
              </picture>
            </div>

            <div class="cssstage">
              <div class="dice-row">
                <div class="die dieA" id="dieA"></div>
                <div class="die dieB" id="dieB"></div>
              </div>
            </div>
          </div>
          <!-- ‚úÖ end of felt background integration -->

          <div class="roll-row">
            <button id="rollBtn" class="btn-roll">ROLL</button>
          </div>

          <div class="hudbar" aria-live="polite" id="diceHud">
            <span class="pill balance">Balance: <b id="balLbl">‚Äî</b> <span id="ccyLbl">BAG</span></span>
            <span class="pill">Mode: <b id="modeLbl">Demo</b></span>
            <span class="pill">Bet: <b id="betLbl">1</b></span>
            <span class="pill">Last: <b id="lastLbl">‚Äî</b></span>
          </div>

          <p class="micro" style="text-align:center;margin-top:8px;opacity:.75;">
            üîä If you don't hear sound: tap ROLL once, turn off Silent, raise volume.
          </p>

          <div class="result">
            <div class="t" id="rollText" role="status" aria-live="polite">
              Come-out roll ‚Äî Need 7 or 11 to WIN ¬∑ 2/3/12 is CRAPS ¬∑ otherwise sets the Point
            </div>
          </div>
        </div>
      </div>
    </div> <!-- /panel -->
  </div> <!-- /game-wrap -->
</section>

    <!-- === UNIVERSAL BAG SCRIPT INCLUDES === -->
<script src="/js/bag-demo-session.js"></script>
<script src="/js/bag-events.js"></script>
<script src="/js/bag-game-config.js"></script>
<script src="/js/bag-hud.js"></script>
<script src="/js/bag-overlay.js"></script>
<script src="/js/bag-payout-wire.js"></script>
<script src="/js/bag-prices.js"></script>
<script src="/js/bag-rules.js"></script>
<script src="/js/bag-stake-wire.js"></script>
<script src="/js/bag-winreadout.js"></script>

<script>
/* === Core Dice Mechanics (unaltered) === */
const rollBtn=document.getElementById('rollBtn');
const dieA=document.getElementById('dieA');
const dieB=document.getElementById('dieB');
const rollText=document.getElementById('rollText');
const balLbl=document.getElementById('balLbl');
const ccyLbl=document.getElementById('ccyLbl');
const betLbl=document.getElementById('betLbl');
const lastLbl=document.getElementById('lastLbl');
const modeLbl=document.getElementById('modeLbl');
let point=null, demoBAG=1000;

function pose(v){
  const faces=[
    'rotateX(0deg) rotateY(0deg)',
    'rotateX(-90deg) rotateY(0deg)',
    'rotateX(90deg) rotateY(0deg)',
    'rotateX(0deg) rotateY(90deg)',
    'rotateX(0deg) rotateY(-90deg)',
    'rotateX(0deg) rotateY(180deg)'
  ];
  return faces[v-1];
}
function rollDie(die){
  die.classList.add('tumblingA');
  const val=Math.floor(Math.random()*6)+1;
  setTimeout(()=>{
    die.classList.remove('tumblingA');
    die.classList.add('tossing');
    die.style.transform=`translate3d(${die===dieA?-74:74}px,92px,0) ${pose(val)}`;
    setTimeout(()=>die.classList.remove('tossing'),650);
  },300);
  return val;
}
function updateHUD(){
  balLbl.textContent=demoBAG.toFixed(0);
  ccyLbl.textContent='BAG';
}
function playSound(src){try{new Audio(src).play()}catch(e){}}
function handleWin(){
  playSound('/assets/sounds/win.mp3');
  demoBAG+=50;
  rollText.textContent=`üéâ WIN! You hit ${point||'natural'}. +50 $BAG`;
  rollText.className='t win'; point=null; updateHUD();
}
function handleLoss(msg){
  playSound('/assets/sounds/lose.mp3');
  demoBAG-=25;
  rollText.textContent=`üíÄ ${msg} You lose 25 $BAG.`;
  rollText.className='t lose'; point=null; updateHUD();
}
function handleRoll(a,b){
  const total=a+b;
  if(point===null){
    if(total===7||total===11) handleWin();
    else if([2,3,12].includes(total)) handleLoss('Craps.');
    else { point=total;
      rollText.textContent=`Point set to ${point}. Roll again!`;
      rollText.className='t scratch'; playSound('/assets/sounds/roll.mp3'); }
  } else {
    if(total===point) handleWin();
    else if(total===7) handleLoss('Seven out.');
    else {
      rollText.textContent=`Rolled ${total}. Still shooting for ${point}.`;
      rollText.className='t scratch'; playSound('/assets/sounds/roll.mp3'); }
  }
}
rollBtn.addEventListener('click',()=>{
  rollBtn.disabled=true;
  const a=rollDie(dieA), b=rollDie(dieB);
  setTimeout(()=>handleRoll(a,b),700);
  setTimeout(()=>rollBtn.disabled=false,1300);
});
dieA.style.transform=`translate3d(-74px,92px,0) ${pose(5)}`;
dieB.style.transform=`translate3d(74px,96px,0) ${pose(2)}`;
updateHUD();

/* === BAG Overlay Hooks === */
document.addEventListener('BAG:pricesReady',()=>{
  console.log('[BAG Prices Ready]',window.BAGPrices);
});
</script>

<footer style="text-align:center;padding:16px 0;color:#aeb7af;font-size:.9rem;">
  ¬© 2025 <strong>$BAG Protocol</strong> | Utility on Chain. Culture on Brand.<br>
  <a href="https://getthebag.io" style="color:#ffe175;text-decoration:none;font-weight:700;">getthebag.io</a> |
  <a href="https://x.com/getthebag_io" target="_blank" style="color:#ffe175;text-decoration:none;font-weight:700;">ùïè @getthebag_io</a>
</footer>

<script>
if('serviceWorker' in navigator){
  navigator.serviceWorker.register('/service-worker.js').catch(()=>{});
}
</script>

<script>
document.addEventListener('gesturestart',e=>e.preventDefault(),{passive:false});
document.addEventListener('dblclick',e=>e.preventDefault(),{capture:true});
window.addEventListener('wheel',e=>{if(e.ctrlKey)e.preventDefault()},{passive:false});
</script>
</body>
</html>
