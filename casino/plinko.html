<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>$BAG Plinko</title>

<link rel="preconnect" href="https://api.coingecko.com" crossorigin>
<script src="https://xaman.app/assets/cdn/xumm.min.js"></script>

<style>
  *{box-sizing:border-box}
  :root{
    --gold:#ffd700;--bg:#020703;--panel:#0b1b13;--panel2:#0d2217;--muted:#aeb7af;--fg:#f5f7f4;
    --green:#2fbf6b;--green2:#34c759;--line:#173524;--shadow:rgba(0,0,0,.35);
    --red:#e25b5b;
  }
  html,body{margin:0;background:var(--bg);color:var(--fg);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;line-height:1.55}
  img{display:block;max-width:100%;height:auto}
  button,input{font-size:16px}

  .back-casino {
    position: fixed; top: 18px; left: 18px; z-index: 1000;
    background: linear-gradient(180deg,#ffe175 0%, #f5c94c 100%);
    color: #08130d; text-decoration: none; font-weight: 800;
    padding: 8px 14px; border-radius: 10px; box-shadow: 0 4px 0 #b08a19; transition: all .15s ease;
  }
  .back-casino:hover { filter: brightness(1.05); box-shadow: 0 4px 0 #b08a19, 0 14px 28px rgba(255,225,117,.22); }
  .back-casino:active { transform: translateY(1px); box-shadow: 0 3px 0 #9a7315; }
  @media (max-width: 640px){ .back-casino{ font-size:.9rem; padding:7px 12px; } }

  .game-header{text-align:center;padding:36px 10px 14px}
  .game-header img.hero-img{margin-bottom:10px;filter:drop-shadow(0 10px 24px rgba(46,191,107,.18))}
  .game-header h2{font-size:clamp(1.6rem,5vw,2.2rem);margin:6px 0 0}
  @media (min-width: 900px){
    .game-header img.hero-img{ width: 34vw; max-width: 420px; margin-left: auto; margin-right: auto; }
  }
  .game-teaser{padding:10px 16px 60px;background:
    radial-gradient(1200px 600px at 10% -10%, #0e2c1d 0%, transparent 60%),
    radial-gradient(900px 500px at 110% 20%, #0b2318 0%, transparent 55%),#060806;
    border-top:1px solid #131313;border-bottom:1px solid #131313}
  .game-wrap{max-width:1080px;margin:0 auto;display:grid;grid-template-columns:1.12fr .88fr;gap:22px}
  @media (max-width:900px){.game-wrap{grid-template-columns:1fr}}

  /* === Center the Plinko board on desktop (keeps right rules column) === */
  @media (min-width:900px){
    .game-wrap{justify-content:center; align-items:start; column-gap:22px;}
    #bagPlinko{justify-self:center; width:100%; max-width:860px;}
    #bagPlinko .stage{width:100%; display:flex; justify-content:center;}
    #bagPlinko .canvas-wrap{margin-left:auto; margin-right:auto; max-width:720px;}
  }

  .panel{background:linear-gradient(180deg,var(--panel) 0%,var(--panel2) 100%);border:1px solid var(--line);border-radius:16px;box-shadow:0 8px 24px var(--shadow)}
  .mock{padding:16px}
  .section-title{font-weight:800;font-size:1.2rem;margin:0 0 12px}

  .stack{display:grid;gap:10px}
  .choice{display:flex;gap:10px;flex-wrap:wrap}
  .chip{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:999px;border:1px solid #2b6a48;background:#0e2a1c;color:#e9efe9;font-weight:800}
  .chip input{accent-color:#2fbf6b}
  .mono{font-variant-numeric:tabular-nums}
  .micro{font-size:.85rem;color:#a8b5ab}
  .muted{color:#cfd6cf}
  .divider{height:1px;background:#123221;margin:10px 0}
  .callout{margin-top:12px;padding:12px;border:1px dashed #29543d;border-radius:12px;background:#0c2418;color:#e4efe7}

  /* ✅ Payouts grid (matches other games) */
  .payout-grid{display:grid;gap:4px}
  .payout-grid .row{display:flex;justify-content:space-between;align-items:baseline}
  .payout-grid .lab{color:#cfd6cf}
  .payout-grid .val{font-variant-numeric:tabular-nums}

  .btn-roll{
    width:100%;margin-top:12px;padding:16px 22px;font-size:1.15rem;font-weight:900;text-transform:uppercase;
    letter-spacing:.5px;border:0;border-radius:14px;color:#08130d;background:linear-gradient(180deg,#ffe175 0%, #f5c94c 100%);
    box-shadow:0 6px 0 #b08a19, 0 16px 32px rgba(255,225,117,.18), inset 0 1px 0 rgba(255,255,255,.35);
    transition:transform .06s ease, box-shadow .2s ease, filter .2s ease; cursor:pointer;
  }
  .btn-roll:hover{filter:brightness(1.05);box-shadow:0 6px 0 #b08a19, 0 22px 40px rgba(255,225,117,.26), inset 0 1px 0 rgba(255,255,255,.4)}
  .btn-roll:active{transform:translateY(2px);box-shadow:0 4px 0 #9a7315, 0 12px 24px rgba(255,225,117,.2), inset 0 1px 0 rgba(255,255,255,.3)}
  .btn-roll:disabled{opacity:.65;cursor:not-allowed;transform:none;box-shadow:0 6px 0 #6e6e6e, 0 10px 20px rgba(0,0,0,.2)!important}

  .result{margin-top:12px;padding:12px;border:1px solid #1b4a2f;border-radius:12px;background:#0b2217;display:flex;align-items:center;gap:10px}
  .result .n{font-weight:900;font-size:1.05rem}

  /* ===== Plinko visuals ===== */
  .stage{position:relative;display:flex;align-items:center;justify-content:center;overflow:hidden;margin-top:10px}
  .canvas-wrap{
    position:relative;width:100%;max-width:720px;
    aspect-ratio:3/4;
    border-radius:14px;
    box-shadow:0 10px 30px rgba(0,0,0,.28), inset 0 1px 0 rgba(255,255,255,.04);
    background: radial-gradient(120% 120% at 50% 0%, #0b2016 0%, #07120d 60%, #060a08 100%);
  }
  canvas{position:absolute;inset:0;width:100%;height:100%}

  .hud{ display:none }
  .pill{background:#0a1e15;border:1px solid #244330;border-radius:999px;padding:6px 10px;font-size:12px;color:#cfe6d8}

  .hudbar{
    display:flex; gap:6px; flex-wrap:wrap; align-items:center;
    margin:6px 0 10px; pointer-events:auto;
  }
  .hudbar .pill b{font-weight:800}
  .aim-tip{ margin:-2px 0 8px; opacity:.9 }

  .win-readout{
    position:absolute; inset:auto 0 18%; margin:auto; width:min(82%,520px);
    display:none; justify-content:center; align-items:center;
    padding:14px 18px; border-radius:14px;
    background:linear-gradient(180deg,rgba(255,226,135,.18),rgba(0,0,0,.05));
    border:1px solid rgba(255,226,135,.35);
    box-shadow:0 12px 44px rgba(255,226,135,.18), inset 0 1px 0 rgba(255,255,255,.25);
    color:#fff2bf; font-weight:900; font-size:1.15rem; text-shadow:0 2px 8px rgba(0,0,0,.45);
    pointer-events:none;
  }
  .win-readout.show{ display:flex; animation:pop .55s ease; }
  .win-amt{ margin-left:8px; color:#ffd700; font-weight:900 }
  .win-sub{ margin-left:10px; opacity:.85; font-weight:700; font-size:.95rem }

  .canvas-wrap.win-pulse{ animation:winPulse 900ms ease; }
  .canvas-wrap.jp-pulse{ animation:jackpotPulse 1200ms ease; }
  @keyframes winPulse{
    0%{box-shadow:0 10px 30px rgba(0,0,0,.28), 0 0 0 0 rgba(186,242,205,.0), inset 0 1px 0 rgba(255,255,255,.04)}
    25%{box-shadow:0 10px 30px rgba(0,0,0,.28), 0 0 32px 8px rgba(186,242,205,.35), inset 0 1px 0 rgba(255,255,255,.08)}
    100%{box-shadow:0 10px 30px rgba(0,0,0,.28), 0 0 0 0 rgba(186,242,205,.0), inset 0 1px 0 rgba(255,255,255,.04)}
  }
  @keyframes jackpotPulse{
    0%{box-shadow:0 10px 30px rgba(0,0,0,.28), 0 0 0 0 rgba(255,215,0,.0), inset 0 1px 0 rgba(255,255,255,.04)}
    20%{box-shadow:0 10px 30px rgba(0,0,0,.28), 0 0 44px 12px rgba(255,215,0,.45), inset 0 1px 0 rgba(255,255,255,.1)}
    100%{box-shadow:0 10px 30px rgba(0,0,0,.28), 0 0 0 0 rgba(255,215,0,.0), inset 0 1px 0 rgba(255,255,255,.04)}
  }

  .thud-shake{ animation:thud 420ms cubic-bezier(.34,.01,.22,1); }
  @keyframes thud{
    0%{ transform:translateY(0) }
    18%{ transform:translateY(6px) }
    36%{ transform:translateY(-3px) }
    54%{ transform:translateY(2px) }
    72%{ transform:translateY(-1px) }
    100%{ transform:translateY(0) }
  }

  .cele{position:absolute;inset:0;display:none;align-items:center;justify-content:center;font-size:42px;font-weight:900;color:#ffe28c;text-shadow:0 4px 14px rgba(0,0,0,.6)}
  .cele.show{display:flex;animation:pop .9s ease}
  @keyframes pop{0%{transform:scale(.7);opacity:0}50%{transform:scale(1.06);opacity:1}100%{transform:scale(1)}}

  @media (hover:hover) and (pointer:fine){
    #boardWrap canvas{ cursor: crosshair; }
    #boardWrap{ -webkit-user-select:none; user-select:none; }
  }

  /* === Footer: ensure proper wrapping on all screens === */
  footer.footer, .footer{
    display:block;
    width:100%;
    max-width:1100px;
    margin:24px auto 20px;
    padding:16px 12px;
    text-align:center;
    line-height:1.6;
    white-space:normal;       /* allow wrapping */
    word-break:normal;
  }
  .footer a{
    display:inline-block;     /* prevents long inline from collapsing */
    margin:0 6px;
    color:#e0c66f;
    text-decoration:none;
    font-weight:700;
  }
  .footer a:hover{ text-decoration:underline; }
</style>

 <script src="/js/bag-session.js"></script>

</head>
<body>

<!-- 🔙 Back to Casino -->
<a href="/casino/" class="back-casino" aria-label="Back to Casino">⬅ Back to Casino</a>

<!-- Game header -->
<section class="game-header">
  <img src="/assets/bag-plinko.png" alt="$BAG Plinko" class="hero-img" loading="lazy" decoding="async">
  <h2>🪙 $BAG Plinko</h2>
  <p class="micro" style="margin-top:4px;opacity:.9;">
    💰 <strong>All payouts are in $BAG.</strong> $XRP bets convert automatically at the live rate.
  </p>
</section>

<section class="game-teaser" aria-labelledby="game-teaser-title">
  <div class="game-wrap">

    <!-- LEFT PANEL -->
    <div class="panel mock" id="bagPlinko">
      <div id="demo-badge" style="display:none;position:relative;margin:6px 0 10px 0;font:600 12px/1 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;letter-spacing:.3px;">
        <span style="padding:6px 10px;border:1px solid #aaa;border-radius:6px;opacity:.9;">PRACTICE MODE — No real bets or payouts</span>
      </div>

      <div id="connectRow" style="display:flex;justify-content:space-between;align-items:center;margin:-2px 0 10px 0;">
        <div id="connectStatus" class="micro" style="opacity:.9">Wallet: <span style="color:#e8a85c">not connected</span></div>
        <button id="connectBtn"
          style="padding:10px 14px;font-weight:800;border:0;border-radius:12px;color:#08130d;background:linear-gradient(180deg,#ffe175 0%, #f5c94c 100%);box-shadow:0 4px 0 #b08a19;cursor:pointer;">
          Connect Xaman
        </button>
      </div>

      <div id="sessionRow" style="display:flex;justify-content:space-between;align-items:center;margin:6px 0 10px 0%;">
        <div id="sessionStatus" class="micro" style="opacity:.9">Session: <span style="color:#e8a85c">not started</span></div>
        <div style="display:flex;gap:8px;align-items:center">
          <button id="startSessionBtn" style="padding:8px 12px;font-weight:800;border:0;border-radius:10px;color:#08130d;background:linear-gradient(180deg,#ffe175 0%, #f5c94c 100%);box-shadow:0 3px 0 #b08a19;cursor:pointer;">Start Session</button>
          <button id="topUpBtn" style="padding:8px 12px;font-weight:800;border:0;border-radius:10px;color:#08130d;background:linear-gradient(180deg,#ffe175 0%, #f5c94c 100%);box-shadow:0 3px 0 #b08a19;cursor:pointer;display:none;">Top Up</button>
          <button id="endSessionBtn" style="padding:8px 12px;font-weight:800;border:0;border-radius:10px;background:#15261c;color:#dfe9e2;border:1px solid #2b6a48;cursor:pointer;display:none;">End</button>
        </div>
      </div>

      <div class="section-title">Stake & Prices</div>

      <div class="stake-box">
        <div class="stack">
          <div>
            <div class="micro">Amount</div>
            <div style="display:flex;align-items:center;gap:6px">
              <input id="usdBet" class="mono" type="tel" inputmode="decimal" pattern="[0-9.]*"
                min="0" max="2000" step="0.01" placeholder="0.00" aria-label="Stake in USD"
                style="width:140px;background:#0b2217;border:1px solid #1b4a2f;border-radius:10px;color:#f3f5f0;padding:10px">
              <span class="micro" aria-hidden="true">USD</span>
            </div>
          </div>

          <div>
            <div class="micro">Bet currency</div>
            <div class="choice" id="curToggle" role="radiogroup" aria-label="Bet currency">
              <label class="chip"><input type="radio" name="betCur" value="XRP" checked> XRP</label>
              <label class="chip"><input type="radio" name="betCur" value="BAG"> BAG</label>
            </div>
          </div>

          <div>
            <div class="micro">Bet amount</div>
            <div style="display:flex;gap:10px;flex-wrap:wrap;align-items:center">
              <div>
                <input id="demoBet" class="mono" type="tel" inputmode="decimal" pattern="[0-9.]*" min="0" step="any" value="1" aria-label="Stake units"
                  style="width:140px;background:#0b2217;border:1px solid #1b4a2f;border-radius:10px;color:#f3f5f0;padding:10px">
                <span class="unit">XRP</span>
              </div>
            </div>
          </div>

          <div class="divider"></div>

          <div class="micro">Live prices</div>
          <div class="muted mono" id="liveLine" aria-live="polite">
            <span id="liveDot" class="warn">●</span>
            <span> BAG $<span id="liveBAG">—</span> · XRP $<span id="liveXRP">—</span> <span id="liveNote"></span></span>
            <div class="micro" id="liveConv" style="margin-top:4px;opacity:.9;">1 BAG ≈ — XRP · 1 XRP ≈ — BAG</div>
            <div id="bagDiag" class="micro" style="opacity:.55;margin-top:4px;"></div>
          </div>

          <div class="divider"></div>

          <div class="micro">Game state</div>
          <div class="muted" id="stateText">Ready — tap Drop to start</div>

          <!-- ✅ Reformatted Payouts box -->
          <div class="callout mono" id="payoutBox">
            <div class="payout-grid">
              <div class="row"><div class="lab"><strong>Scratch</strong> (0×):</div><div class="val">—</div></div>
              <div class="row"><div class="lab"><strong>Win</strong> (1.25×):</div><div class="val">— <span class="micro" id="payWinGain" style="opacity:.9"></span></div></div>
              <div class="row"><div class="lab"><strong>Jackpot</strong> (2.00×):</div><div class="val">— <span class="micro" id="payJackpotGain" style="opacity:.9"></span></div></div>
            </div>
            <div class="micro" style="margin-top:6px;opacity:.85;">
              Drop lands in a slot: Scratch (lose), Win (1.25×), or Jackpot (2.00×). Payouts settle in BAG.
            </div>
            <div class="micro" style="margin-top:6px;opacity:.75;">Min $1 · Max $2,000</div>
          </div>

          <p class="micro aim-tip">👇 Tap anywhere on the board to choose where the coin drops. Use ←/→ to adjust; press Space or tap <b>Drop</b> to release.</p>

          <!-- Board -->
          <div class="stage">
            <div class="canvas-wrap" id="boardWrap">
              <canvas id="game" aria-label="Plinko board"></canvas>
              <div class="hud">
                <span class="pill">Mode: <b>Demo</b></span>
                <span class="pill">Balance: <b>100.00</b> <span>XRP</span></span>
                <span class="pill">Bet: <b>1</b></span>
                <span class="pill">Last: <b>—</b></span>
              </div>
              <div id="winReadout" class="win-readout" aria-live="polite">
                <span id="winTitle">YOU WIN!</span>
                <span class="win-amt" id="winAmt">+0.00 BAG</span>
                <span class="win-sub" id="winUsd">(+$0.00)</span>
              </div>
              <div id="cele" class="cele" aria-live="polite"></div>
            </div>
          </div>

          <div class="result" style="margin-top:12px">
            <div class="n">Result:</div>
            <div id="resText" class="t">—</div>
          </div>

          <div style="margin-top:18px;text-align:center">
            <button id="dropBtn" class="btn-roll" style="width:min(360px,90%)">Drop Coin</button>
          </div>

          <div class="hudbar" id="bottomHud" style="justify-content:center;">
            <span class="pill">Mode: <b id="modeLbl">Demo</b></span>
            <span class="pill">Balance: <b id="balLbl">100.00</b> <span id="ccyLbl">BAG</span></span>
            <span class="pill">Bet: <b id="betLbl">1</b></span>
            <span class="pill">Last: <b id="lastLbl">—</b></span>
          </div>

          <div class="micro" style="text-align:center;opacity:.7;margin-top:6px">
            🔊 If you don’t hear sound: tap DROP once, turn off Silent mode, and raise volume.
          </div>
        </div>
      </div>

      <!-- RIGHT: Rules -->
      <div class="panel" style="padding:16px">
        <h3 style="margin:0 0 8px;font-size:1.2rem;">How it plays</h3>
        <ul style="margin:0;padding-left:18px;color:#cfd6cf">
          <li>Tap <b>Drop Coin</b> to release a token at the top.</li>
          <li>It bounces down pegs into a slot: <b>Scratch</b> (lose), <b>1.25×</b> (win), or <b>2×</b> (jackpot).</li>
          <li>All payouts settle in <b>$BAG</b> (XRP bets auto-convert).</li>
        </ul>

        <h4 style="margin:12px 0 6px;">Payouts:</h4>
        <ul style="margin:0;padding-left:18px;color:#cfd6cf">
          <li><b>Scratch:</b> 0× (lose).</li>
          <li><b>Win:</b> 1.25× payout.</li>
          <li><b>Jackpot:</b> 2.0× payout.</li>
        </ul>

        <p class="micro" style="margin-top:10px">No wallet connection yet. Visual demo only while development continues.</p>
      </div>

    </div>
</section>

<!-- === AUDIO ENGINE (SFX compatible) — LOSE thud unchanged === -->
<script>
/* ... (all your existing JS stays the same) ... */
</script>

<!-- === WALLET CONNECT (unchanged) === -->
<script>
/* ... (unchanged) ... */
</script>

<!-- === TAB SESSION (unchanged) === -->
<script>
/* ... (unchanged) ... */
</script>

<!-- === PRICES (unchanged) === -->
<script>
/* ... (unchanged) ... */
</script>

<!-- === PRICES/STAKE SYNC (unchanged) === -->
<script>
/* ... (unchanged) ... */
</script>

<!-- === QUICK AMOUNT BUTTONS (unchanged) === -->
<script>
/* ... (unchanged) ... */
</script>

<!-- === PC HiDPI scaler (unchanged) === -->
<script>
/* ... (unchanged) ... */
</script>

<!-- === PLINKO GAME LOGIC (unchanged) === -->
<script>
/* ... (unchanged) ... */
</script>

<!-- Practice Mode Wrapper (unchanged) -->
<script>
/* ... (unchanged) ... */
</script>

<!-- HUD updater (unchanged) -->
<script>
/* ... (unchanged) ... */
</script>

<!-- === Shared celebration overlay (unchanged) === -->
<canvas id="win-canvas"></canvas>
<div id="win-overlay" role="dialog" aria-live="polite" aria-label="Win notification" style="display:none;place-items:center;background:radial-gradient(60% 60% at 50% 50%, rgba(24,160,251,.28), transparent 70%), rgba(10,12,16,.70);position:fixed;inset:0;z-index:2147483647;backdrop-filter:saturate(120%) blur(2px);">
  <div id="win-card" style="position:relative;text-align:center;padding:24px 32px;border-radius:16px;background:rgba(0,0,0,.35);box-shadow:0 10px 40px rgba(0,0,0,.45), inset 0 0 80px rgba(0,255,200,.06);transform:scale(.9);opacity:0;animation:win-pop .35s cubic-bezier(.2,.9,.2,1) forwards, win-float 1.8s ease-in-out .35s infinite;">
    <button id="win-close" aria-label="Close" style="position:absolute;top:8px;right:10px;border:0;background:transparent;color:#cfeaff;font:700 20px/1 system-ui;cursor:pointer;padding:6px 8px;opacity:.7;">×</button>
    <div id="win-text" style="font:900 64px/1 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;letter-spacing:.06em;background:linear-gradient(90deg,#fff,#00ffb2,#fff);background-size:200% 100%;-webkit-background-clip:text;background-clip:text;color:transparent;-webkit-text-fill-color:transparent;text-shadow:0 0 18px rgba(0,255,178,.35), 0 0 48px rgba(0,255,178,.25);filter:drop-shadow(0 4px 10px rgba(0,0,0,.35));animation:shine 1.6s linear infinite;white-space:nowrap;">WIN</div>
    <div id="win-sub" style="margin-top:8px;color:#e7f6ff;opacity:.9;font:600 16px/1.2 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;">Nice roll</div>
  </div>
</div>
<style>
@keyframes win-pop{to{transform:scale(1);opacity:1}}
@keyframes win-float{0%,100%{transform:translateY(0)}50%{transform:translateY(-6px)}}
@keyframes shine{0%{background-position:0% 0}100%{background-position:200% 0}}
</style>
<script>
/* ... (unchanged) ... */
</script>

<footer class="footer">
  © 2025 $BAG Protocol · getthebag.io · Powered by $XRP
  <br>
  <a href="https://x.com/getthebag_io" target="_blank" rel="noopener">𝕏 @getthebag_io</a> |
  <a href="https://t.me/getthebag_io" target="_blank" rel="noopener">Telegram @getthebag_io</a>
</footer>

</body>
</html>
