<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>$BAG PLINKO — $BAG Casino</title>

<style>
  *{box-sizing:border-box}
  :root{
    --gold:#ffd700;--bg:#020703;--panel:#0b1b13;--fg:#f5f7f4;--muted:#aeb7af;--red:#e25b5b;--shadow:rgba(0,0,0,.4)
  }
  html,body{margin:0;background:var(--bg);color:var(--fg);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
  .wrap{max-width:1100px;margin:0 auto;padding:20px}
  .top-banner{display:flex;justify-content:center;margin:16px 0}
  .top-banner img{width:220px;max-width:80%;height:auto;filter:drop-shadow(0 6px 12px rgba(0,0,0,.45))}
  header{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}
  .btn{background:linear-gradient(180deg,#0e1e14,#09130d);border:1px solid #1c3b27;border-radius:10px;padding:10px 14px;color:#f5f7f4;font-weight:600;cursor:pointer}
  .btn.gold{background:linear-gradient(180deg,#6b5412,#3e2d09);border-color:#8a6a1a;color:#ffdc73}
  .btn.green{background:linear-gradient(180deg,#113a22,#0b2a18);border-color:#1e6a3f;color:#baf2cd}
  .grid{display:grid;grid-template-columns:1.3fr .7fr;gap:18px}@media(max-width:980px){.grid{grid-template-columns:1fr}}
  .panel{background:radial-gradient(140% 100% at 0% 0%,rgba(27,64,45,.55),transparent 60%),var(--panel);
    border:1px solid #173c27;border-radius:14px;padding:16px;box-shadow:0 10px 30px var(--shadow)}
  .stage{position:relative;min-height:560px;display:flex;align-items:center;justify-content:center;overflow:hidden}
  .board-bg{position:absolute;top:0;left:50%;transform:translateX(-50%);width:640px;height:820px;object-fit:contain;pointer-events:none;user-select:none}
  canvas{position:absolute;top:0;left:50%;transform:translateX(-50%);width:640px;height:820px;pointer-events:none}
  .cele{position:absolute;inset:0;display:none;align-items:center;justify-content:center;font-size:44px;font-weight:900;color:#ffe28c;text-shadow:0 4px 14px rgba(0,0,0,.6)}
  .cele.show{display:flex;animation:pop .9s ease}@keyframes pop{0%{transform:scale(.7);opacity:0}50%{transform:scale(1.05);opacity:1}100%{transform:scale(1)}}
  .slot{flex:1;text-align:center;border:1px dashed #2a4d38;border-radius:8px;padding:8px}
  .slot.jack{border-color:#8a6a1a;background:rgba(138,106,26,.08)}
</style>
</head>
<body>
<div class="wrap">
  <div class="top-banner"><img src="/assets/bag-plinko.png" alt="$BAG PLINKO"></div>

  <header>
    <a href="/casino.html" class="btn">⬅️ Back to Casino</a>
    <div>
      <button id="btnConnect" class="btn gold">Connect Xaman</button>
      <button id="btnSession" class="btn green">Start Session</button>
    </div>
  </header>

  <div class="grid">
    <section class="panel stage">
      <!-- visible board -->
      <img src="/assets/bag-plinko.png" alt="Plinko board" class="board-bg" id="boardImg">
      <!-- animation layer -->
      <canvas id="canvas" width="640" height="820"></canvas>
      <div id="cele" class="cele"></div>
    </section>

    <aside class="panel">
      <label>Stake</label><input id="stake" type="number" min="1" value="1">
      <label>Currency</label><select id="currency"><option>XRP</option><option>$BAG</option></select>
      <button id="btnDrop" class="btn green" style="width:100%;margin-top:10px">Drop Coin</button>
      <h3>Payouts</h3>
      <div style="display:flex;gap:6px">
        <div class="slot"><b>Scratch</b><br><span style="color:#aeb7af">Lose</span></div>
        <div class="slot"><b>1.2×</b><br><span style="color:#aeb7af">Instant Win</span></div>
        <div class="slot jack"><b>2×</b><br><span style="color:#aeb7af">Jackpot</span></div>
      </div>
    </aside>
  </div>
</div>

<script>
(()=>{const BOARD_W=640,BOARD_H=820,ROWS=8,SLOTS=7,PAY=['L',1.2,'L',2,'L',1.2,'L'];
let bal=100,stake=1;const cv=document.getElementById('canvas'),cx=cv.getContext('2d'),cele=document.getElementById('cele');
document.getElementById('stake').oninput=e=>{stake=Math.max(1,Math.floor(+e.target.value||1));e.target.value=stake;}
document.getElementById('btnDrop').onclick=()=>{
 if(bal<stake){toast('Insufficient funds');return;}
 bal-=stake;const slot=simulate(randSeed());animate(slot,()=>{const r=resolve(slot);if(r.win)bal+=r.delta;celebrate(r);});
}
function simulate(s){const r=mulberry32(s);let p=Math.floor(SLOTS/2);for(let i=0;i<ROWS;i++)p=Math.max(0,Math.min(SLOTS-1,p+(r()<.5?-1:1)));return p;}
function resolve(i){const v=PAY[i];if(v==='L')return{win:!1,jack:!1,delta:0};
const m=Number(v),g=Math.floor(stake*m*100)/100;return{win:!0,jack:m===2,delta:g};}
function animate(s,done){const path=build(s),chip={x:path[0].x,y:path[0].y,i:0};
const step=()=>{const n=path[chip.i+1];if(!n){done();return;}const dx=n.x-chip.x,dy=n.y-chip.y,d=Math.hypot(dx,dy);
const spd=8;if(d<=spd){chip.x=n.x;chip.y=n.y;chip.i++;}else{chip.x+=spd*dx/d;chip.y+=spd*dy/d;}
cx.clearRect(0,0,BOARD_W,BOARD_H);drawChip(chip.x,chip.y);requestAnimationFrame(step);}requestAnimationFrame(step);}
function drawChip(x,y){cx.beginPath();cx.arc(x,y,10,0,2*Math.PI);const g=cx.createRadialGradient(x-4,y-4,2,x,y,10);
g.addColorStop(0,'#ffd36d');g.addColorStop(.6,'#c8911e');g.addColorStop(1,'#8b5e13');cx.fillStyle=g;cx.fill();}
function build(s){const w=BOARD_W/(SLOTS+1),p=[{x:BOARD_W/2,y:140}],c0=Math.floor(SLOTS/2);let c=c0;
for(let r=0;r<ROWS;r++){const d=s>c?1:s<c?-1:(Math.random()<.5?-1:1);c=Math.max(0,Math.min(SLOTS-1,c+d));
p.push({x:w*(c+1),y:180+r*60});p.push({x:w*(c+1),y:180+r*60+40});}p.push({x:w*(s+1),y:BOARD_H-70});return p;}
function celebrate(r){cele.textContent=r.jack?'JACKPOT 2×':(r.win?'WIN 1.2×':'SCRATCH');cele.classList.remove('show');
void cele.offsetWidth;cele.classList.add('show');setTimeout(()=>cele.classList.remove('show'),1100);}
function randSeed(){const a=new Uint32Array(1);crypto.getRandomValues(a);return a[0];}
function mulberry32(a){return()=>{let t=a+=0x6D2B79F5;t=Math.imul(t^t>>>15,t|1);t^=t+Math.imul(t^t>>>7,t|61);return((t^t>>>14)>>>0)/4294967296}}
function toast(m){const t=document.createElement('div');t.textContent=m;
Object.assign(t.style,{position:'fixed',bottom:'20px',left:'50%',transform:'translateX(-50%)',
background:'#0a1e15',color:'#fff',border:'1px solid #244330',padding:'10px 14px',borderRadius:'10px'});document.body.append(t);setTimeout(()=>t.remove(),1500);}
})();
</script>
</body>
</html>
