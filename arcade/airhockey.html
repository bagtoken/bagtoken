<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
  <meta name="format-detection" content="telephone=no">
  <title>$BAG Air Hockey â€” Arcade P2E</title>

  <!-- Matter.js -->
  <script src="https://cdn.jsdelivr.net/npm/matter-js@0.19.0/build/matter.min.js"></script>
  <script>window.__BAG_FORCE_DEMO = true;</script>

  <style>
    *{box-sizing:border-box;margin:0;padding:0}
    html,body{
      height:100%;
      background:radial-gradient(circle at center,#021107 0%,#000 100%);
      color:#ffe175;
      font-family:"Orbitron",sans-serif;
      overflow:hidden;
      user-select:none;
    }

    /* HUD */
    #hud{
      position:absolute;top:10px;left:0;right:0;
      display:flex;justify-content:space-between;align-items:center;
      padding:0 20px;font-size:18px;z-index:30;
    }
    #modeSelect{display:flex;gap:8px;}
    button{
      background:#0b1b13;color:#ffe175;border:1px solid #2fbf6b;
      padding:6px 12px;border-radius:6px;font-weight:600;cursor:pointer;
    }
    button.active{background:#2fbf6b;color:#000;}

    /* Practice/Live pill */
    #playToggle{
      display:flex;align-items:center;gap:8px;
      background:#0b1b13;border:1px solid #2fbf6b;border-radius:20px;
      padding:4px 10px;font-size:14px;
    }
    #playToggle span{cursor:pointer;}
    #playToggle .active{color:#000;background:#2fbf6b;padding:2px 6px;border-radius:12px;}

    /* Game Area */
    #gameCanvas{
      display:block;margin:0 auto;
      background:linear-gradient(180deg,#052010 0%,#04150c 100%);
      border:3px solid #2fbf6b;border-radius:16px;
      box-shadow:0 0 25px rgba(47,191,107,0.5);
    }

    /* Overlay + Score */
    #scoreboard{
      position:absolute;bottom:12px;left:0;right:0;text-align:center;
      font-size:22px;color:#ffe175;letter-spacing:1px;
    }
    #overlay{
      position:absolute;top:0;left:0;right:0;bottom:0;
      display:flex;align-items:center;justify-content:center;
      font-size:48px;color:#ffe175;background:rgba(0,0,0,0.6);
      z-index:40;opacity:0;transition:opacity .3s;
    }
    #overlay.show{opacity:1;}

    /* Balances + Reward */
    #balances{
      position:absolute;top:55px;left:20px;z-index:25;text-align:left;
      font-size:14px;line-height:1.4;color:#ffe175;
    }
    #balances .label{color:#2fbf6b;}
    #reward{
      position:absolute;top:55px;right:20px;font-size:14px;z-index:25;
      color:#ffe175;text-align:right;
    }
  </style>
</head>

<body>
  <!-- HUD -->
  <div id="hud">
    <div id="modeSelect">
      <button id="cpuBtn" class="active">CPU</button>
      <button id="pvpBtn">Player 2</button>
    </div>
    <div id="playToggle">
      <span id="practiceBtn" class="active">Practice</span>
      <span id="liveBtn">Live</span>
    </div>
    <div>
      <span id="timer">90</span>s
      <button id="startBtn">Start</button>
    </div>
  </div>

  <!-- Demo Balances -->
  <div id="balances">
    <div><span class="label">Demo BAG:</span> <span id="demoBag">0</span></div>
    <div><span class="label">Demo XRP (est.):</span> <span id="demoXrp">0</span></div>
  </div>

  <!-- Reward -->
  <div id="reward">Reward Potential: <span id="rewardAmt">+0 BAG</span></div>

  <!-- Game Area -->
  <canvas id="gameCanvas" width="900" height="500"></canvas>
  <div id="overlay">GOAL!</div>
  <div id="scoreboard">Player 1 â€“ 0 : 0 â€“ Player 2</div>

  <!-- Core Script -->
  <script>
  const { Engine, Render, Runner, World, Bodies, Body, Events } = Matter;
  const canvas=document.getElementById("gameCanvas");
  const engine=Engine.create();const world=engine.world;
  const render=Render.create({canvas,engine,options:{width:900,height:500,wireframes:false,background:'transparent'}});
  Render.run(render);Runner.run(Runner.create(),engine);

  /* Table bounds */
  const wallOpt={isStatic:true,render:{fillStyle:'#062b13'}};
  World.add(world,[
    Bodies.rectangle(450,-5,900,10,wallOpt),
    Bodies.rectangle(450,505,900,10,wallOpt),
    Bodies.rectangle(-5,250,10,500,wallOpt),
    Bodies.rectangle(905,250,10,500,wallOpt)
  ]);

  /* Entities */
  const paddle1=Bodies.circle(450,80,30,{density:1,restitution:.9,frictionAir:.08,render:{fillStyle:'#ffe175'}});
  const paddle2=Bodies.circle(450,420,30,{density:1,restitution:.9,frictionAir:.08,render:{fillStyle:'#2fbf6b'}});
  const puck=Bodies.circle(450,250,20,{density:.02,restitution:.98,frictionAir:.01,render:{fillStyle:'#00ff8c'}});
  World.add(world,[paddle1,paddle2,puck]);

  /* State */
  let scores=[0,0],cpuMode=true,gameActive=false,timeLeft=90,timerInt=null;
  const overlay=document.getElementById("overlay"),scoreText=document.getElementById("scoreboard"),timer=document.getElementById("timer");

  /* Buttons */
  const cpuBtn=document.getElementById("cpuBtn"),pvpBtn=document.getElementById("pvpBtn");
  cpuBtn.onclick=()=>{cpuMode=true;cpuBtn.classList.add('active');pvpBtn.classList.remove('active');};
  pvpBtn.onclick=()=>{cpuMode=false;pvpBtn.classList.add('active');cpuBtn.classList.remove('active');};

  const practiceBtn=document.getElementById("practiceBtn"),liveBtn=document.getElementById("liveBtn");
  let live=false;
  practiceBtn.onclick=()=>{live=false;practiceBtn.classList.add('active');liveBtn.classList.remove('active');updateReward();};
  liveBtn.onclick=()=>{live=true;liveBtn.classList.add('active');practiceBtn.classList.remove('active');updateReward();};

  /* Sounds */
  const sndHit=new Audio('/arcade/assets/sounds/hit.mp3');
  const sndGoal=new Audio('/arcade/assets/sounds/goal.mp3');
  const sndStart=new Audio('/arcade/assets/sounds/start.mp3');

  /* Game start */
  document.getElementById("startBtn").onclick=()=>{
    if(gameActive)return;
    scores=[0,0];updateScore();
    Body.setPosition(puck,{x:450,y:250});Body.setVelocity(puck,{x:0,y:0});
    timeLeft=90;timer.textContent=timeLeft;gameActive=true;
    sndStart.currentTime=0;sndStart.play();
    timerInt=setInterval(()=>{timeLeft--;timer.textContent=timeLeft;if(timeLeft<=0)endGame();},1000);
  };

  function updateScore(){scoreText.textContent=`Player 1 â€“ ${scores[0]} : ${scores[1]} â€“ Player 2`;}
  function goalScored(p){
    sndGoal.currentTime=0;sndGoal.play();
    overlay.textContent='GOAL!';overlay.classList.add('show');
    setTimeout(()=>overlay.classList.remove('show'),500);
    if(p===1)scores[0]++;else scores[1]++;
    updateScore();
    Body.setPosition(puck,{x:450,y:250});Body.setVelocity(puck,{x:0,y:0});
  }
  function endGame(){
    clearInterval(timerInt);gameActive=false;
    let result='DRAW';
    if(scores[0]>scores[1])result='YOU WIN!';
    else if(scores[1]>scores[0])result='YOU LOSE!';
    overlay.textContent=result;overlay.classList.add('show');
    // ðŸª™ payout hook placeholder for future on-chain logic
  }

  /* Collisions & Goals */
  Events.on(engine,'collisionStart',e=>{
    if(!gameActive)return;
    for(const pair of e.pairs){
      if(pair.bodyA===puck||pair.bodyB===puck){sndHit.currentTime=0;sndHit.play();}
    }
  });

  Events.on(engine,'afterUpdate',()=>{
    if(!gameActive)return;
    if(puck.position.y<30 && Math.abs(puck.position.x-450)<90){goalScored(2);}
    if(puck.position.y>470 && Math.abs(puck.position.x-450)<90){goalScored(1);}
  });

  /* Controls */
  const mouse={x:450,y:80};
  canvas.addEventListener('mousemove',e=>{
    const r=canvas.getBoundingClientRect();
    mouse.x=e.clientX-r.left;mouse.y=e.clientY-r.top;
  });
  const keys={ArrowUp:false,ArrowDown:false};
  addEventListener('keydown',e=>{if(keys.hasOwnProperty(e.key))keys[e.key]=true;});
  addEventListener('keyup',e=>{if(keys.hasOwnProperty(e.key))keys[e.key]=false;});

  Events.on(engine,'beforeUpdate',()=>{
    if(!gameActive)return;
    const y=Math.min(mouse.y,220);Body.setPosition(paddle1,{x:mouse.x,y});
    if(cpuMode){
      const dy=(puck.position.y>paddle2.position.y)?2:-2;
      const dx=(puck.position.x-paddle2.position.x)*0.05;
      Body.translate(paddle2,{x:dx,y:dy});
    }else{
      if(keys.ArrowUp)Body.translate(paddle2,{x:0,y:-5});
      if(keys.ArrowDown)Body.translate(paddle2,{x:0,y:5});
    }
    if(paddle2.position.y<250)paddle2.position.y=250;
  });

  /* Demo Balances */
  let demoBag=1000,demoXrp=10;
  const bagEl=document.getElementById("demoBag"),xrpEl=document.getElementById("demoXrp");
  function updateDemo(){
    bagEl.textContent=demoBag.toFixed(2);
    xrpEl.textContent=demoXrp.toFixed(2);
  }
  function updateReward(){
    const base=live?50:5;
    document.getElementById("rewardAmt").textContent=`+${base} BAG`;
  }
  updateReward();updateDemo();
  </script>
</body>
</html>
