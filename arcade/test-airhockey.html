<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<meta name="format-detection" content="telephone=no" />
<title>$BAG Air Hockey ‚Äî Arcade P2E</title>

<link rel="preconnect" href="https://api.coingecko.com" crossorigin>
<script src="https://xaman.app/assets/cdn/xumm.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/phaser@3.70.0/dist/phaser.min.js"></script>
<script>window.__BAG_FORCE_DEMO=false;</script>

<style>
*{box-sizing:border-box}
:root{
 --gold:#ffe175;--bg:#020703;--panel:#0b1b13;--panel2:#0d2217;
 --muted:#aeb7af;--fg:#f5f7f4;--green:#2fbf6b;--line:#173524;
 --shadow:rgba(0,0,0,.35);--lose:#e25b5b;--warn:#e8a85c;
}
html,body{margin:0;background:var(--bg);color:var(--fg);
 font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
 line-height:1.55;overflow-x:hidden;}
img{display:block;max-width:100%;height:auto}
.back-casino{position:fixed;top:18px;left:18px;z-index:1000;
 background:linear-gradient(180deg,#ffe175 0%,#f5c94c 100%);
 color:#08130d;text-decoration:none;font-weight:800;
 padding:8px 14px;border-radius:10px;box-shadow:0 4px 0 #b08a19;}
.panel{background:linear-gradient(180deg,var(--panel),var(--panel2));
 border:1px solid var(--line);border-radius:16px;
 box-shadow:0 8px 24px var(--shadow);}
.pad{padding:16px}
.marquee{text-align:center;font-weight:900;letter-spacing:.08em;
 color:#ffe9a6;background:linear-gradient(180deg,#17311f,#0e2419);
 border:1px solid #254a33;border-radius:12px;padding:8px}
.table{background:#07140e;border:1px solid #1b4a2f;border-radius:14px;padding:14px}
.felt{display:grid;gap:12px;background:#091a13;border:1px solid #24533a;
 border-radius:12px;padding:12px;overflow:hidden}
.stage3d{height:100vh;position:relative;border-radius:10px;overflow:hidden}
canvas{display:block;width:100%;height:100%}
.hudbar{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));
 gap:6px;align-items:center;margin:6px 2px 0}
.pill{background:#0a1e15;border:1px solid #244330;border-radius:999px;
 padding:6px 10px;font-size:12px;color:#cfe6d8}
.pill.balance{grid-column:1/-1;font-size:14px;padding:8px 12px;font-weight:800}
button.btn{cursor:pointer}
</style>
</head>

<body>
<a href="/casino/" class="back-casino">‚¨ÖÔ∏è Back to Casino</a>

<section class="game-header" style="text-align:center;padding:36px 10px 14px">
 <picture>
  <source type="image/webp"
          srcset="/assets/bag-airhockey-960.webp 960w, /assets/bag-airhockey-1024.webp 1024w"
          sizes="(min-width:900px) 420px, 70vw">
  <img class="hero-img"
       src="/assets/bag-airhockey-1024.png"
       srcset="/assets/bag-airhockey-960.png 960w, /assets/bag-airhockey-1024.png 1024w"
       sizes="(min-width:900px) 420px, 70vw"
       alt="$BAG Air Hockey" loading="lazy" decoding="async">
 </picture>
 <h2>üèí $BAG Air Hockey ‚Äî Arcade P2E</h2>
 <p class="micro" style="margin-top:4px;opacity:.9;">
  üí∞ <strong>All payouts are in $BAG.</strong> $XRP bets convert automatically at the live rate.
 </p>
</section>

<section class="game-teaser" style="padding:10px 16px 60px;background:
 radial-gradient(1200px 600px at 10% -10%, #0e2c1d 0%, transparent 60%),
 radial-gradient(900px 500px at 110% 20%, #0b2318 0%, transparent 55%),#060806;
 border-top:1px solid #131313;border-bottom:1px solid #131313">
<div class="game-wrap" style="max-width:1080px;margin:0 auto;display:grid;gap:22px">
<div class="panel pad">

<!-- CONNECT + PVP -->
<div style="display:flex;justify-content:space-between;align-items:center;margin:-2px 0 10px">
 <div id="connectStatus" class="micro" style="opacity:.9">Wallet: <span style="color:#e8a85c">not connected</span></div>
 <div style="display:flex;gap:6px;align-items:center">
   <button id="pvpToggle" class="btn" style="padding:10px 14px;border:0;border-radius:12px;
    font-weight:900;background:linear-gradient(180deg,#2fbf6b,#1f8b4e);color:#fff">PvP: OFF</button>
   <button id="connectBtn" class="btn"
     style="padding:10px 14px;border:0;border-radius:12px;font-weight:900;
     color:#08130d;background:linear-gradient(180deg,#ffe175,#f5c94c);box-shadow:0 4px 0 #b08a19;">Connect Xaman</button>
 </div>
</div>

<!-- SESSION -->
<div style="display:flex;justify-content:space-between;align-items:center;margin:6px 0 10px">
 <div class="micro" style="opacity:.9">Session: <span style="color:#2fbf6b">Practice</span></div>
 <button id="startSessionBtn" class="btn" style="padding:8px 12px;border:0;border-radius:12px;
  font-weight:900;color:#08130d;background:linear-gradient(180deg,#ffe175,#f5c94c);
  box-shadow:0 4px 0 #b08a19;">Start Session</button>
</div>

<div class="section-title" style="font-weight:800;font-size:1.2rem;margin:0 0 12px">Stake & Prices</div>

<!-- STAKE BOX -->
<div class="stake-box" style="padding:14px">
 <div class="stack" style="display:grid;gap:10px">
  <div>
    <div class="micro">Amount</div>
    <div style="display:flex;gap:10px;align-items:center">
      <input id="usdBet" type="number" min="0" max="2000" step="0.01"
        placeholder="0.00" style="width:140px;background:#0b2217;border:1px solid #1b4a2f;
        border-radius:10px;color:#f3f5f0;padding:10px">
      <span class="micro unit">USD</span>
    </div>
    <div class="preset-chips" id="usdPresets">
      <button class="preset-chip" data-usd="1">$1</button>
      <button class="preset-chip" data-usd="5">$5</button>
      <button class="preset-chip" data-usd="10">$10</button>
      <button class="preset-chip" data-usd="20">$20</button>
      <button class="preset-chip" data-usd="50">$50</button>
      <button class="preset-chip" data-usd="100">$100</button>
      <button class="preset-chip" data-usd="max">Max</button>
    </div>
  </div>

  <div>
    <div class="micro">Bet currency</div>
    <label><input type="radio" name="betCur" value="XRP" checked> XRP</label>
    <label><input type="radio" name="betCur" value="BAG"> BAG</label>
  </div>

  <div>
    <div class="micro">Bet amount</div>
    <div style="display:flex;gap:10px;align-items:center">
      <input id="betQty" type="number" min="0" step="any" value="1"
        style="width:140px;background:#0b2217;border:1px solid #1b4a2f;
        border-radius:10px;color:#f3f5f0;padding:10px">
      <span class="unit">XRP</span>
    </div>
  </div>

  <div class="divider" style="height:1px;background:#123221;margin:10px 0"></div>
  <div class="micro">Live prices</div>
  <div class="muted mono" id="liveLine">BAG $‚Äî ¬∑ XRP $‚Äî</div>

  <div class="divider" style="height:1px;background:#123221;margin:10px 0"></div>
  <div id="dice-win-readout"></div>
 </div>
</div>

<div class="divider" style="height:1px;background:#123221;margin:14px 0"></div>

<div class="marquee">$BAG AIR HOCKEY</div>
<div class="table">
 <div class="felt">
  <div class="stage3d" id="hockeyStage"></div>
  <div class="hudbar">
    <span class="pill balance">Balance: <b id="balLbl">‚Äî</b> <span id="ccyLbl">BAG</span></span>
    <span class="pill">Mode: <b id="modeLbl">Demo</b></span>
    <span class="pill">Bet: <b id="betLbl">1</b></span>
    <span class="pill">Last: <b id="lastLbl">‚Äî</b></span>
  </div>
 </div>
</div>
</div></div></section>

<!-- ========== AIR HOCKEY ENGINE ========== -->
<script>
const config={
  type:Phaser.AUTO,
  parent:'hockeyStage',
  scale:{mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH,width:1024,height:1536},
  backgroundColor:'#021107',
  physics:{default:'arcade',arcade:{debug:false,fps:120,step:1/240}},
  scene:{preload,create,update}
};
let puck,player,cpu,scoreText,topGoal,bottomGoal;
let scorePlayer=0,scoreCPU=0;
let touchTarget={x:0,y:0,active:false};
let prevPlayer={x:0,y:0};
let lastHit=0;
new Phaser.Game(config);

function preload(){
 this.load.image('table','/arcade/assets/img/airhockey_table-1024.webp');
 this.load.image('puck','/arcade/assets/img/puck-1024.webp');
 this.load.image('paddle_gold','/arcade/assets/img/paddle_gold-1024.webp');
 this.load.image('paddle_green','/arcade/assets/img/paddle_green-1024.webp');
}
function create(){
 const w=this.scale.width,h=this.scale.height,cx=w/2,cy=h/2;
 this.add.image(cx,cy,'table').setDisplaySize(w,h);
 const goalW=260,goalH=40;
 topGoal=this.add.rectangle(cx,70,goalW,goalH,0xff0000,0.4);
 bottomGoal=this.add.rectangle(cx,h-70,goalW,goalH,0x00ff00,0.4);
 this.physics.world.setBounds(80,80,w-160,h-160);
 puck=this.physics.add.image(cx,cy,'puck').setScale(0.07);
 puck.setCollideWorldBounds(true).setBounce(0.99).setDamping(true)
     .setDrag(0.99,0.99).setMaxVelocity(1600);
 puck.body.setCircle(puck.width*0.6);
 player=this.physics.add.image(cx,h*0.85,'paddle_gold').setScale(0.1);
 cpu=this.physics.add.image(cx,h*0.15,'paddle_green').setScale(0.1);
 player.body.collideWorldBounds=false;
 cpu.setCollideWorldBounds(true);
 player.setImmovable(true); cpu.setImmovable(true);
 this.physics.add.collider(puck,cpu,onHit,null,this);
 this.input.on('pointerdown',p=>{if(p.y>h*0.5){touchTarget.active=true;touchTarget.x=p.x;touchTarget.y=p.y;}});
 this.input.on('pointermove',p=>{if(touchTarget.active&&p.y>h*0.5){touchTarget.x=p.x;touchTarget.y=p.y;}});
 this.input.on('pointerup',()=>touchTarget.active=false);
 scoreText=this.add.text(cx,40,'0 - 0',{fontFamily:'Orbitron',fontSize:'48px',color:'#ffe175',stroke:'#2fbf6b',strokeThickness:3}).setOrigin(0.5,0);
 resetPuck.call(this);
}
function checkManualHit(){
 const now=performance.now(); if(now-lastHit<50)return;
 const dx=puck.x-player.x,dy=puck.y-player.y;
 const dist=Math.sqrt(dx*dx+dy*dy);
 const minDist=(puck.displayWidth*0.35)+(player.displayWidth*0.35);
 if(dist<minDist){
  lastHit=now;
  const nx=dx/dist,ny=dy/dist;
  const vx=player.x-prevPlayer.x,vy=player.y-prevPlayer.y;
  const paddleSpeed=Math.sqrt(vx*vx+vy*vy);
  const impulse=Phaser.Math.Clamp(400+paddleSpeed*220,400,1700);
  puck.body.velocity.x=nx*impulse;
  puck.body.velocity.y=ny*impulse;
  puck.setAngularVelocity(Phaser.Math.Between(-220,220));
 }
}
function onHit(puck,paddle){
 const dx=puck.x-paddle.x,dy=puck.y-paddle.y;
 const dist=Math.sqrt(dx*dx+dy*dy)||1;
 const nx=dx/dist,ny=dy/dist;
 const vx=paddle.x-prevPlayer.x,vy=paddle.y-prevPlayer.y;
 const paddleSpeed=Math.sqrt(vx*vx+vy*vy);
 const force=Phaser.Math.Clamp(400+paddleSpeed*200,400,1500);
 puck.body.velocity.x=nx*force; puck.body.velocity.y=ny*force;
}
function update(){
 const w=this.scale.width,h=this.scale.height;
 prevPlayer.x=player.x; prevPlayer.y=player.y;
 if(touchTarget.active){const dx=touchTarget.x-player.x,dy=touchTarget.y-player.y;player.x+=dx*0.5;player.y+=dy*0.5;}
 player.x=Phaser.Math.Clamp(player.x,100,w-100);
 player.y=Phaser.Math.Clamp(player.y,h*0.5+20,h-80);
 cpu.x+=(puck.x-cpu.x)*0.08; cpu.y+=(puck.y-cpu.y)*0.05;
 cpu.x=Phaser.Math.Clamp(cpu.x,100,w-100); cpu.y=Phaser.Math.Clamp(cpu.y,80,h*0.45);
 checkManualHit();
 const goalHalfW=130;
 if(puck.y<topGoal.y&&Math.abs(puck.x-w/2)<goalHalfW){scorePlayer++;resetPuck.call(this,'player');flashGoal(topGoal,0xff0000);}
 if(puck.y>bottomGoal.y&&Math.abs(puck.x-w/2)<goalHalfW){scoreCPU++;resetPuck.call(this,'cpu');flashGoal(bottomGoal,0x00ff00);}
}
function flashGoal(goal,c){goal.setFillStyle(c,0.9);setTimeout(()=>goal.setFillStyle(c,0.4),180);}
function resetPuck(scoredBy){
 const w=this.scale.width,h=this.scale.height;
 puck.setPosition(w/2,h/2);
 const angle=Phaser.Math.Between(20,160)*(Phaser.Math.Between(0,1)?1:-1);
 const speed=Phaser.Math.Between(600,750);
 const vx=Math.cos(angle*Math.PI/180)*speed;
 const vy=(scoredBy==='player'?-1:1)*Math.abs(Math.sin(angle*Math.PI/180)*speed);
 puck.setVelocity(vx,vy);
 scoreText.setText(`${scorePlayer} - ${scoreCPU}`);
}
</script>

<!-- RULES + FOOTER -->
<button id="rulesFab" style="position:fixed;bottom:16px;right:16px;padding:10px 16px;border:0;
 border-radius:12px;font-weight:900;background:linear-gradient(180deg,#ffe175,#f5c94c);
 box-shadow:0 4px 0 #b08a19;cursor:pointer;">‚ÑπÔ∏è Rules</button>
<div id="rulesOverlay" style="display:none;place-items:center;position:fixed;inset:0;z-index:3000;
 backdrop-filter:blur(6px);background:rgba(0,0,0,.45);padding:18px;">
 <div style="width:min(680px,92vw);background:linear-gradient(180deg,var(--panel),var(--panel2));
  border:1px solid var(--line);border-radius:16px;padding:18px;color:var(--fg);position:relative;">
  <button id="rulesClose" style="position:absolute;top:8px;right:12px;border:0;background:transparent;
   color:#e9efe9;font-size:24px;cursor:pointer;">√ó</button>
  <h3>üèí $BAG Air Hockey Rules</h3>
  <ul>
   <li>First to 7 points wins the match.</li>
   <li>5% house fee applies to all winnings.</li>
   <li>Default mode: Player vs CPU. Toggle PvP to challenge another player.</li>
   <li>All stakes and payouts settle in $BAG at live XRPL AMM rate.</li>
  </ul>
  <div style="color:#aeb7af;margin-top:10px">Demo mode uses virtual balances only.</div>
 </div>
</div>

<footer style="text-align:center;padding:12px 0;line-height:1.6;">
  ¬© 2025 $BAG Protocol | getthebag.io | Powered by $XRP <br>
  <a href="https://x.com/getthebag_io" target="_blank" style="color:#e0c66f;text-decoration:none;font-weight:700;">ùïè @getthebag_io</a> |
  <a href="https://t.me/getthebag_io" target="_blank" style="color:#e0c66f;text-decoration:none;font-weight:700;">Telegram @getthebag_io</a>
</footer>

<script>
const fab=document.getElementById('rulesFab'),ov=document.getElementById('rulesOverlay'),x=document.getElementById('rulesClose');
const open=()=>ov.style.display='grid',close=()=>ov.style.display='none';
fab.addEventListener('click',open);x.addEventListener('click',close);
ov.addEventListener('click',e=>{if(e.target===ov)close();});
</script>

</body>
</html>
