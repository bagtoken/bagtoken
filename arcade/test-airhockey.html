<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>üèí $BAG Air Hockey ‚Äî Arcade P2E</title>

<link rel="preconnect" href="https://api.coingecko.com" crossorigin>
<script src="https://xaman.app/assets/cdn/xumm.min.js"></script>

<style>
:root{
  --gold:#ffe175;--bg:#020703;--panel:#0b1b13;--panel2:#0d2217;
  --muted:#aeb7af;--fg:#f5f7f4;--green:#2fbf6b;--line:#173524;--shadow:rgba(0,0,0,.35);
}
html,body{margin:0;padding:0;background:var(--bg);color:var(--fg);
  font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;line-height:1.55;}
img{display:block;max-width:100%;height:auto}
.btn{cursor:pointer;border:0;border-radius:12px;padding:10px 14px;
  font-weight:900;background:linear-gradient(180deg,#ffe175,#f5c94c);
  color:#08130d;box-shadow:0 4px 0 #b08a19;}
.btn:active{transform:translateY(1px);box-shadow:0 3px 0 #9a7315;}
.panel{background:linear-gradient(180deg,var(--panel) 0%,var(--panel2) 100%);
  border:1px solid var(--line);border-radius:16px;box-shadow:0 8px 24px var(--shadow);}
.pad{padding:16px}
.marquee{text-align:center;font-weight:900;letter-spacing:.08em;color:#ffe9a6;
  background:linear-gradient(180deg,#17311f,#0e2419);
  border:1px solid #254a33;border-radius:12px;padding:8px;margin:10px 0;}
.divider{height:1px;background:#123221;margin:10px 0}
</style>
</head>
<body>

<a href="/casino/" class="btn" style="position:fixed;top:18px;left:18px;z-index:1000;">‚¨ÖÔ∏è Back to Casino</a>

<section style="text-align:center;padding-top:60px;">
  <picture>
    <source type="image/webp" srcset="/arcade/assets/img/airhockey_table-1024.webp 1024w">
    <img src="/arcade/assets/img/airhockey_table-1024.webp" alt="$BAG Air Hockey" width="1024" height="576" loading="lazy">
  </picture>
  <h2 style="margin:10px 0 4px">üèí $BAG Air Hockey ‚Äî Arcade P2E</h2>
  <p style="font-size:.9rem;opacity:.85">üí∞ All payouts in $BAG. $XRP bets convert automatically at the live rate.</p>
</section>

<section style="padding:0 16px 80px;">
  <div class="panel pad">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
      <div id="sessionStatus" style="font-size:.9rem">Session: <span style="color:#2fbf6b">Practice</span></div>
      <button id="startSessionBtn" class="btn">Start Session</button>
    </div>

    <div class="divider"></div>

    <div class="marquee">$BAG LIVE PRICES</div>
    <div style="text-align:center;font-family:monospace;">
      <span id="liveDot" style="color:#e8a85c">‚óè</span>
      BAG $<span id="liveBAG">‚Äî</span> ¬∑ XRP $<span id="liveXRP">‚Äî</span>
      <div id="liveConv" style="font-size:.85rem;opacity:.85;margin-top:4px">
        1 BAG ‚âà ‚Äî XRP ¬∑ 1 XRP ‚âà ‚Äî BAG
      </div>
    </div>

    <div class="divider"></div>

    <div id="practiceBalance" style="text-align:center;line-height:1.6">
      <div style="font-weight:800">Practice Balance</div>
      <div>BAG: <span id="balBAG">‚Äî</span>  XRP: <span id="balXRP">‚Äî</span></div>
      <div>USD: <span id="balUSD">‚Äî</span></div>
    </div>
  </div>
</section>

<footer style="text-align:center;padding:14px 0;font-size:.9rem;color:#b9c1b5">
  ¬© 2025 $BAG Protocol | getthebag.io | Powered by $XRP
</footer>

<!-- üîπ Live price refresh (same core as Dice) -->
<script>
(function(){
  const PRICE_REFRESH_MS=15000;
  const BAG_ISSUER='rNeYbfb9EDV8c7mNfUuooEEYYzMcEuDFbr',BAG_CODE='BAG';
  const P={bagUsd:0,xrpUsd:0};
  const fmt=n=>Number.isFinite(n)?n.toFixed(6):'‚Äî';
  async function fetchPrices(){
    try{
      const r1=await fetch('https://api.coingecko.com/api/v3/simple/price?ids=ripple&vs_currencies=usd');
      const xrp=(await r1.json())?.ripple?.usd||0;
      const ws=new WebSocket('wss://s1.ripple.com');
      const p2=new Promise(res=>{
        const req={id:1,command:'amm_info',asset:{currency:BAG_CODE,issuer:BAG_ISSUER},asset2:{currency:'XRP'}};
        ws.onopen=()=>ws.send(JSON.stringify(req));
        ws.onmessage=e=>{
          try{const d=JSON.parse(e.data);
            if(d.result?.amm){const a=+d.result.amm.amount.value,b=+d.result.amm.amount2.value;
              if(a>0&&b>0){res(b/a*xrp);}ws.close();}
          }catch{}
        };
        setTimeout(()=>{try{ws.close();}catch{};res(null);},6000);
      });
      const bagUsd=await p2;
      if(xrp>0&&bagUsd>0){P.xrpUsd=xrp;P.bagUsd=bagUsd;update();}
    }catch{}
  }
  function update(){
    document.getElementById('liveBAG').textContent=fmt(P.bagUsd);
    document.getElementById('liveXRP').textContent=fmt(P.xrpUsd);
    const conv=document.getElementById('liveConv');
    if(P.bagUsd&&P.xrpUsd){
      const xrpPerBag=P.bagUsd/P.xrpUsd,bagPerXrp=P.xrpUsd/P.bagUsd;
      conv.textContent=`1 BAG ‚âà ${xrpPerBag.toFixed(6)} XRP ¬∑ 1 XRP ‚âà ${bagPerXrp.toFixed(6)} BAG`;
    }
    document.dispatchEvent(new Event('bag:pricesUpdated'));
  }
  fetchPrices(); setInterval(fetchPrices,PRICE_REFRESH_MS);
})();
</script>

<!-- üîπ Practice balance system -->
<script>
(function(){
  const BAL_KEY='bag_demo_balance',USD_START=2000;
  let bagUsd=0;
  function PR(){return window.P||{bagUsd:0,xrpUsd:0};}
  function getBag(){return Number(localStorage.getItem(BAL_KEY)||0);}
  function setBag(v){localStorage.setItem(BAL_KEY,v);}
  function seed(){
    const bag=getBag();if(bag>0)return;
    const p=window.P?.bagUsd||0;if(p>0){setBag(USD_START/p);}
  }
  function render(){
    const bal=getBag(),p=window.P||{bagUsd:0,xrpUsd:0};
    const usd=(p.bagUsd>0)?bal*p.bagUsd:USD_START;
    const xrp=(p.bagUsd>0&&p.xrpUsd>0)?bal*(p.bagUsd/p.xrpUsd):0;
    document.getElementById('balBAG').textContent=bal.toFixed(2);
    document.getElementById('balXRP').textContent=xrp.toFixed(2);
    document.getElementById('balUSD').textContent='$'+usd.toFixed(2);
  }
  document.getElementById('startSessionBtn').addEventListener('click',()=>{seed();render();});
  document.addEventListener('bag:pricesUpdated',render);
})();
</script>

</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>üèí $BAG Air Hockey ‚Äî Arcade P2E</title>

<link rel="preconnect" href="https://api.coingecko.com" crossorigin>
<script src="https://cdn.jsdelivr.net/npm/phaser@3.70.0/dist/phaser.min.js"></script>
<script src="https://xaman.app/assets/cdn/xumm.min.js"></script>

<style>
:root{
 --gold:#ffe175;--bg:#020703;--panel:#0b1b13;--panel2:#0d2217;
 --muted:#aeb7af;--fg:#f5f7f4;--green:#2fbf6b;--line:#173524;--shadow:rgba(0,0,0,.35);
}
html,body{margin:0;padding:0;background:var(--bg);color:var(--fg);
 font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;line-height:1.55;overflow-x:hidden;}
img{max-width:100%;display:block;height:auto}
.panel{background:linear-gradient(180deg,var(--panel),var(--panel2));
 border:1px solid var(--line);border-radius:16px;box-shadow:0 8px 24px var(--shadow);}
.pad{padding:16px}
.divider{height:1px;background:#123221;margin:10px 0}
.marquee{text-align:center;font-weight:900;letter-spacing:.08em;color:#ffe9a6;
 background:linear-gradient(180deg,#17311f,#0e2419);
 border:1px solid #254a33;border-radius:12px;padding:8px;margin:10px 0;}
.btn{cursor:pointer;border:0;border-radius:12px;padding:10px 14px;
 font-weight:900;background:linear-gradient(180deg,#ffe175,#f5c94c);
 color:#08130d;box-shadow:0 4px 0 #b08a19;}
.btn:active{transform:translateY(1px);box-shadow:0 3px 0 #9a7315;}
canvas{display:block;margin:auto;}
</style>
</head>
<body>

<a href="/casino/" class="btn" style="position:fixed;top:18px;left:18px;z-index:1000;">‚¨ÖÔ∏è Back</a>

<section style="text-align:center;padding-top:60px;">
 <picture>
   <source type="image/webp" srcset="/arcade/assets/img/airhockey_table-1024.webp 1024w">
   <img src="/arcade/assets/img/airhockey_table-1024.webp" width="1024" height="576" alt="$BAG Air Hockey">
 </picture>
 <h2 style="margin:10px 0 4px">üèí $BAG Air Hockey ‚Äî Arcade P2E</h2>
 <p style="font-size:.9rem;opacity:.85">üí∞ All payouts in $BAG. $XRP bets convert automatically at live rate.</p>
</section>

<section style="padding:0 16px 80px;">
 <div class="panel pad">
   <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
     <div id="sessionStatus" style="font-size:.9rem">Session: <span style="color:#2fbf6b">Practice</span></div>
     <button id="startSessionBtn" class="btn">Start Session</button>
   </div>

   <div class="divider"></div>

   <div class="marquee">$BAG LIVE PRICES</div>
   <div style="text-align:center;font-family:monospace;">
     <span id="liveDot" style="color:#e8a85c">‚óè</span>
     BAG $<span id="liveBAG">‚Äî</span> ¬∑ XRP $<span id="liveXRP">‚Äî</span>
     <div id="liveConv" style="font-size:.85rem;opacity:.85;margin-top:4px">
       1 BAG ‚âà ‚Äî XRP ¬∑ 1 XRP ‚âà ‚Äî BAG
     </div>
   </div>

   <div class="divider"></div>

   <div id="practiceBalance" style="text-align:center;line-height:1.6">
     <div style="font-weight:800">Practice Balance</div>
     <div>BAG: <span id="balBAG">‚Äî</span>  XRP: <span id="balXRP">‚Äî</span></div>
     <div>USD: <span id="balUSD">‚Äî</span></div>
   </div>

   <div class="divider"></div>
   <div class="marquee">$BAG AIR HOCKEY</div>

   <div class="panel" style="padding:0;border-radius:12px;">
     <div id="gameContainer" style="width:100%;aspect-ratio:2/3;max-width:1024px;margin:auto;"></div>
   </div>
 </div>
</section>

<footer style="text-align:center;padding:14px 0;font-size:.9rem;color:#b9c1b5">
  ¬© 2025 $BAG Protocol | getthebag.io | Powered by $XRP
</footer>

<!-- Live price and practice balance (same as Drop 1) -->
<script>
(function(){
 const PRICE_REFRESH_MS=15000,BAG_ISSUER='rNeYbfb9EDV8c7mNfUuooEEYYzMcEuDFbr',BAG_CODE='BAG';
 window.P={bagUsd:0,xrpUsd:0};
 const fmt=n=>Number.isFinite(n)?n.toFixed(6):'‚Äî';
 async function refresh(){
  try{
   const r=await fetch('https://api.coingecko.com/api/v3/simple/price?ids=ripple&vs_currencies=usd');
   const xrp=(await r.json())?.ripple?.usd||0;
   const ws=new WebSocket('wss://s1.ripple.com');
   const bagUsd=await new Promise(res=>{
    const req={id:1,command:'amm_info',asset:{currency:BAG_CODE,issuer:BAG_ISSUER},asset2:{currency:'XRP'}};
    ws.onopen=()=>ws.send(JSON.stringify(req));
    ws.onmessage=e=>{
     try{const d=JSON.parse(e.data);if(d.result?.amm){const a=+d.result.amm.amount.value,b=+d.result.amm.amount2.value;
     if(a>0&&b>0)res(b/a*xrp);ws.close();}}catch{}};
    setTimeout(()=>{try{ws.close();}catch{};res(null);},6000);
   });
   if(xrp>0&&bagUsd>0){P.xrpUsd=xrp;P.bagUsd=bagUsd;update();}
  }catch{}
 }
 function update(){
  document.getElementById('liveBAG').textContent=fmt(P.bagUsd);
  document.getElementById('liveXRP').textContent=fmt(P.xrpUsd);
  if(P.bagUsd&&P.xrpUsd){
   const xrpPerBag=P.bagUsd/P.xrpUsd,bagPerXrp=P.xrpUsd/P.bagUsd;
   document.getElementById('liveConv').textContent=`1 BAG ‚âà ${xrpPerBag.toFixed(6)} XRP ¬∑ 1 XRP ‚âà ${bagPerXrp.toFixed(6)} BAG`;
  }
  document.dispatchEvent(new Event('bag:pricesUpdated'));
 }
 refresh();setInterval(refresh,PRICE_REFRESH_MS);
})();
</script>

<script>
(function(){
 const BAL_KEY='bag_demo_balance',USD_START=2000;
 function getBag(){return Number(localStorage.getItem(BAL_KEY)||0);}
 function setBag(v){localStorage.setItem(BAL_KEY,v);}
 function seed(){if(getBag()>0)return;const p=window.P?.bagUsd||0;if(p>0)setBag(USD_START/p);}
 function render(){
  const bal=getBag(),p=window.P;
  const usd=(p.bagUsd>0)?bal*p.bagUsd:USD_START;
  const xrp=(p.bagUsd>0&&p.xrpUsd>0)?bal*(p.bagUsd/p.xrpUsd):0;
  document.getElementById('balBAG').textContent=bal.toFixed(2);
  document.getElementById('balXRP').textContent=xrp.toFixed(2);
  document.getElementById('balUSD').textContent='$'+usd.toFixed(2);
 }
 document.getElementById('startSessionBtn').addEventListener('click',()=>{seed();render();});
 document.addEventListener('bag:pricesUpdated',render);
})();
</script>

<!-- üéÆ AIR HOCKEY GAME -->
<script>
const config={
 type:Phaser.AUTO,
 scale:{mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH,width:1024,height:1536,parent:'gameContainer'},
 backgroundColor:'#021107',
 physics:{default:'arcade',arcade:{debug:false,fps:120,step:1/240}},
 scene:{preload,create,update}
};
let puck,player,cpu,scoreText,topGoal,bottomGoal;
let scorePlayer=0,scoreCPU=0;
let touchTarget={x:0,y:0,active:false};
let prevPlayer={x:0,y:0};
let lastHit=0;
new Phaser.Game(config);

function preload(){
 this.load.image('table','/arcade/assets/img/airhockey_table-1024.webp');
 this.load.image('puck','/arcade/assets/img/puck-1024.webp');
 this.load.image('paddle_gold','/arcade/assets/img/paddle_gold-1024.webp');
 this.load.image('paddle_green','/arcade/assets/img/paddle_green-1024.webp');
}
function create(){
 const w=this.scale.width,h=this.scale.height,cx=w/2,cy=h/2;
 this.add.image(cx,cy,'table').setDisplaySize(w,h);
 const goalW=260,goalH=40;
 topGoal=this.add.rectangle(cx,70,goalW,goalH,0xff0000,0.4);
 bottomGoal=this.add.rectangle(cx,h-70,goalW,goalH,0x00ff00,0.4);
 this.physics.world.setBounds(80,80,w-160,h-160);
 puck=this.physics.add.image(cx,cy,'puck').setScale(0.07);
 puck.setCollideWorldBounds(true).setBounce(0.99).setDamping(true)
  .setDrag(0.99,0.99).setMaxVelocity(1600);
 puck.body.setCircle(puck.width*0.6);
 player=this.physics.add.image(cx,h*0.85,'paddle_gold').setScale(0.1);
 cpu=this.physics.add.image(cx,h*0.15,'paddle_green').setScale(0.1);
 player.body.collideWorldBounds=false;cpu.setCollideWorldBounds(true);
 player.setImmovable(true);cpu.setImmovable(true);
 this.physics.add.collider(puck,cpu,onHit,null,this);
 this.input.on('pointerdown',p=>{if(p.y>h*0.5){touchTarget.active=true;touchTarget.x=p.x;touchTarget.y=p.y;}});
 this.input.on('pointermove',p=>{if(touchTarget.active&&p.y>h*0.5){touchTarget.x=p.x;touchTarget.y=p.y;}});
 this.input.on('pointerup',()=>touchTarget.active=false);
 scoreText=this.add.text(cx,40,'0 - 0',{fontFamily:'Orbitron',fontSize:'48px',color:'#ffe175',stroke:'#2fbf6b',strokeThickness:3}).setOrigin(0.5,0);
 resetPuck.call(this);
}
function checkManualHit(){
 const now=performance.now();if(now-lastHit<50)return;
 const dx=puck.x-player.x,dy=puck.y-player.y;
 const dist=Math.sqrt(dx*dx+dy*dy);
 const minDist=(puck.displayWidth*0.35)+(player.displayWidth*0.35);
 if(dist<minDist){
  lastHit=now;
  const nx=dx/dist,ny=dy/dist;
  const vx=player.x-prevPlayer.x,vy=player.y-prevPlayer.y;
  const speed=Math.sqrt(vx*vx+vy*vy);
  const imp=Phaser.Math.Clamp(400+speed*220,400,1700);
  puck.body.velocity.x=nx*imp;puck.body.velocity.y=ny*imp;
  puck.setAngularVelocity(Phaser.Math.Between(-220,220));
 }
}
function onHit(puck,paddle){
 const dx=puck.x-paddle.x,dy=puck.y-paddle.y,dist=Math.sqrt(dx*dx+dy*dy)||1;
 const nx=dx/dist,ny=dy/dist;
 const force=Phaser.Math.Clamp(400+Math.random()*800,400,1500);
 puck.body.velocity.x=nx*force;puck.body.velocity.y=ny*force;
}
function update(){
 const w=this.scale.width,h=this.scale.height;
 prevPlayer.x=player.x;prevPlayer.y=player.y;
 if(touchTarget.active){const dx=touchTarget.x-player.x,dy=touchTarget.y-player.y;
  player.x+=dx*0.5;player.y+=dy*0.5;}
 player.x=Phaser.Math.Clamp(player.x,100,w-100);
 player.y=Phaser.Math.Clamp(player.y,h*0.5+20,h-80);
 cpu.x+=(puck.x-cpu.x)*0.08;cpu.y+=(puck.y-cpu.y)*0.05;
 cpu.x=Phaser.Math.Clamp(cpu.x,100,w-100);cpu.y=Phaser.Math.Clamp(cpu.y,80,h*0.45);
 checkManualHit();
 const goalHalfW=130;
 if(puck.y<topGoal.y&&Math.abs(puck.x-w/2)<goalHalfW){scorePlayer++;resetPuck.call(this,'player');flashGoal(topGoal,0xff0000);}
 if(puck.y>bottomGoal.y&&Math.abs(puck.x-w/2)<goalHalfW){scoreCPU++;resetPuck.call(this,'cpu');flashGoal(bottomGoal,0x00ff00);}
}
function flashGoal(goal,color){goal.setFillStyle(color,0.9);setTimeout(()=>goal.setFillStyle(color,0.4),180);}
function resetPuck(by){
 const w=this.scale.width,h=this.scale.height;
 puck.setPosition(w/2,h/2);
 const angle=Phaser.Math.Between(20,160)*(Phaser.Math.Between(0,1)?1:-1);
 const speed=Phaser.Math.Between(600,750);
 const vx=Math.cos(angle*Math.PI/180)*speed;
 const vy=(by==='player'?-1:1)*Math.abs(Math.sin(angle*Math.PI/180)*speed);
 puck.setVelocity(vx,vy);
 scoreText.setText(`${scorePlayer} - ${scoreCPU}`);
}
</script>

</body>
</html>
