<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<meta name="format-detection" content="telephone=no" />
<title>$BAG Air Hockey — Arcade P2E</title>
<link rel="preconnect" href="https://api.coingecko.com" crossorigin>
<script src="https://xaman.app/assets/cdn/xumm.min.js"></script>
<script>window.__BAG_FORCE_DEMO = false;</script>
<script src="https://cdn.jsdelivr.net/npm/phaser@3.70.0/dist/phaser.min.js"></script>
<style>
  *{box-sizing:border-box;margin:0;padding:0}
  :root{
    --gold:#ffe175;--bg:#020703;--panel:#0b1b13;--panel2:#0d2217;--muted:#aeb7af;--fg:#f5f7f4;
    --green:#2fbf6b;--green-600:#249a55;--line:#173524;--shadow:rgba(0,0,0,.35);
    --lose:#e25b5b; --warn:#e8a85c;
  }
  html,body{background:var(--bg);color:var(--fg);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;line-height:1.55;overflow-y:auto}
  img{max-width:100%;height:auto}
  button,input{font-size:16px}
  .back-casino{
    position:fixed;top:18px;left:18px;z-index:1000;
    background:linear-gradient(180deg,#ffe175 0%,#f5c94c 100%);
    color:#08130d;text-decoration:none;font-weight:800;padding:8px 14px;border-radius:10px;
    box-shadow:0 4px 0 #b08a19;transition:all .15s ease
  }
  .back-casino:hover{filter:brightness(1.05)}
  .back-casino:active{transform:translateY(1px)}
  .game-header{text-align:center;padding:36px 10px 14px}
  .game-header img.hero-img{margin:0 auto 10px;filter:drop-shadow(0 10px 24px rgba(46,191,107,.18))}
  .game-header h2{font-size:clamp(1.6rem,5vw,2.2rem);margin:6px 0 0}
  .game-teaser{padding:10px 16px 80px;background:
    radial-gradient(1200px 600px at 10% -10%, #0e2c1d 0%, transparent 60%),
    radial-gradient(900px 500px at 110% 20%, #0b2318 0%, transparent 55%),#060806;
    border-top:1px solid #131313;border-bottom:1px solid #131313}
  .game-wrap{max-width:1080px;margin:0 auto;display:grid;gap:22px}
  .panel{background:linear-gradient(180deg,var(--panel) 0%,var(--panel2) 100%);
    border:1px solid var(--line);border-radius:16px;box-shadow:0 8px 24px var(--shadow)}
  .pad{padding:16px}
  .section-title{font-weight:800;font-size:1.2rem;margin:0 0 12px}
  .stake-box{padding:14px}
  .stack{display:grid;gap:10px}
  .choice{display:flex;gap:10px;flex-wrap:wrap}
  .chip{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:999px;border:1px solid #2b6a48;background:#0e2a1c;color:#e9efe9;font-weight:800}
  .chip input{accent-color:#2fbf6b}
  .mono{font-variant-numeric:tabular-nums}
  .micro{font-size:.85rem;color:#a8b5ab}
  .muted{color:#cfd6cf}
  .divider{height:1px;background:#123221;margin:10px 0}
  #liveDot{margin-right:6px}.ok{color:#2fbf6b}.warn{color:#e8a85c}.err{color:var(--lose)}
  .table{background:#07140e;border:1px solid #1b4a2f;border-radius:14px;padding:14px}
  .felt{
    display:grid;gap:12px;
    background:#091a13;border:1px solid #24533a;border-radius:12px;padding:12px;
    position:relative;overflow:hidden;
    box-shadow:inset 0 0 30px rgba(0,0,0,.6), 0 0 20px rgba(47,191,107,.2);
  }
  .marquee{
    text-align:center;font-weight:900;letter-spacing:.08em;color:#ffe9a6;
    background:linear-gradient(180deg,#17331f,#0e2419);
    border:1px solid #254a33;border-radius:12px;padding:8px;
    box-shadow:0 0 10px rgba(255,233,166,.3);
  }
  .roll-row{display:flex;justify-content:center}
  .btn-roll{
    width:min(360px,90%);padding:16px 22px;margin-top:2px;
    font-size:1.15rem;font-weight:900;text-transform:uppercase;letter-spacing:.5px;border:0;border-radius:14px;
    color:#08130d;background:linear-gradient(180deg,#ffe175 0%, #f5c94c 100%);
    box-shadow:0 6px 0 #b08a19, 0 16px 32px rgba(255,225,117,.18), inset 0 1px 0 rgba(255,255,255,.35);
    transition:transform .06s ease, box-shadow .2s ease, filter .2s ease; cursor:pointer;
  }
  .btn-roll:active{transform:translateY(2px)}
  .btn-roll:disabled{opacity:.65;cursor:not-allowed}
  .result{margin-top:10px;padding:12px;border:1px solid #1b4a2f;border-radius:12px;background:#0b2217;display:flex;align-items:center;gap:10px}
  .t.win{color:#2fbf6b}.t.lose{color:var(--lose)}
  .hudbar{
    display:grid;
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    gap:6px;
    align-items:center;
    margin:6px 2px 0;
  }
  .pill{ background:#0a1e15; border:1px solid #244330; border-radius:999px; padding:6px 10px; font-size:12px; color:#cfe6d8 }
  .hudbar .pill b{ font-weight:800 }
  .hudbar .pill.balance{
    grid-column: 1 / -1;
    font-size:14px;
    padding:8px 12px;
    font-weight:800;
  }
  .preset-chips{ display:flex; gap:8px; flex-wrap:wrap; margin-top:8px; }
  .preset-chip{
    appearance:none;border:1px solid var(--green-600);background:var(--green);color:#fff;border-radius:999px;
    padding:8px 12px;font-weight:900;letter-spacing:.2px;cursor:pointer;
    box-shadow:0 4px 10px rgba(47,191,107,.18), inset 0 1px 0 rgba(255,255,255,.12);
    transition:transform .06s ease, box-shadow .2s ease;
  }
  .preset-chip:hover{ filter:brightness(1.03); }
  .preset-chip:active{ transform:translateY(1px); }
  .preset-chip.active{ box-shadow:0 0 0 2px rgba(255,255,255,.25) inset, 0 8px 22px rgba(47,191,107,.25); }
  #hockey-win-readout{
    background: var(--panel2); border:1px solid var(--line); border-radius:14px;
    padding:16px; box-shadow:0 10px 24px var(--shadow); color:var(--fg);
  }
  #hockey-win-readout .row{display:flex;justify-content:space-between;gap:12px;margin:8px 0}
  #hockey-win-readout .title{font-weight:800;letter-spacing:.2px}
  #hockey-win-readout .note{color:var(--muted);font-size:.92rem;margin-top:10px;line-height:1.45}
  .rules-fab{ position:fixed; right:16px; bottom:16px; z-index:1000; padding:10px 14px; border-radius:999px; font-weight:800;
    border:1px solid #2b6a48; background:#0e2a1c; color:#e9efe9; box-shadow:0 8px 24px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.06); cursor:pointer }
  .rules-fab:hover{ filter:brightness(1.05) }
  .rules-fab:active{ transform:translateY(1px) }
  .rules-overlay{ position:fixed; inset:0; display:none; place-items:center; z-index:3000; backdrop-filter:blur(6px); background:rgba(0,0,0,.45); padding:18px; }
  .rules-modal{ width:min(680px,92vw); max-height:min(78vh,840px); overflow:auto;
    background:linear-gradient(180deg,var(--panel) 0%, var(--panel2) 100%); border:1px solid var(--line); border-radius:16px; box-shadow:0 24px 60px var(--shadow);
    color:#f5f7f4; padding:18px; position:relative; }
  .rules-modal h3{ margin:0 0 10px; } .rules-modal ul{ margin:10px 0; padding-left:20px; } .rules-modal .rules-note{ margin-top:10px; color:var(--muted); }
  .rules-close{ position:absolute; top:8px; right:12px; border:0; background:transparent; color:#e9efe9; font-size:24px; line-height:1; cursor:pointer; }
  #gameContainer{width:100%;height:600px;position:relative;overflow:hidden;background:#040b08;border-radius:10px}
  canvas{display:block;margin:auto}
</style>
</head>
<body>
<a href="/casino/" class="back-casino">Back to Casino</a>
<section class="game-header">
  <img class="hero-img" src="https://i.imgur.com/8f5wJ1n.png" alt="$BAG Air Hockey">
  <h2>$BAG AIR HOCKEY — Arcade P2E</h2>
  <p class="micro" style="margin-top:4px;opacity:.9;">All payouts in $BAG. $XRP bets convert at live rate.</p>
</section>
<section class="game-teaser">
  <div class="game-wrap">
    <div class="panel pad">
      <div id="sessionStatus" class="micro" style="opacity:.9">Session: <span style="color:#2fbf6b">Practice</span></div>
      <div class="section-title">Stake & Prices</div>
      <div class="stake-box">
        <div class="stack">
          <div>
            <div class="micro">Amount</div>
            <input id="usdBet" class="mono" type="number" inputmode="decimal" min="0" max="2000" step="0.01" placeholder="0.00" style="width:140px;background:#0b2217;border:1px solid #1b4a2f;border-radius:10px;color:#f3f5f0;padding:10px">
            <span class="micro unit">USD</span>
            <div class="preset-chips" id="usdPresets">
              <button type="button" class="preset-chip" data-usd="1">$1</button>
              <button type="button" class="preset-chip" data-usd="5">$5</button>
              <button type="button" class="preset-chip" data-usd="10">$10</button>
              <button type="button" class="preset-chip" data-usd="20">$20</button>
              <button type="button" class="preset-chip" data-usd="50">$50</button>
              <button type="button" class="preset-chip" data-usd="max">Max</button>
            </div>
          </div>
          <div>
            <div class="micro">Bet currency</div>
            <div class="choice" id="curToggle">
              <label class="chip"><input type="radio" name="betCur" value="XRP" checked> XRP</label>
              <label class="chip"><input type="radio" name="betCur" value="BAG"> BAG</label>
            </div>
          </div>
          <div>
            <div class="micro">Bet amount</div>
            <input id="betQty" class="mono" type="number" inputmode="decimal" min="0" step="any" value="1" style="width:140px;background:#0b2217;border:1px solid #1b4a2f;border-radius:10px;color:#f3f5f0;padding:10px">
            <span class="unit">XRP</span>
            <div class="micro" id="betLimits" style="margin-top:6px"></div>
          </div>
          <div class="divider"></div>
          <div class="micro">Live prices</div>
          <div class="muted mono" id="liveLine">
            <span id="liveDot" class="warn">●</span>
            <span> BAG $<span id="liveBAG">—</span> · XRP $<span id="liveXRP">—</span></span>
          </div>
          <div class="divider"></div>
          <div id="hockey-win-readout"></div>
        </div>
      </div>
      <div class="divider"></div>
      <div class="marquee">$BAG AIR HOCKEY</div>
      <div class="table">
        <div class="felt">
          <div id="gameContainer"></div>
          <div class="roll-row"><button id="playBtn" class="btn-roll">PLAY</button></div>
          <div class="hudbar" id="hockeyHud">
            <span class="pill balance">Balance: <b id="balLbl">2,000,000</b> <span id="ccyLbl">BAG</span></span>
            <span class="pill">Mode: <b id="modeLbl">Demo</b></span>
            <span class="pill">Stake: <b id="betLbl">1</b></span>
            <span class="pill">Score: <b id="scoreLbl">0-0</b></span>
          </div>
          <div class="result"><div class="t" id="playText">Tap PLAY to start — First to 7 wins</div></div>
        </div>
      </div>
    </div>
  </div>
</section>
<button class="rules-fab" id="rulesFab">Rules</button>
<div class="rules-overlay" id="rulesOverlay">
  <div class="rules-modal">
    <button class="rules-close" id="rulesClose">×</button>
    <h3>Air Hockey — Quick Rules</h3>
    <ul>
      <li>First to 7 points wins</li>
      <li>Win = 1.8× stake</li>
      <li>Perfect 7-0 = 3.0× JACKPOT</li>
      <li>Lose = lose stake</li>
      <li>$1–$2,000 per match</li>
    </ul>
  </div>
</div>

<!-- DEMO + BALANCE -->
<script>
(function(){
  const DEMO_BAL_KEY='__bag_demo_bag_v2', START_USD=2000, DEFAULT_BAG_USD=0.001;
  window.__BAG_FORCE_DEMO = true;
  window.__PRICES__ = {bagUsd:0.001, xrpUsd:0.60};
  function getBag(){ try{ const n=Number(localStorage.getItem(DEMO_BAL_KEY)); return n>0?n:0; }catch{ return 0; } }
  function setBag(v){ try{ localStorage.setItem(DEMO_BAL_KEY, String(Math.max(0, Number(v)||0))); }catch{} }
  if(!localStorage.getItem(DEMO_BAL_KEY)) setBag(START_USD / 0.001);
  window.__bagSession = {
    active:()=>true,
    get:()=>({bag:getBag()}),
    spend(b){ const cur=getBag(); if(b>cur) return false; setBag(cur-b); render(); return true; },
    credit(b){ setBag(getBag()+b); render(); }
  };
  function render(){
    const bag=getBag();
    document.getElementById('balLbl').textContent = bag.toLocaleString(undefined,{maximumFractionDigits:6});
    document.getElementById('playBtn').disabled = false;
  }
  render();
  document.getElementById('topUpBtn')?.addEventListener('click',()=>{ setBag(START_USD/0.001); render(); });
})();
</script>

<!-- PHASER GAME -->
<script>
const config = {
  type: Phaser.AUTO,
  parent: 'gameContainer',
  width: 800,
  height: 600,
  backgroundColor: '#040b08',
  physics: { default: 'arcade', arcade: { debug: false } },
  scene: { preload, create, update }
};
let puck, player, cpu, scoreText, startText, gameActive = false;
let scorePlayer = 0, scoreCPU = 0;
let touchX = 0, touchY = 0, touching = false;
const game = new Phaser.Game(config);
let mainScene;

function preload() {
  this.load.image('table', 'https://i.imgur.com/8f5wJ1n.png');
  this.load.image('puck', 'https://i.imgur.com/3zZ3Z3Z.png');
  this.load.image('paddle', 'https://i.imgur.com/5k5k5k5.png');
}

function create() {
  mainScene = this;
  const { width, height } = this.scale;
  this.add.image(width/2, height/2, 'table').setDisplaySize(width, height);
  puck = this.physics.add.image(width/2, height/2, 'puck').setScale(0.07).setCollideWorldBounds(true).setBounce(0.98);
  player = this.physics.add.image(width/2, height*0.8, 'paddle').setScale(0.1).setImmovable(true);
  cpu = this.physics.add.image(width/2, height*0.2, 'paddle').setScale(0.1).setImmovable(true);
  this.physics.add.collider(puck, player);
  this.physics.add.collider(puck, cpu);
  scoreText = this.add.text(width/2, 50, '0 - 0', { fontSize: '48px', color: '#ffe175' }).setOrigin(0.5);
  startText = this.add.text(width/2, height/2, 'Ready to Play', { fontSize: '48px', color: '#ffe175' }).setOrigin(0.5);
  this.input.on('pointerdown', p => { if (p.y > height/2) { touching = true; touchX = p.x; touchY = p.y; } });
  this.input.on('pointermove', p => { if (touching && p.y > height/2) { touchX = p.x; touchY = p.y; } });
  this.input.on('pointerup', () => touching = false);
  this.startGame = () => {
    gameActive = true; startText.setVisible(false); scorePlayer = 0; scoreCPU = 0; resetPuck(); 
    document.getElementById('playText').textContent = 'Match in progress...';
  };
}

function update() {
  if (!gameActive) return;
  const { width, height } = this.scale;
  if (touching) {
    player.x += (touchX - player.x) * 0.3;
    player.y += (touchY - player.y) * 0.3;
  }
  player.x = Phaser.Math.Clamp(player.x, 100, width - 100);
  player.y = Phaser.Math.Clamp(player.y, height/2 + 50, height - 100);
  cpu.x += (puck.x - cpu.x) * 0.1;
  cpu.y += (puck.y - cpu.y) * 0.05;
  cpu.x = Phaser.Math.Clamp(cpu.x, 100, width - 100);
  cpu.y = Phaser.Math.Clamp(cpu.y, 100, height/2 - 50);
  if (puck.y < 100 && Math.abs(puck.x - width/2) < 130) { scorePlayer++; resetPuck(); }
  if (puck.y > height - 100 && Math.abs(puck.x - width/2) < 130) { scoreCPU++; resetPuck(); }
  scoreText.setText(`${scorePlayer} - ${scoreCPU}`);
  document.getElementById('scoreLbl').textContent = `${scorePlayer}-${scoreCPU}`;
  if (scorePlayer >= 7 || scoreCPU >= 7) endGame();
}

function resetPuck() {
  const { width, height } = mainScene.scale;
  puck.setPosition(width/2, height/2);
  const angle = Phaser.Math.Between(30, 150) * (Phaser.Math.Between(0,1) ? 1 : -1);
  puck.setVelocity(Math.cos(angle * Math.PI/180)*700, Math.sin(angle * Math.PI/180)*700);
}

function endGame() {
  gameActive = false;
  const isWin = scorePlayer >= 7;
  const isJackpot = isWin && scoreCPU === 0;
  const mult = isJackpot ? 3.0 : (isWin ? 1.8 : 0);
  const stake = parseFloat(document.getElementById('betQty').value) || 0;
  const bagStake = document.querySelector('#curToggle input:checked').value === 'BAG' ? stake : stake * 1666.67;
  if (isWin) window.__bagSession.credit(bagStake * mult);
  document.getElementById('playText').textContent = isWin ? (isJackpot ? 'JACKPOT!' : 'YOU WIN!') : 'YOU LOSE!';
  document.getElementById('playText').className = isWin ? 't win' : 't lose';
  setTimeout(() => {
    startText.setVisible(true);
    document.getElementById('playBtn').disabled = false;
  }, 3000);
}
</script>

<!-- PLAY BUTTON -->
<script>
document.getElementById('playBtn').addEventListener('click', () => {
  const stake = parseFloat(document.getElementById('usdBet').value) || 0;
  if (stake < 1) return alert('Min $1');
  if (stake > 2000) return alert('Max $2000');
  const bagStake = document.querySelector('#curToggle input:checked').value === 'BAG' 
    ? parseFloat(document.getElementById('betQty').value) 
    : stake / 0.001;
  if (!window.__bagSession.spend(bagStake)) return alert('Insufficient balance');
  document.getElementById('playBtn').disabled = true;
  mainScene.startGame();
});
</script>

<!-- STAKE WIRE + HUD -->
<script>
BAGStakeWire = { init: (o) => {
  const usd = document.getElementById('usdBet'), qty = document.getElementById('betQty');
  const cur = () => document.querySelector('#curToggle input:checked').value;
  const sync = () => {
    const u = parseFloat(usd.value) || 0;
    const price = cur() === 'BAG' ? 0.001 : 0.60;
    if (u) qty.value = (u / price).toFixed(6);
    document.getElementById('betLbl').textContent = qty.value;
  };
  usd.addEventListener('input', sync);
  qty.addEventListener('input', () => usd.value = (qty.value * (cur() === 'BAG' ? 0.001 : 0.60)).toFixed(2));
  document.querySelector('#curToggle').addEventListener('change', sync);
  document.querySelectorAll('#usdPresets button').forEach(b => b.addEventListener('click', () => {
    usd.value = b.dataset.usd === 'max' ? 2000 : b.dataset.usd;
    sync();
  }));
  sync();
}};
BAGStakeWire.init();
</script>

<!-- RULES -->
<script>
document.getElementById('rulesFab').addEventListener('click', () => document.getElementById('rulesOverlay').style.display = 'grid');
document.getElementById('rulesClose').addEventListener('click', () => document.getElementById('rulesOverlay').style.display = 'none');
</script>
</body>
</html>
