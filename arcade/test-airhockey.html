<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<meta name="format-detection" content="telephone=no" />
<title>$BAG Air Hockey ‚Äî Arcade P2E</title>
<link rel="preconnect" href="https://api.coingecko.com" crossorigin>
<script src="https://xaman.app/assets/cdn/xumm.min.js"></script>
<script>window.__BAG_FORCE_DEMO = false;</script>
<script src="https://cdn.jsdelivr.net/npm/phaser@3.70.0/dist/phaser.min.js"></script>

<style>
*{box-sizing:border-box}
:root{
  --gold:#ffe175;--bg:#020703;--panel:#0b1b13;--panel2:#0d2217;
  --muted:#aeb7af;--fg:#f5f7f4;--green:#2fbf6b;--green-600:#249a55;
  --line:#173524;--shadow:rgba(0,0,0,.35);--lose:#e25b5b;
}
html,body{
  margin:0;padding:0;min-height:100%;
  background:var(--bg);color:var(--fg);
  font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  overflow-x:hidden;overflow-y:auto;
}
img{display:block;max-width:100%;height:auto}
button,input{font-size:16px}
a[x-apple-data-detectors]{ color:inherit !important; text-decoration:none !important; pointer-events:none !important; cursor:default !important; }

.back-casino{
  position:fixed;top:18px;left:18px;z-index:1000;
  background:linear-gradient(180deg,#ffe175 0%,#f5c94c 100%);
  color:#08130d;text-decoration:none;font-weight:800;
  padding:8px 14px;border-radius:10px;
  box-shadow:0 4px 0 #b08a19;
  transition:all .15s ease
}
.back-casino:hover{filter:brightness(1.05);box-shadow:0 4px 0 #b08a19,0 14px 28px rgba(255,225,117,.22)}
.back-casino:active{transform:translateY(1px);box-shadow:0 3px 0 #9a7315}

.game-header{text-align:center;padding:36px 10px 14px}
.game-header img.hero-img{margin:0 auto 10px;filter:drop-shadow(0 10px 24px rgba(46,191,107,.18))}
.game-header h2{font-size:clamp(1.6rem,5vw,2.2rem);margin:6px 0 0}

.game-teaser{padding:10px 16px 60px;background:
  radial-gradient(1200px 600px at 10% -10%, #0e2c1d 0%, transparent 60%),
  radial-gradient(900px 500px at 110% 20%, #0b2318 0%, transparent 55%),#060806;
  border-top:1px solid #131313;border-bottom:1px solid #131313}
.game-wrap{max-width:1080px;margin:0 auto;display:grid;grid-template-columns:1fr;gap:22px}
.panel{background:linear-gradient(180deg,var(--panel) 0%,var(--panel2) 100%);
  border:1px solid var(--line);border-radius:16px;box-shadow:0 8px 24px var(--shadow)}
.pad{padding:16px}
.section-title{font-weight:800;font-size:1.2rem;margin:0 0 12px}
.felt{background:#091a13;border:1px solid #24533a;border-radius:12px;padding:12px;overflow:hidden}
.stage3d{height:600px;position:relative;border-radius:10px;overflow:hidden}
.stage3d canvas{display:block;width:100%;height:100%}
.btn-roll{
  width:min(360px,90%);padding:16px 22px;margin-top:2px;
  font-size:1.15rem;font-weight:900;text-transform:uppercase;
  border:0;border-radius:14px;color:#08130d;
  background:linear-gradient(180deg,#ffe175 0%, #f5c94c 100%);
  box-shadow:0 6px 0 #b08a19, 0 16px 32px rgba(255,225,117,.18);
  cursor:pointer;
}
.btn-roll:active{transform:translateY(2px);box-shadow:0 4px 0 #9a7315}
.micro{font-size:.85rem;color:#a8b5ab}
</style>
</head>

<body>
<a href="/casino/" class="back-casino">‚¨ÖÔ∏è Back to Casino</a>

<section class="game-header">
  <picture>
    <source type="image/webp" srcset="/assets/bag-airhockey-960.webp 960w, /assets/bag-airhockey-1024.webp 1024w" sizes="(min-width:900px) 420px, 70vw">
    <img class="hero-img" src="/assets/bag-airhockey-1024.png" alt="$BAG Air Hockey" loading="lazy" decoding="async">
  </picture>
  <h2>üèí $BAG AIR HOCKEY ‚Äî Arcade P2E</h2>
  <p class="micro">üí∞ <strong>All payouts are in $BAG.</strong> $XRP bets convert automatically at the live rate.</p>
</section>

<section class="game-teaser">
  <div class="game-wrap">
    <div class="panel pad">
      <div class="felt">
        <div id="gameContainer" class="stage3d"></div>
        <div class="roll-row"><button id="playBtn" class="btn-roll">PLAY</button></div>
        <div class="micro" style="text-align:center;margin-top:8px;opacity:.75;">Tap PLAY to start the match ‚Äî first to 7 wins</div>
      </div>
    </div>
  </div>
</section>

<footer style="text-align:center;padding:12px 0;color:#ccc;">
  ¬© 2025 $BAG Protocol | getthebag.io | Powered by $XRP
</footer>

<!-- ########### GAME SCRIPT ########### -->
<script>
const config={
  type:Phaser.AUTO,
  parent:'gameContainer',
  scale:{mode:Phaser.Scale.RESIZE,width:'100%',height:'100%'},
  backgroundColor:'#021107',
  physics:{default:'arcade',arcade:{debug:false,fps:120,step:1/240}},
  scene:{preload,create,update}
};

let puck,player,cpu,scoreText,topGoal,bottomGoal;
let scorePlayer=0,scoreCPU=0;
let touchTarget={x:0,y:0,active:false};
let prevPlayer={x:0,y:0};
let lastHit=0;
let gameActive=false;
let startText,gameOverText;

new Phaser.Game(config);

/* ---------------- PRELOAD ---------------- */
function preload(){
  this.load.image('table','/arcade/assets/img/airhockey_table-1024.webp');
  this.load.image('puck','/arcade/assets/img/puck-1024.webp');
  this.load.image('paddle_gold','/arcade/assets/img/paddle_gold-1024.webp');
  this.load.image('paddle_green','/arcade/assets/img/paddle_green-1024.webp');
}

/* ---------------- CREATE ---------------- */
function create(){
  const w=this.scale.width,h=this.scale.height,cx=w/2,cy=h/2;
  this.add.image(cx,cy,'table').setDisplaySize(w,h);
  const goalW=260,goalH=40;
  topGoal=this.add.rectangle(cx,70,goalW,goalH,0xff0000,0.4);
  bottomGoal=this.add.rectangle(cx,h-70,goalW,goalH,0x00ff00,0.4);
  this.physics.world.setBounds(80,80,w-160,h-160);

  puck=this.physics.add.image(cx,cy,'puck').setScale(0.07);
  puck.setCollideWorldBounds(true).setBounce(0.99).setDamping(true).setDrag(0.99,0.99).setMaxVelocity(1600);
  puck.body.setCircle(puck.width*0.6);

  player=this.physics.add.image(cx,h*0.85,'paddle_gold').setScale(0.1);
  cpu=this.physics.add.image(cx,h*0.15,'paddle_green').setScale(0.1);
  player.setImmovable(true); cpu.setImmovable(true); cpu.setCollideWorldBounds(true);

  this.physics.add.collider(puck,cpu,onHit,null,this);

  this.input.on('pointerdown',p=>{ if(p.y>h*0.5){touchTarget.active=true;touchTarget.x=p.x;touchTarget.y=p.y;} });
  this.input.on('pointermove',p=>{ if(touchTarget.active&&p.y>h*0.5){touchTarget.x=p.x;touchTarget.y=p.y;} });
  this.input.on('pointerup',()=>touchTarget.active=false);

  scoreText=this.add.text(cx,40,'0 - 0',{fontFamily:'Orbitron',fontSize:'48px',color:'#ffe175',stroke:'#2fbf6b',strokeThickness:3}).setOrigin(0.5,0);

  startText=this.add.text(cx,cy,'Ready to Play',{fontFamily:'Orbitron',fontSize:'48px',color:'#ffe175',stroke:'#2fbf6b',strokeThickness:3}).setOrigin(0.5);
  gameOverText=this.add.text(cx,cy,'',{fontFamily:'Orbitron',fontSize:'64px',color:'#ffe175',stroke:'#2fbf6b',strokeThickness:5}).setOrigin(0.5).setVisible(false);

  // hide until start
  [puck,player,cpu,topGoal,bottomGoal,scoreText].forEach(e=>e.setVisible(false));

  this.startGame=()=>{
    gameActive=true;
    startText.setVisible(false);
    [puck,player,cpu,topGoal,bottomGoal,scoreText].forEach(e=>e.setVisible(true));
    scorePlayer=0; scoreCPU=0; scoreText.setText('0 - 0');
    resetPuck.call(this);
  };

  document.getElementById('playBtn').addEventListener('click',()=>{
    if(gameActive)return;
    this.startGame();
  });
}

/* ---------------- MANUAL COLLISION ---------------- */
function checkManualHit(){
  const now=performance.now(); if(now-lastHit<50)return;
  const dx=puck.x-player.x,dy=puck.y-player.y,dist=Math.sqrt(dx*dx+dy*dy);
  const minDist=(puck.displayWidth*0.35)+(player.displayWidth*0.35);
  if(dist<minDist){
    lastHit=now;
    const nx=dx/dist,ny=dy/dist;
    const vx=player.x-prevPlayer.x,vy=player.y-prevPlayer.y;
    const paddleSpeed=Math.sqrt(vx*vx+vy*vy);
    const impulse=Phaser.Math.Clamp(400+paddleSpeed*220,400,1700);
    puck.body.velocity.x=nx*impulse;
    puck.body.velocity.y=ny*impulse;
  }
}

/* ---------------- CPU COLLISION ---------------- */
function onHit(puck,paddle){
  const dx=puck.x-paddle.x,dy=puck.y-paddle.y,dist=Math.sqrt(dx*dx+dy*dy)||1;
  const nx=dx/dist,ny=dy/dist;
  const vx=paddle.x-prevPlayer.x,vy=paddle.y-prevPlayer.y;
  const paddleSpeed=Math.sqrt(vx*vx+vy*vy);
  const force=Phaser.Math.Clamp(400+paddleSpeed*200,400,1500);
  puck.body.velocity.x=nx*force;
  puck.body.velocity.y=ny*force;
}

/* ---------------- UPDATE ---------------- */
function update(){
  const w=this.scale.width,h=this.scale.height;
  prevPlayer.x=player.x; prevPlayer.y=player.y;
  if(!gameActive)return;

  if(touchTarget.active){
    const dx=touchTarget.x-player.x,dy=touchTarget.y-player.y;
    player.x+=dx*0.5; player.y+=dy*0.5;
  }

  player.x=Phaser.Math.Clamp(player.x,100,w-100);
  player.y=Phaser.Math.Clamp(player.y,h*0.5+20,h-80);
  cpu.x+=(puck.x-cpu.x)*0.08; cpu.y+=(puck.y-cpu.y)*0.05;
  cpu.x=Phaser.Math.Clamp(cpu.x,100,w-100); cpu.y=Phaser.Math.Clamp(cpu.y,80,h*0.45);

  checkManualHit();

  const goalHalfW=130;
  if(puck.y<topGoal.y && Math.abs(puck.x-w/2)<goalHalfW){scorePlayer++;resetPuck.call(this,'player');}
  if(puck.y>bottomGoal.y && Math.abs(puck.x-w/2)<goalHalfW){scoreCPU++;resetPuck.call(this,'cpu');}
}

/* ---------------- HELPERS ---------------- */
function resetPuck(scoredBy){
  const w=this.scale.width,h=this.scale.height;
  puck.setPosition(w/2,h/2);
  const angle=Phaser.Math.Between(20,160)*(Phaser.Math.Between(0,1)?1:-1);
  const speed=Phaser.Math.Between(600,750);
  const vx=Math.cos(angle*Math.PI/180)*speed;
  const vy=(scoredBy==='player'?-1:1)*Math.abs(Math.sin(angle*Math.PI/180)*speed);
  puck.setVelocity(vx,vy);
  scoreText.setText(`${scorePlayer} - ${scoreCPU}`);
}
</script>

</body>
</html>
